!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("adm.@angular/common"),require("adm.maptalks"),require("adm.three"),require("adm.rxjs/operators"),require("adm.shared"),require("adm.@angular/core")):"function"==typeof define&&define.amd?define(["adm.@angular/common","adm.maptalks","adm.three","adm.rxjs/operators","adm.shared","adm.@angular/core"],e):"object"==typeof exports?exports.map=e(require("adm.@angular/common"),require("adm.maptalks"),require("adm.three"),require("adm.rxjs/operators"),require("adm.shared"),require("adm.@angular/core")):t.map=e(t["adm.@angular/common"],t["adm.maptalks"],t["adm.three"],t["adm.rxjs/operators"],t["adm.shared"],t["adm.@angular/core"])}("undefined"!=typeof self?self:this,(function(t,e,n,r,i,o){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,(function(e){return t[e]}).bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/assets/plugins/map",n(n.s=0)}({0:function(t,e,n){t.exports=n("zUnb")},"0S4P":function(e,n){e.exports=t},"5DuO":function(t,e,n){
/*!
 * maptalks.three v0.11.5
 * LICENSE : MIT
 * (c) 2016-2020 maptalks.org
 */
!function(e,r,i){"use strict";var o,a,s="object"==typeof e&&void 0!==t;function c(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}r=r,s&&(r=r||n("V0yk")),a=function(t){var e=r,n=r;function r(t,e,n){n=n||2;var r,s,c,u,h,d,v,g=e&&e.length,x=g?e[0]*n:t.length,y=i(t,0,x,n,!0),m=[];if(!y||y.next===y.prev)return m;if(g&&(y=function(t,e,n,r){var a,s,c,u=[];for(a=0,s=e.length;a<s;a++)(c=i(t,e[a]*r,a<s-1?e[a+1]*r:t.length,r,!1))===c.next&&(c.steiner=!0),u.push(p(c));for(u.sort(l),a=0;a<u.length;a++)f(u[a],n),n=o(n,n.next);return n}(t,e,y,n)),t.length>80*n){r=c=t[0],s=u=t[1];for(var b=n;b<x;b+=n)(h=t[b])<r&&(r=h),(d=t[b+1])<s&&(s=d),h>c&&(c=h),d>u&&(u=d);v=0!==(v=Math.max(c-r,u-s))?1/v:0}return a(y,m,n,r,s,v),m}function i(t,e,n,r,i){var o,a;if(i===A(t,e,n,r)>0)for(o=e;o<n;o+=r)a=j(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=j(o,t[o],t[o+1],a);return a&&m(a,a.next)&&(S(a),a=a.next),a}function o(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==y(r.prev,r,r.next))r=r.next;else{if(S(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function a(t,e,n,r,i,l,f){if(t){!f&&l&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=v(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,c,u=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<u&&(s++,r=r.nextZ);e++);for(c=u;s>0||c>0&&r;)0!==s&&(0===c||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,c--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,u*=2}while(a>1)}(i)}(t,r,i,l);for(var d,p,g=t;t.prev!==t.next;)if(d=t.prev,p=t.next,l?c(t,r,i,l):s(t))e.push(d.i/n),e.push(t.i/n),e.push(p.i/n),S(t),t=p.next,g=p.next;else if((t=p)===g){f?1===f?a(t=u(o(t),e,n),e,n,r,i,l,2):2===f&&h(t,e,n,r,i,l):a(o(t),e,n,r,i,l,1);break}}}function s(t){var e=t.prev,n=t,r=t.next;if(y(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(g(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&y(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function c(t,e,n,r){var i=t.prev,o=t,a=t.next;if(y(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,c=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,u=v(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,e,n,r),h=v(s,c,e,n,r),l=t.prevZ,f=t.nextZ;l&&l.z>=u&&f&&f.z<=h;){if(l!==t.prev&&l!==t.next&&g(i.x,i.y,o.x,o.y,a.x,a.y,l.x,l.y)&&y(l.prev,l,l.next)>=0)return!1;if(l=l.prevZ,f!==t.prev&&f!==t.next&&g(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;l&&l.z>=u;){if(l!==t.prev&&l!==t.next&&g(i.x,i.y,o.x,o.y,a.x,a.y,l.x,l.y)&&y(l.prev,l,l.next)>=0)return!1;l=l.prevZ}for(;f&&f.z<=h;){if(f!==t.prev&&f!==t.next&&g(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function u(t,e,n){var r=t;do{var i=r.prev,a=r.next.next;!m(i,a)&&b(i,r,r.next,a)&&M(i,a)&&M(a,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(a.i/n),S(r),S(r.next),r=t=a),r=r.next}while(r!==t);return o(r)}function h(t,e,n,r,i,s){var c=t;do{for(var u=c.next.next;u!==c.prev;){if(c.i!==u.i&&x(c,u)){var h=O(c,u);return c=o(c,c.next),h=o(h,h.next),a(c,e,n,r,i,s),void a(h,e,n,r,i,s)}u=u.next}c=c.next}while(c!==t)}function l(t,e){return t.x-e.x}function f(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n;var c,u=n,h=n.x,l=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=h&&i!==r.x&&g(o<l?i:a,o,h,l,o<l?a:i,o,r.x,r.y)&&(c=Math.abs(o-r.y)/(i-r.x),M(r,t)&&(c<f||c===f&&(r.x>n.x||r.x===n.x&&d(n,r)))&&(n=r,f=c)),r=r.next}while(r!==u);return n}(t,e)){var n=O(e,t);o(e,e.next),o(n,n.next)}}function d(t,e){return y(t.prev,t,e.prev)<0&&y(e.next,t,t.next)<0}function v(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function p(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function g(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function x(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&b(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(M(t,e)&&M(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(y(t.prev,t,e.prev)||y(t,e.prev,e))||m(t,e)&&y(t.prev,t,t.next)>0&&y(e.prev,e,e.next)>0)}function y(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function m(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,n,r){var i=w(y(t,e,n)),o=w(y(t,e,r)),a=w(y(n,r,t)),s=w(y(n,r,e));return i!==o&&a!==s||!(0!==i||!_(t,n,e))||!(0!==o||!_(t,r,e))||!(0!==a||!_(n,t,r))||!(0!==s||!_(n,e,r))}function _(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function w(t){return t>0?1:t<0?-1:0}function M(t,e){return y(t.prev,t,t.next)<0?y(t,e,t.next)>=0&&y(t,t.prev,e)>=0:y(t,e,t.prev)<0||y(t,t.next,e)<0}function O(t,e){var n=new C(t.i,t.x,t.y),r=new C(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function j(t,e,n,r){var i=new C(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function S(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function C(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}function T(t,e,n){var r=e[0],i=e[1],o=n[0]-r,a=n[1]-i;if(0!==o||0!==a){var s=((t[0]-r)*o+(t[1]-i)*a)/(o*o+a*a);s>1?(r=n[0],i=n[1]):s>0&&(r+=o*s,i+=a*s)}return(o=t[0]-r)*o+(a=t[1]-i)*a}function B(t,e,n){if(t.length<=2)return t;var r=void 0!==e?e*e:1;return function(t,e){var n=t.length-1,r=[t[0]];return function t(e,n,r,i,o){for(var a,s=i,c=n+1;c<r;c++){var u=T(e[c],e[n],e[r]);u>s&&(a=c,s=u)}s>i&&(a-n>1&&t(e,n,a,i,o),o.push(e[a]),r-a>1&&t(e,a,r,i,o))}(t,0,n,e,r),r.push(t[n]),r}(t=n?t:function(t,e){for(var n,r,i,o,a,s=t[0],c=[s],u=1,h=t.length;u<h;u++)(o=(r=n=t[u])[0]-(i=s)[0])*o+(a=r[1]-i[1])*a>e&&(c.push(n),s=n);return s!==n&&c.push(n),c}(t,r),r)}function k(t,e){return t[0]*e[0]+t[1]*e[1]}function P(t,e){var n=e[0],r=e[1],i=Math.sqrt(n*n+r*r);return t[0]=n/i,t[1]=r/i,t}function z(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function I(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function L(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function E(t,e){var n=e[0],r=e[1],i=e[2],o=Math.sqrt(n*n+r*r+i*i);return t[0]=n/o,t[1]=r/o,t[2]=i/o,t}function V(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],c=n[2];return t[0]=i*c-o*s,t[1]=o*a-r*c,t[2]=r*s-i*a,t}r.deviation=function(t,e,n,r){var i=e&&e.length,o=Math.abs(A(t,0,i?e[0]*n:t.length,n));if(i)for(var a=0,s=e.length;a<s;a++)o-=Math.abs(A(t,e[a]*n,a<s-1?e[a+1]*n:t.length,n));var c=0;for(a=0;a<r.length;a+=3){var u=r[a]*n,h=r[a+1]*n,l=r[a+2]*n;c+=Math.abs((t[u]-t[l])*(t[h+1]-t[u+1])-(t[u]-t[h])*(t[l+1]-t[u+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},r.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&n.holes.push(r+=t[i-1].length)}return n},e.default=n;var U=[];function R(t,e,n,r){var i=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}(e,n),o=Math.acos(i)*r;return z(U,n,e,-i),function(t,e){var n=e[0],r=e[1],i=e[2],o=Math.sqrt(n*n+r*r+i*i);t[0]=n/o,t[1]=r/o,t[2]=i/o}(U,U),function(t,e,n){t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n}(t,e,Math.cos(o)),z(t,t,U,Math.sin(o)),t}function F(t,e,n){if(n-e<3)return 0;for(var r=0,i=2*(n-1),o=2*e;o<2*n;){var a=t[i],s=t[i+1],c=t[o],u=t[o+1];i=o,o+=2,r+=a*u-c*s}return r}function Z(t,n,r){return void 0===r&&(r=2),e(t,n,r)}var G=[],D=[],W=[];function q(t,e,n,r,i,o,a,s){var c=null!=a,u=i,h=null;c&&(h=new Uint32Array(r-n));for(var l=n;l<r;l++){var f=l===r-1?n:l+1,d=l===n?r-1:l-1,v=t[2*d+1],p=t[2*l],g=t[2*l+1],x=t[2*f],y=t[2*f+1];if(G[0]=p-t[2*d],G[1]=g-v,D[0]=x-p,D[1]=y-g,P(G,G),P(D,D),c&&(h[l]=u),s||l!==n)if(s||l!==r-1){I(W,D,G);var m=W[1];W[1]=-W[0],W[0]=m,P(W,W);var b=k(W,D),_=Math.sqrt(1-b*b),w=o*Math.min(10,1/_);if(c&&1/_>a&&o*b<0){var M=p+W[0]*o,O=g+W[1]*o,j=Math.acos(_)/2,S=Math.tan(j)*Math.abs(o);e[2*u]=M+W[1]*S,e[2*u+1]=O-W[0]*S,e[2*++u]=M-W[1]*S,e[2*u+1]=O+W[0]*S,u++}else e[2*u]=p+W[0]*w,e[2*u+1]=g+W[1]*w,u++}else W[0]=G[1],W[1]=-G[0],P(W,W),e[2*u]=p+W[0]*o,e[2*u+1]=g+W[1]*o,u++;else W[0]=D[1],W[1]=-D[0],P(W,W),e[2*u]=p+W[0]*o,e[2*u+1]=g+W[1]*o,u++}return h}function H(t,e,n,r,i){var o=null!=r?[]:new Float32Array(t.length);if(q(t,o,0,e&&e.length?e[0]:t.length/2,0,n,r,i),e)for(var a=0;a<e.length;a++){var s=e[a];q(t,o,s,e[a+1]||t.length/2,null!=r?o.length/2:s,n,r,i)}return o}function K(t,e,n,r){for(var i=0;i<Math.floor((r-n)/2);i++)for(var o=0;o<e;o++){var a=(i+n)*e+o,s=(r-i-1)*e+o,c=t[a];t[a]=t[s],t[s]=c}return t}function N(t,e){var n=t.length/2,r=0,i=e&&e.length?e[0]:n;F(t,r,i)>0&&K(t,2,r,i);for(var o=1;o<(e?e.length:0)+1;o++)F(t,r=e[o-1],i=e[o]||n)<0&&K(t,2,r,i)}var Q=[[0,0],[1,0],[1,1],[0,0],[1,1],[0,1]];function X(t,e,n,r,i,o){var a=e.vertices,s=e.topVertices,c=e.depth,u=e.rect,h=r-n,l=o.smoothSide?1:2,f=h*l,d=o.smoothBevel?1:2,v=Math.min(c/2,o.bevelSize),p=o.bevelSegments,g=i.vertex,x=Math.max(u.width,u.height,c);if(v>0)for(var y=[0,0,1],m=[],b=[0,0,-1],_=[],w=0,M=new Float32Array(h),O=0;O<2;O++)for(var j=0===O?c-v:v,S=0;S<=p*d;S++){for(var C=0,A=void 0,T=void 0,B=0;B<h;B++){for(var k=0;k<l;k++){var P=2*((B+k)%h+n);m[0]=a[P]-s[P],m[1]=a[P+1]-s[P+1],m[2]=0;var z=Math.sqrt(m[0]*m[0]+m[1]*m[1]);m[0]/=z,m[1]/=z;var I=(Math.floor(S/d)+S%d)/p;0===O?R(_,y,m,I):R(_,m,b,I);var L=0===O?I:1-I,E=v*Math.sin(L*Math.PI/2),V=z*Math.cos(L*Math.PI/2),U=v*z/Math.sqrt(E*E+V*V),F=_[0]*U+s[P],Z=_[1]*U+s[P+1],G=_[2]*U+j;if(t.position[3*i.vertex]=F,t.position[3*i.vertex+1]=Z,t.position[3*i.vertex+2]=G,(B>0||k>0)&&(C+=Math.sqrt((A-F)*(A-F)+(T-Z)*(T-Z))),S>0||O>0){var D=3*(i.vertex-f),W=t.position[D],q=t.position[D+1],H=t.position[D+2];M[B]+=Math.sqrt((W-F)*(W-F)+(q-Z)*(q-Z)+(H-G)*(H-G))}t.uv[2*i.vertex]=C/x,t.uv[2*i.vertex+1]=M[B]/x,A=F,T=Z,i.vertex++}if(d>1&&S%d||1===d&&S>=1)for(var K=0;K<6;K++){var N=(Q[K][0]+B*l)%f,X=Q[K][1]+w;t.indices[i.index++]=(X-1)*f+N+g}}w++}else for(var Y=0;Y<2;Y++)for(var J=0===Y?c-v:v,$=0,tt=void 0,et=void 0,nt=0;nt<h;nt++)for(var rt=0;rt<l;rt++){var it=2*((nt+rt)%h+n),ot=a[it],at=a[it+1];t.position[3*i.vertex]=ot,t.position[3*i.vertex+1]=at,t.position[3*i.vertex+2]=J,(nt>0||rt>0)&&($+=Math.sqrt((tt-ot)*(tt-ot)+(et-at)*(et-at))),t.uv[2*i.vertex]=$/x,t.uv[2*i.vertex+1]=J/x,tt=ot,et=at,i.vertex++}for(var st=v>0?p*d+1:1,ct=0;ct<h;ct++)for(var ut=0;ut<6;ut++){var ht=(Q[ut][0]+ct*l)%f,lt=Q[ut][1]+st;t.indices[i.index++]=(lt-1)*f+ht+g}}function Y(t,e,n,r){var i=t.indices,o=t.vertices,a=t.topVertices,s=t.rect,c=t.depth;if(!(o.length<=4)){for(var u=n.vertex,h=i.length,l=0;l<h;l++)e.indices[n.index++]=u+i[l];for(var f=Math.max(s.width,s.height),d=0;d<(r.excludeBottom?1:2);d++)for(var v=0;v<a.length;v+=2){var p=a[v],g=a[v+1];e.position[3*n.vertex]=p,e.position[3*n.vertex+1]=g,e.position[3*n.vertex+2]=(1-d)*c,e.uv[2*n.vertex]=(p-s.x)/f,e.uv[2*n.vertex+1]=(g-s.y)/f,n.vertex++}if(!r.excludeBottom)for(var x=o.length/2,y=0;y<h;y+=3)for(var m=0;m<3;m++)e.indices[n.index++]=u+x+i[y+2-m]}}function J(t,e){for(var n=[],r=0;r<t.length;r++){for(var i=t[r],o=[],a=i.length,s=i[a-1][0],c=i[a-1][1],u=0,h=0;h<a;h++){var l=i[h][0],f=i[h][1],d=l-s,v=f-c;(u+=Math.sqrt(d*d+v*v))>e&&(o.push(i[h]),u=0),s=l,c=f}o.length>=3&&n.push(o)}return n.length>0?n:null}function $(t,e){for(var n=[],r=0;r<t.length;r++){var i=t[r];(i=B(i,e,!0)).length>=3&&n.push(i)}return n.length>0?n:null}function tt(t,n){n=Object.assign({},n);for(var r=[1/0,1/0],i=[-1/0,-1/0],o=0;o<t.length;o++)et(t[o][0],r,i);n.boundingRect=n.boundingRect||{x:r[0],y:r[1],width:i[0]-r[0],height:i[1]-r[1]},function(t){t.depth=t.depth||1,t.bevelSize=t.bevelSize||0,t.bevelSegments=null==t.bevelSegments?2:t.bevelSegments,t.smoothSide=t.smoothSide||!1,t.smoothBevel=t.smoothBevel||!1,t.simplify=t.simplify||0,"number"==typeof t.depth&&(t.bevelSize=Math.min(t.bevelSegments>0?t.bevelSize:0,t.depth/2)),t.bevelSize>0||(t.bevelSegments=0),t.bevelSegments=Math.round(t.bevelSegments);var e=t.boundingRect;if(t.translate=t.translate||[0,0],t.scale=t.scale||[1,1],t.fitRect){var n=null==t.fitRect.x?e.x||0:t.fitRect.x,r=null==t.fitRect.y?e.y||0:t.fitRect.y,i=t.fitRect.width,o=t.fitRect.height;null==i?null!=o?i=o/e.height*e.width:(i=e.width,o=e.height):null==o&&(o=i/e.width*e.height),t.scale=[i/e.width,o/e.height],t.translate=[(n-e.x)*t.scale[0],(r-e.y)*t.scale[1]]}}(n);for(var a=[],s=n.translate||[0,0],c=n.scale||[1,1],u=n.boundingRect,h={x:u.x*c[0]+s[0],y:u.y*c[1]+s[1],width:u.width*c[0],height:u.height*c[1]},l=Math.min(u.width,u.height)/1e5,f=0;f<t.length;f++){var d=J(t[f],l);if(d){var v=n.simplify/Math.max(c[0],c[1]);if(v>0&&(d=$(d,v)),d){for(var p=e.flatten(d),g=p.vertices,x=p.holes,y=p.dimensions,m=0;m<g.length;)g[m]=g[m++]*c[0]+s[0],g[m]=g[m++]*c[1]+s[1];if(N(g,x),2!==y)throw new Error("Only 2D polygon points are supported");var b=n.bevelSize>0?H(g,x,n.bevelSize,null,!0):g,_=Z(b,x,y);a.push({indices:_,vertices:g,topVertices:b,holes:x,rect:h,depth:"function"==typeof n.depth?n.depth(f):n.depth})}}}return function(t,e){for(var n=0,r=0,i=0;i<t.length;i++){var o=t[i],a=o.indices,s=o.holes,c=o.vertices.length/2,u=Math.min(o.depth/2,e.bevelSize)>0?e.bevelSegments:0;n+=a.length*(e.excludeBottom?1:2),r+=c*(e.excludeBottom?1:2);for(var h=2+2*u,l=0,f=0,d=0;d<(s?s.length:0)+1;d++){0===d?f=s&&s.length?s[0]:c:(l=s[d-1],f=s[d]||c),n+=6*(f-l)*(h-1);var v=(f-l)*(e.smoothSide?1:2);r+=v*h+(e.smoothBevel?0:u*v*2)}}for(var p={position:new Float32Array(3*r),indices:new(r>65535?Uint32Array:Uint16Array)(n),uv:new Float32Array(2*r)},g={vertex:0,index:0},x=0;x<t.length;x++)Y(t[x],p,g,e);for(var y=0;y<t.length;y++){var m=t[y],b=m.holes,_=m.vertices.length/2,w=0,M=b&&b.length?b[0]:_;if(X(p,t[y],w,M,g,e),b)for(var O=0;O<b.length;O++)X(p,t[y],w=b[O],M=b[O+1]||_,g,e)}for(var j=0;j<p.uv.length;j++){var S=p.uv[j];p.uv[j]=S>0&&Math.round(S)===S?1:S%1}return p.normal=function(t,e){function n(t,e,n,r){t[0]=e,t[1]=n,t[2]=r}for(var r=[],i=[],o=[],a=[],s=[],c=[],u=t.length,h=new Float32Array(e.length),l=0;l<u;){var f=3*t[l++],d=3*t[l++],v=3*t[l++];n(r,e[f],e[f+1],e[f+2]),n(i,e[d],e[d+1],e[d+2]),n(o,e[v],e[v+1],e[v+2]),L(a,r,i),L(s,i,o),V(c,a,s);for(var p=0;p<3;p++)h[f+p]=h[f+p]+c[p],h[d+p]=h[d+p]+c[p],h[v+p]=h[v+p]+c[p]}for(var g=0;g<h.length;)n(c,h[g],h[g+1],h[g+2]),E(c,c),h[g++]=c[0],h[g++]=c[1],h[g++]=c[2];return h}(p.indices,p.position),p.boundingRect=t[0]&&t[0].rect,p}(a,n)}function et(t,e,n){for(var r=0;r<t.length;r++)e[0]=Math.min(t[r][0],e[0]),e[1]=Math.min(t[r][1],e[1]),n[0]=Math.max(t[r][0],n[0]),n[1]=Math.max(t[r][1],n[1])}function nt(t){for(var e=new Float32Array(t),n=[],r=0,i=e.length;r<i;r+=2)n.push([e[r],e[r+1]]);return n}function rt(t,e){for(var n=new Float32Array(e),r=0,i=0;i<t.length;++i)n.set(t[i],r),r+=t[i].length;return n}t.initialize=function(){},t.onmessage=function(t,e){var n=t.data,r=n.datas;if("Polygon"===n.type){!function(t){for(var e=t.length,n=0;n<e;n++)for(var r=t[n].data,i=0,o=r.length;i<o;i++)for(var a=r[i],s=0,c=a.length;s<c;s++)t[n].data[i][s]=nt(a[s])}(r);var i=function(t){for(var e=t.length,n=[],r=[],i=[],o=0,a=0,s=0,c=0,u=0;u<e;u++){var h={position:(b=tt((m=t[u]).data,{depth:m.height})).position,normal:b.normal,uv:b.uv,indices:b.indices},l=h.position,f=h.normal,d=h.uv,v=h.indices;r.push(h);var p=v.length/3;i[u]=[o+1,o+p],o+=p;var g=l.length/3,x=f.length/3,y=d.length/2;n[u]={position:{count:g,start:a,end:a+3*g},normal:{count:x,start:s,end:s+3*x},uv:{count:y,start:c,end:c+2*y},hide:!1},a+=3*g,s+=3*x,c+=2*y}var m,b,_=function(t){for(var e={},n={},r=0;r<t.length;++r){var i=t[r];for(var o in i)void 0===e[o]&&(e[o]=[],n[o]=0),e[o].push(i[o]),n[o]+=i[o].length}var a={},s=0,c=[];for(var u in e)if("indices"===u)for(var h=e[u],l=0,f=h.length;l<f;l++){for(var d=h[l],v=0,p=d.length;v<p;v++)c.push(d[v]+s);s+=e.position[l].length/3}else{var g=rt(e[u],n[u]);if(!g)return null;a[u]=g}return a.indices=new Uint32Array(c),a}(r);return{position:_.position.buffer,normal:_.normal.buffer,uv:_.uv.buffer,indices:_.indices.buffer,faceMap:i,geometriesAttributes:n}}(r);e(null,i,[i.position,i.normal,i.uv,i.indices])}},Object.defineProperty(t,"__esModule",{value:!0})},o?a(s?t.exports:r):r&&r.registerWorkerAdapter?(r.registerWorkerAdapter("maptalks.three",a),o=!0):console.warn("maptalks.registerWorkerAdapter is not defined,If you need to use ThreeVectorTileLayer,you can npm i maptalks@next,more https://github.com/maptalks/maptalks.js/tree/next");var h=function(t){function e(){return t.apply(this,arguments)||this}return c(e,t),e.prototype.addTo=function(t){if(t instanceof O)return t.on("mousemove",this.onMouseMove,this),t.on("mouseout",this.onMouseOut,this),this._owner=t,this._switchEvents("on"),this.onAdd&&this.onAdd(),this.fire("add"),this;throw new Error("Invalid BaseObject the tooltip is added to.")},e}(r.ui.ToolTip),l=parseInt(i.REVISION);function f(t,e,n){return l>109?t.setAttribute(e,n):t.addAttribute(e,n),t}var d,v=function(){i.InstancedBufferGeometry.call(this),this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),f(this,"position",new i.Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),f(this,"uv",new i.Float32BufferAttribute([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))};v.prototype=Object.assign(Object.create(i.InstancedBufferGeometry.prototype),{constructor:v,isLineSegmentsGeometry:!0,applyMatrix:function(t){var e=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==e&&(t.applyToBufferAttribute(e),t.applyToBufferAttribute(n),e.data.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},setPositions:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var n=new i.InstancedInterleavedBuffer(e,6,1);return f(this,"instanceStart",new i.InterleavedBufferAttribute(n,3,0)),f(this,"instanceEnd",new i.InterleavedBufferAttribute(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var n=new i.InstancedInterleavedBuffer(e,6,1);return f(this,"instanceColorStart",new i.InterleavedBufferAttribute(n,3,0)),f(this,"instanceColorEnd",new i.InterleavedBufferAttribute(n,3,3)),this},fromWireframeGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromEdgesGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromMesh:function(t){return this.fromWireframeGeometry(new i.WireframeGeometry(t.geometry)),this},fromLineSegements:function(t){var e=t.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.position.array),this},computeBoundingBox:(d=new i.Box3,function(){null===this.boundingBox&&(this.boundingBox=new i.Box3);var t=this.attributes.instanceStart,e=this.attributes.instanceEnd;void 0!==t&&void 0!==e&&(this.boundingBox.setFromBufferAttribute(t),d.setFromBufferAttribute(e),this.boundingBox.union(d))}),computeBoundingSphere:function(){var t=new i.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new i.Sphere),null===this.boundingBox&&this.computeBoundingBox();var e=this.attributes.instanceStart,n=this.attributes.instanceEnd;if(void 0!==e&&void 0!==n){var r=this.boundingSphere.center;this.boundingBox.getCenter(r);for(var o=0,a=0,s=e.count;a<s;a++)t.fromBufferAttribute(e,a),o=Math.max(o,r.distanceToSquared(t)),t.fromBufferAttribute(n,a),o=Math.max(o,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}(),toJSON:function(){},copy:function(t){return this}});var p={},g={};p.line={linewidth:{value:1},resolution:{value:new i.Vector2(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},g.line={uniforms:i.UniformsUtils.merge([i.UniformsLib.common,i.UniformsLib.fog,p.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\tfloat a = vUv.x;\n\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t}\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );\n\n\t\t\t#include <premultiplied_alpha_fragment>\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\n\t\t}\n\t\t"};var x=function(t){i.ShaderMaterial.call(this,{type:"LineMaterial",uniforms:i.UniformsUtils.clone(g.line.uniforms),vertexShader:g.line.vertexShader,fragmentShader:g.line.fragmentShader}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}}}),this.setValues(t)};(x.prototype=Object.create(i.ShaderMaterial.prototype)).constructor=x,x.prototype.isLineMaterial=!0,x.prototype.copy=function(t){return i.ShaderMaterial.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.resolution=t.resolution,this};var y,m,b=function(t,e){i.Mesh.call(this),this.type="LineSegments2",this.geometry=void 0!==t?t:new v,this.material=void 0!==e?e:new x({color:16777215*Math.random()})};b.prototype=Object.assign(Object.create(i.Mesh.prototype),{constructor:b,isLineSegments2:!0,computeLineDistances:(y=new i.Vector3,m=new i.Vector3,function(){for(var t=this.geometry,e=t.attributes.instanceStart,n=t.attributes.instanceEnd,r=new Float32Array(2*e.data.count),o=0,a=0,s=e.data.count;o<s;o++,a+=2)y.fromBufferAttribute(e,o),m.fromBufferAttribute(n,o),r[a]=0===a?0:r[a-1],r[a+1]=r[a]+y.distanceTo(m);var c=new i.InstancedInterleavedBuffer(r,2,1);return f(t,"instanceDistanceStart",new i.InterleavedBufferAttribute(c,1,0)),f(t,"instanceDistanceEnd",new i.InterleavedBufferAttribute(c,1,1)),this}),copy:function(t){return this}});var _=function(){v.call(this),this.type="LineGeometry"};_.prototype=Object.assign(Object.create(v.prototype),{constructor:_,isLineGeometry:!0,fromLine:function(t){var e=t.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.position.array),this},copy:function(t){return this}});var w=function(t,e){b.call(this),this.type="Line2",this.geometry=void 0!==t?t:new _,this.material=void 0!==e?e:new x({color:16777215*Math.random()})};w.prototype=Object.assign(Object.create(b.prototype),{constructor:w,isLine2:!0,copy:function(t){return this}});var M={interactive:!0,altitude:0,minZoom:0,maxZoom:30,asynchronous:!1},O=function(t){function e(e){var n;return(n=t.call(this)||this).isBaseObject=!0,n.isAdd=!1,n.object3d=null,n.options={},n.toolTip=null,n.infoWindow=null,n._mouseover=!1,n._showPlayer=null,n._visible=!0,n._zoomVisible=!0,n._vt=null,n.picked=!1,n.pickObject3d=null,void 0===e&&(e=r.Util.GUID()),n.id=e,n}c(e,t);var n=e.prototype;return n.addTo=function(t){return t instanceof xn?t.addMesh(this):console.error("layer only support maptalks.ThreeLayer"),this},n.remove=function(){var t=this.getLayer();return t&&t.removeMesh(this),this},n.getObject3d=function(){return this.object3d},n.getId=function(){return this.id},n.setId=function(t){var e=this.getId();return this.id=t,this._fire("idchange",{old:e,new:t,target:this}),this},n.getType=function(){return this.constructor.name},n.getOptions=function(){return this.options},n.getProperties=function(){return(this.options||{}).properties},n.setProperties=function(t){var e=Object.assign({},this.getProperties());return this.options.properties=t,this._fire("propertieschange",{old:e,new:t,target:this}),this},n.getLayer=function(){return this.options.layer},n.getMap=function(){var t=this.getLayer();if(t)return t.getMap()},n.getCenter=function(){var t=this.getOptions(),e=t.coordinate;if(e)return e;var n=t.polygon||t.lineString;return n&&n.getCenter?n.getCenter():void 0},n.getAltitude=function(){return this.getOptions().altitude},n.setAltitude=function(t){if(r.Util.isNumber(t)){var e=this.getLayer().distanceToVector3(t,t).x;if(this.getObject3d().position.z=e,this.options.altitude=t,this.pickObject3d&&(this.pickObject3d.position.z=e),this._baseObjects&&Array.isArray(this._baseObjects))for(var n=0,i=this._baseObjects.length;n<i;n++)this._baseObjects[n]&&(this._baseObjects[n].getObject3d().position.z=e)}return this},n.show=function(){return this._zoomVisible&&(this.getObject3d().visible=!0,this._fire("show")),this._visible=!0,this},n.hide=function(){return this.getObject3d().visible=!1,this._fire("hide"),this._visible=!1,this},n.isVisible=function(){return!!this.getObject3d().visible},n.getSymbol=function(){return this.getObject3d().material},n.setSymbol=function(t){if(t&&t instanceof i.Material){t.needsUpdate=!0,t.vertexColors=this.getObject3d().material.vertexColors;var e=this.getObject3d().material.clone();this.getObject3d().material=t,this._fire("symbolchange",{old:e,new:t,target:this})}return this},n.setInfoWindow=function(t){return this.removeInfoWindow(),this.infoWindow=new r.ui.InfoWindow(t),this.infoWindow.addTo(this),this},n.getInfoWindow=function(){return this.infoWindow},n.openInfoWindow=function(t){return(t=t||this.getCenter())instanceof r.Coordinate||(t=new r.Coordinate(t)),t&&this.infoWindow&&this.infoWindow.show(t),this},n.closeInfoWindow=function(){return this.infoWindow&&this.infoWindow.hide(),this},n.removeInfoWindow=function(){return this.infoWindow&&this.infoWindow.remove()&&delete this.infoWindow,this},n.setToolTip=function(t,e){return this.removeToolTip(),this.toolTip=new h(t,e),this.toolTip.addTo(this),this},n.getToolTip=function(){return this.toolTip},n.openToolTip=function(t){return(t=t||this.getCenter())instanceof r.Coordinate||(t=new r.Coordinate(t)),t&&this.toolTip&&this.toolTip.show(t),this},n.closeToolTip=function(){return this.toolTip&&this.toolTip.hide(),this},n.removeToolTip=function(){return this.toolTip&&this.toolTip.remove()&&delete this.toolTip,this},n.animateShow=function(t,e){var n=this;void 0===t&&(t={}),this._showPlayer&&this._showPlayer.cancel(),r.Util.isFunction(t)&&(e=t={});var i=this._showPlayer=r.animation.Animation.animate({scale:1},{duration:t.duration||1e3,easing:t.easing||"out"},(function(t){var r=t.styles.scale;r>0&&n.getObject3d().scale.set(1,1,r),e&&e(t,r)}));return i.play(),i},n.getMinZoom=function(){return this.getOptions().minZoom},n.getMaxZoom=function(){return this.getOptions().maxZoom},n.isAsynchronous=function(){return this.getOptions().asynchronous},n.fire=function(t,e){return this._fire(t,e),this._vt&&this._vt.onSelectMesh&&this._vt.onSelectMesh(t,e),this},n.config=function(){return this},n.setPickObject3d=function(t){return this.pickObject3d=t,this.pickObject3d.__parent=this,this},n._initOptions=function(t){return this.options=r.Util.extend({},M,t),this},n._createMesh=function(t,e){return this.object3d=new i.Mesh(t,e),this.object3d.__parent=this,this},n._createGroup=function(){return this.object3d=new i.Group,this.object3d.__parent=this,this},n._createLine=function(t,e){return this.object3d=new i.Line(t,e),this.object3d.computeLineDistances(),this.object3d.__parent=this,this},n._createLine2=function(t,e){return this.object3d=new w(t,e),this.object3d.computeLineDistances(),this.object3d.__parent=this,this},n._createPoints=function(t,e){return this.object3d=new i.Points(t,e),this.object3d.__parent=this,this},n._createLineSegments=function(t,e){return this.object3d=new i.LineSegments(t,e),this.object3d.computeLineDistances(),this.object3d.__parent=this,this},e}(r.Eventable((function(){})));function j(t){for(var e={},n={},r=0;r<t.length;++r){var o=t[r];for(var a in o)void 0===e[a]&&(e[a]=[],n[a]=0),e[a].push(o[a]),n[a]+=o[a].length}var s={},c=0,u=[];for(var h in e)if("indices"===h)for(var l=e[h],d=0,v=l.length;d<v;d++){for(var p=l[d],g=0,x=p.length;g<x;g++)u.push(p[g]+c);c+=e.position[d].length/3}else{var y=S(e[h],n[h]);if(!y)return null;s[h]=y}s.indices=new Uint32Array(u);var m=s.position,b=s.normal,_=s.uv,w=s.indices,M=new i.BufferGeometry,O=new Float32Array(m.length);return O.fill(1,0,m.length),f(M,"color",new i.BufferAttribute(O,3)),f(M,"normal",new i.BufferAttribute(b,3)),f(M,"position",new i.BufferAttribute(m,3)),_&&_.length&&f(M,"uv",new i.BufferAttribute(_,2)),M.setIndex(new i.BufferAttribute(w,1)),M}function S(t,e){for(var n=new Float32Array(e),r=0,i=0;i<t.length;++i)n.set(t[i],r),r+=t[i].length;return n}var C={};function A(t,e){void 0===e&&(e=!0);var n,r=t.height,o=t.radialSegments,a=t.radius,s=t._radius,c=t._height;if(!e){var u=new i.CylinderBufferGeometry(a,a,r,o,1);u.rotateX(Math.PI/2);for(var h=u.attributes.position.array,l=0,f=h.length;l<f;l+=3)h[l+2]+=r/2;return u}for(var d=0;d<=4;d++){var v=[c+d,s,o].join("-").toString();if(n=C[v])break;if(v=[c-d,s,o].join("-").toString(),n=C[v])break}if(!n){var p=[c,s,o].join("-").toString();(n=C[p]=new i.CylinderBufferGeometry(a,a,r,o,1)).rotateX(Math.PI/2);for(var g=n.attributes.position.array,x=0,y=g.length;x<y;x+=3)g[x+2]+=r/2;return n}return n}function T(t,e,n,r,o){void 0===r&&(r="y"),void 0===o&&(o=0);var a=0;"y"===r?a=1:"z"===r&&(a=2);for(var s=t.attributes.position.array,c=s.length,u=e instanceof i.Color?e:new i.Color(e),h=new i.Color(n),l=[],d=0;d<c;d+=3)s[d+a]>o?l.push(h.r,h.g,h.b):l.push(u.r,u.g,u.b);return f(t,"color",new i.Float32BufferAttribute(l,3,!0)),l}var B={radius:10,height:100,radialSegments:6,altitude:0,topColor:null,bottomColor:"#2d2f61"},k=function(t){function e(e,n,o,a){var s;n=r.Util.extend({},B,n,{layer:a,coordinate:e}),(s=t.call(this)||this)._initOptions(n);var c=n.height,u=n.radius,h=n.topColor,l=n.bottomColor,f=n.altitude;n.height=a.distanceToVector3(c,c).x,n.radius=a.distanceToVector3(u,u).x,n._radius=s.options.radius,n._height=s.options.height,s._h=n.height;var d=A(n);h&&!o.map&&(T(d,l,h,"z",n.height/2),o.vertexColors=i.VertexColors),s._createMesh(d,o);var v=a.distanceToVector3(f,f).x,p=a.coordinateToVector3(e,v);return s.getObject3d().position.copy(p),s}return c(e,t),e}(O),P=I,z=I;function I(t,e,n){n=n||2;var r,i,o,a,s,c,u,h=e&&e.length,l=h?e[0]*n:t.length,f=L(t,0,l,n,!0),d=[];if(!f||f.next===f.prev)return d;if(h&&(f=function(t,e,n,r){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=L(t,e[i]*r,i<o-1?e[i+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),s.push(H(a));for(s.sort(G),i=0;i<s.length;i++)D(s[i],n),n=E(n,n.next);return n}(t,e,f,n)),t.length>80*n){r=o=t[0],i=a=t[1];for(var v=n;v<l;v+=n)(s=t[v])<r&&(r=s),(c=t[v+1])<i&&(i=c),s>o&&(o=s),c>a&&(a=c);u=0!==(u=Math.max(o-r,a-i))?1/u:0}return V(f,d,n,r,i,u),d}function L(t,e,n,r,i){var o,a;if(i===ot(t,e,n,r)>0)for(o=e;o<n;o+=r)a=nt(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=nt(o,t[o],t[o+1],a);return a&&X(a,a.next)&&(rt(a),a=a.next),a}function E(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!X(r,r.next)&&0!==Q(r.prev,r,r.next))r=r.next;else{if(rt(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function V(t,e,n,r,i,o,a){if(t){!a&&o&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=q(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,c,u=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<u&&(s++,r=r.nextZ);e++);for(c=u;s>0||c>0&&r;)0!==s&&(0===c||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,c--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,u*=2}while(a>1)}(i)}(t,r,i,o);for(var s,c,u=t;t.prev!==t.next;)if(s=t.prev,c=t.next,o?R(t,r,i,o):U(t))e.push(s.i/n),e.push(t.i/n),e.push(c.i/n),rt(t),t=c.next,u=c.next;else if((t=c)===u){a?1===a?V(t=F(E(t),e,n),e,n,r,i,o,2):2===a&&Z(t,e,n,r,i,o):V(E(t),e,n,r,i,o,1);break}}}function U(t){var e=t.prev,n=t,r=t.next;if(Q(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(K(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Q(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function R(t,e,n,r){var i=t.prev,o=t,a=t.next;if(Q(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,c=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,u=q(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,e,n,r),h=q(s,c,e,n,r),l=t.prevZ,f=t.nextZ;l&&l.z>=u&&f&&f.z<=h;){if(l!==t.prev&&l!==t.next&&K(i.x,i.y,o.x,o.y,a.x,a.y,l.x,l.y)&&Q(l.prev,l,l.next)>=0)return!1;if(l=l.prevZ,f!==t.prev&&f!==t.next&&K(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Q(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;l&&l.z>=u;){if(l!==t.prev&&l!==t.next&&K(i.x,i.y,o.x,o.y,a.x,a.y,l.x,l.y)&&Q(l.prev,l,l.next)>=0)return!1;l=l.prevZ}for(;f&&f.z<=h;){if(f!==t.prev&&f!==t.next&&K(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Q(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function F(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!X(i,o)&&Y(i,r,r.next,o)&&tt(i,o)&&tt(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),rt(r),rt(r.next),r=t=o),r=r.next}while(r!==t);return E(r)}function Z(t,e,n,r,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&N(a,s)){var c=et(a,s);return a=E(a,a.next),c=E(c,c.next),V(a,e,n,r,i,o),void V(c,e,n,r,i,o)}s=s.next}a=a.next}while(a!==t)}function G(t,e){return t.x-e.x}function D(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n;var c,u=n,h=n.x,l=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=h&&i!==r.x&&K(o<l?i:a,o,h,l,o<l?a:i,o,r.x,r.y)&&(c=Math.abs(o-r.y)/(i-r.x),tt(r,t)&&(c<f||c===f&&(r.x>n.x||r.x===n.x&&W(n,r)))&&(n=r,f=c)),r=r.next}while(r!==u);return n}(t,e)){var n=et(e,t);E(e,e.next),E(n,n.next)}}function W(t,e){return Q(t.prev,t,e.prev)<0&&Q(e.next,t,t.next)<0}function q(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function H(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function K(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function N(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Y(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(tt(t,e)&&tt(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(Q(t.prev,t,e.prev)||Q(t,e.prev,e))||X(t,e)&&Q(t.prev,t,t.next)>0&&Q(e.prev,e,e.next)>0)}function Q(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function X(t,e){return t.x===e.x&&t.y===e.y}function Y(t,e,n,r){var i=$(Q(t,e,n)),o=$(Q(t,e,r)),a=$(Q(n,r,t)),s=$(Q(n,r,e));return i!==o&&a!==s||!(0!==i||!J(t,n,e))||!(0!==o||!J(t,r,e))||!(0!==a||!J(n,t,r))||!(0!==s||!J(n,e,r))}function J(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function $(t){return t>0?1:t<0?-1:0}function tt(t,e){return Q(t.prev,t,t.next)<0?Q(t,e,t.next)>=0&&Q(t,t.prev,e)>=0:Q(t,e,t.prev)<0||Q(t,t.next,e)<0}function et(t,e){var n=new it(t.i,t.x,t.y),r=new it(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function nt(t,e,n,r){var i=new it(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function rt(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function it(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ot(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}function at(t,e,n){var r=e[0],i=e[1],o=n[0]-r,a=n[1]-i;if(0!==o||0!==a){var s=((t[0]-r)*o+(t[1]-i)*a)/(o*o+a*a);s>1?(r=n[0],i=n[1]):s>0&&(r+=o*s,i+=a*s)}return(o=t[0]-r)*o+(a=t[1]-i)*a}function st(t,e,n){if(t.length<=2)return t;var r=void 0!==e?e*e:1;return function(t,e){var n=t.length-1,r=[t[0]];return function t(e,n,r,i,o){for(var a,s=i,c=n+1;c<r;c++){var u=at(e[c],e[n],e[r]);u>s&&(a=c,s=u)}s>i&&(a-n>1&&t(e,n,a,i,o),o.push(e[a]),r-a>1&&t(e,a,r,i,o))}(t,0,n,e,r),r.push(t[n]),r}(t=n?t:function(t,e){for(var n,r,i,o,a,s=t[0],c=[s],u=1,h=t.length;u<h;u++)(o=(r=n=t[u])[0]-(i=s)[0])*o+(a=r[1]-i[1])*a>e&&(c.push(n),s=n);return s!==n&&c.push(n),c}(t,r),r)}function ct(t,e){return t[0]*e[0]+t[1]*e[1]}function ut(t,e){var n=e[0],r=e[1],i=Math.sqrt(n*n+r*r);return t[0]=n/i,t[1]=r/i,t}function ht(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function lt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function ft(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function dt(t,e){var n=e[0],r=e[1],i=e[2],o=Math.sqrt(n*n+r*r+i*i);return t[0]=n/o,t[1]=r/o,t[2]=i/o,t}function vt(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],c=n[2];return t[0]=i*c-o*s,t[1]=o*a-r*c,t[2]=r*s-i*a,t}I.deviation=function(t,e,n,r){var i=e&&e.length,o=Math.abs(ot(t,0,i?e[0]*n:t.length,n));if(i)for(var a=0,s=e.length;a<s;a++)o-=Math.abs(ot(t,e[a]*n,a<s-1?e[a+1]*n:t.length,n));var c=0;for(a=0;a<r.length;a+=3){var u=r[a]*n,h=r[a+1]*n,l=r[a+2]*n;c+=Math.abs((t[u]-t[l])*(t[h+1]-t[u+1])-(t[u]-t[h])*(t[l+1]-t[u+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},I.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&n.holes.push(r+=t[i-1].length)}return n},P.default=z;var pt=[];function gt(t,e,n,r){var i=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}(e,n),o=Math.acos(i)*r;return ht(pt,n,e,-i),function(t,e){var n=e[0],r=e[1],i=e[2],o=Math.sqrt(n*n+r*r+i*i);t[0]=n/o,t[1]=r/o,t[2]=i/o}(pt,pt),function(t,e,n){t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n}(t,e,Math.cos(o)),ht(t,t,pt,Math.sin(o)),t}function xt(t,e,n){if(n-e<3)return 0;for(var r=0,i=2*(n-1),o=2*e;o<2*n;){var a=t[i],s=t[i+1],c=t[o],u=t[o+1];i=o,o+=2,r+=a*u-c*s}return r}function yt(t,e,n){return void 0===n&&(n=2),P(t,e,n)}var mt=[],bt=[],_t=[];function wt(t,e,n,r,i,o,a,s){var c=null!=a,u=i,h=null;c&&(h=new Uint32Array(r-n));for(var l=n;l<r;l++){var f=l===r-1?n:l+1,d=l===n?r-1:l-1,v=t[2*d+1],p=t[2*l],g=t[2*l+1],x=t[2*f],y=t[2*f+1];if(mt[0]=p-t[2*d],mt[1]=g-v,bt[0]=x-p,bt[1]=y-g,ut(mt,mt),ut(bt,bt),c&&(h[l]=u),s||l!==n)if(s||l!==r-1){lt(_t,bt,mt);var m=_t[1];_t[1]=-_t[0],_t[0]=m,ut(_t,_t);var b=ct(_t,bt),_=Math.sqrt(1-b*b),w=o*Math.min(10,1/_);if(c&&1/_>a&&o*b<0){var M=p+_t[0]*o,O=g+_t[1]*o,j=Math.acos(_)/2,S=Math.tan(j)*Math.abs(o);e[2*u]=M+_t[1]*S,e[2*u+1]=O-_t[0]*S,e[2*++u]=M-_t[1]*S,e[2*u+1]=O+_t[0]*S,u++}else e[2*u]=p+_t[0]*w,e[2*u+1]=g+_t[1]*w,u++}else _t[0]=mt[1],_t[1]=-mt[0],ut(_t,_t),e[2*u]=p+_t[0]*o,e[2*u+1]=g+_t[1]*o,u++;else _t[0]=bt[1],_t[1]=-bt[0],ut(_t,_t),e[2*u]=p+_t[0]*o,e[2*u+1]=g+_t[1]*o,u++}return h}function Mt(t,e,n,r,i){var o=null!=r?[]:new Float32Array(t.length);if(wt(t,o,0,e&&e.length?e[0]:t.length/2,0,n,r,i),e)for(var a=0;a<e.length;a++){var s=e[a];wt(t,o,s,e[a+1]||t.length/2,null!=r?o.length/2:s,n,r,i)}return o}function Ot(t,e,n,r){for(var i=0;i<Math.floor((r-n)/2);i++)for(var o=0;o<e;o++){var a=(i+n)*e+o,s=(r-i-1)*e+o,c=t[a];t[a]=t[s],t[s]=c}return t}function jt(t,e){var n=t.length/2,r=0,i=e&&e.length?e[0]:n;xt(t,r,i)>0&&Ot(t,2,r,i);for(var o=1;o<(e?e.length:0)+1;o++)xt(t,r=e[o-1],i=e[o]||n)<0&&Ot(t,2,r,i)}function St(t){t.depth=t.depth||1,t.bevelSize=t.bevelSize||0,t.bevelSegments=null==t.bevelSegments?2:t.bevelSegments,t.smoothSide=t.smoothSide||!1,t.smoothBevel=t.smoothBevel||!1,t.simplify=t.simplify||0,"number"==typeof t.depth&&(t.bevelSize=Math.min(t.bevelSegments>0?t.bevelSize:0,t.depth/2)),t.bevelSize>0||(t.bevelSegments=0),t.bevelSegments=Math.round(t.bevelSegments);var e=t.boundingRect;if(t.translate=t.translate||[0,0],t.scale=t.scale||[1,1],t.fitRect){var n=null==t.fitRect.x?e.x||0:t.fitRect.x,r=null==t.fitRect.y?e.y||0:t.fitRect.y,i=t.fitRect.width,o=t.fitRect.height;null==i?null!=o?i=o/e.height*e.width:(i=e.width,o=e.height):null==o&&(o=i/e.width*e.height),t.scale=[i/e.width,o/e.height],t.translate=[(n-e.x)*t.scale[0],(r-e.y)*t.scale[1]]}}var Ct=[[0,0],[1,0],[1,1],[0,0],[1,1],[0,1]];function At(t,e,n,r,i,o){var a=e.vertices,s=e.topVertices,c=e.depth,u=e.rect,h=r-n,l=o.smoothSide?1:2,f=h*l,d=o.smoothBevel?1:2,v=Math.min(c/2,o.bevelSize),p=o.bevelSegments,g=i.vertex,x=Math.max(u.width,u.height,c);if(v>0)for(var y=[0,0,1],m=[],b=[0,0,-1],_=[],w=0,M=new Float32Array(h),O=0;O<2;O++)for(var j=0===O?c-v:v,S=0;S<=p*d;S++){for(var C=0,A=void 0,T=void 0,B=0;B<h;B++){for(var k=0;k<l;k++){var P=2*((B+k)%h+n);m[0]=a[P]-s[P],m[1]=a[P+1]-s[P+1],m[2]=0;var z=Math.sqrt(m[0]*m[0]+m[1]*m[1]);m[0]/=z,m[1]/=z;var I=(Math.floor(S/d)+S%d)/p;0===O?gt(_,y,m,I):gt(_,m,b,I);var L=0===O?I:1-I,E=v*Math.sin(L*Math.PI/2),V=z*Math.cos(L*Math.PI/2),U=v*z/Math.sqrt(E*E+V*V),R=_[0]*U+s[P],F=_[1]*U+s[P+1],Z=_[2]*U+j;if(t.position[3*i.vertex]=R,t.position[3*i.vertex+1]=F,t.position[3*i.vertex+2]=Z,(B>0||k>0)&&(C+=Math.sqrt((A-R)*(A-R)+(T-F)*(T-F))),S>0||O>0){var G=3*(i.vertex-f),D=t.position[G],W=t.position[G+1],q=t.position[G+2];M[B]+=Math.sqrt((D-R)*(D-R)+(W-F)*(W-F)+(q-Z)*(q-Z))}t.uv[2*i.vertex]=C/x,t.uv[2*i.vertex+1]=M[B]/x,A=R,T=F,i.vertex++}if(d>1&&S%d||1===d&&S>=1)for(var H=0;H<6;H++){var K=(Ct[H][0]+B*l)%f,N=Ct[H][1]+w;t.indices[i.index++]=(N-1)*f+K+g}}w++}else for(var Q=0;Q<2;Q++)for(var X=0===Q?c-v:v,Y=0,J=void 0,$=void 0,tt=0;tt<h;tt++)for(var et=0;et<l;et++){var nt=2*((tt+et)%h+n),rt=a[nt],it=a[nt+1];t.position[3*i.vertex]=rt,t.position[3*i.vertex+1]=it,t.position[3*i.vertex+2]=X,(tt>0||et>0)&&(Y+=Math.sqrt((J-rt)*(J-rt)+($-it)*($-it))),t.uv[2*i.vertex]=Y/x,t.uv[2*i.vertex+1]=X/x,J=rt,$=it,i.vertex++}for(var ot=v>0?p*d+1:1,at=0;at<h;at++)for(var st=0;st<6;st++){var ct=(Ct[st][0]+at*l)%f,ut=Ct[st][1]+ot;t.indices[i.index++]=(ut-1)*f+ct+g}}function Tt(t,e,n,r){var i=t.indices,o=t.vertices,a=t.topVertices,s=t.rect,c=t.depth;if(!(o.length<=4)){for(var u=n.vertex,h=i.length,l=0;l<h;l++)e.indices[n.index++]=u+i[l];for(var f=Math.max(s.width,s.height),d=0;d<(r.excludeBottom?1:2);d++)for(var v=0;v<a.length;v+=2){var p=a[v],g=a[v+1];e.position[3*n.vertex]=p,e.position[3*n.vertex+1]=g,e.position[3*n.vertex+2]=(1-d)*c,e.uv[2*n.vertex]=(p-s.x)/f,e.uv[2*n.vertex+1]=(g-s.y)/f,n.vertex++}if(!r.excludeBottom)for(var x=o.length/2,y=0;y<h;y+=3)for(var m=0;m<3;m++)e.indices[n.index++]=u+x+i[y+2-m]}}function Bt(t,e){for(var n=0,r=0,i=0;i<t.length;i++){var o=t[i],a=o.indices,s=o.holes,c=o.vertices.length/2,u=Math.min(o.depth/2,e.bevelSize)>0?e.bevelSegments:0;n+=a.length*(e.excludeBottom?1:2),r+=c*(e.excludeBottom?1:2);for(var h=2+2*u,l=0,f=0,d=0;d<(s?s.length:0)+1;d++){0===d?f=s&&s.length?s[0]:c:(l=s[d-1],f=s[d]||c),n+=6*(f-l)*(h-1);var v=(f-l)*(e.smoothSide?1:2);r+=v*h+(e.smoothBevel?0:u*v*2)}}for(var p={position:new Float32Array(3*r),indices:new(r>65535?Uint32Array:Uint16Array)(n),uv:new Float32Array(2*r)},g={vertex:0,index:0},x=0;x<t.length;x++)Tt(t[x],p,g,e);for(var y=0;y<t.length;y++){var m=t[y],b=m.holes,_=m.vertices.length/2,w=0,M=b&&b.length?b[0]:_;if(At(p,t[y],w,M,g,e),b)for(var O=0;O<b.length;O++)At(p,t[y],w=b[O],M=b[O+1]||_,g,e)}for(var j=0;j<p.uv.length;j++){var S=p.uv[j];p.uv[j]=S>0&&Math.round(S)===S?1:S%1}return p.normal=function(t,e){function n(t,e,n,r){t[0]=e,t[1]=n,t[2]=r}for(var r=[],i=[],o=[],a=[],s=[],c=[],u=t.length,h=new Float32Array(e.length),l=0;l<u;){var f=3*t[l++],d=3*t[l++],v=3*t[l++];n(r,e[f],e[f+1],e[f+2]),n(i,e[d],e[d+1],e[d+2]),n(o,e[v],e[v+1],e[v+2]),ft(a,r,i),ft(s,i,o),vt(c,a,s);for(var p=0;p<3;p++)h[f+p]=h[f+p]+c[p],h[d+p]=h[d+p]+c[p],h[v+p]=h[v+p]+c[p]}for(var g=0;g<h.length;)n(c,h[g],h[g+1],h[g+2]),dt(c,c),h[g++]=c[0],h[g++]=c[1],h[g++]=c[2];return h}(p.indices,p.position),p.boundingRect=t[0]&&t[0].rect,p}function kt(t,e,n){for(var r=n.lineWidth,i=t.length,o=new Float32Array(2*i),a=n.translate||[0,0],s=n.scale||[1,1],c=0,u=0;c<i;c++)o[u++]=t[c][0]*s[0]+a[0],o[u++]=t[c][1]*s[1]+a[1];xt(o,0,i)<0&&Ot(o,2,0,i);var h=[],l=[],f=n.miterLimit,d=wt(o,l,0,i,0,-r/2,f,!1);Ot(o,2,0,i);for(var v=wt(o,h,0,i,0,-r/2,f,!1),p=(h.length+l.length)/2,g=new Float32Array(2*p),x=0,y=l.length/2,m=0;m<l.length;m++)g[x++]=l[m];for(var b=0;b<h.length;b++)g[x++]=h[b];for(var _=new(p>65535?Uint32Array:Uint16Array)(3*(2*(i-1)+(p-2*i))),w=0,M=0;M<i-1;M++){var O=M+1;_[w++]=y-1-d[M],_[w++]=y-1-d[M]-1,_[w++]=v[M]+1+y,_[w++]=y-1-d[M],_[w++]=v[M]+1+y,_[w++]=v[M]+y,v[O]-v[M]==2?(_[w++]=v[M]+2+y,_[w++]=v[M]+1+y,_[w++]=y-d[O]-1):d[O]-d[M]==2&&(_[w++]=v[O]+y,_[w++]=y-1-(d[M]+1),_[w++]=y-1-(d[M]+2))}var j=n.bevelSize>0?Mt(g,[],n.bevelSize,null,!0):g,S=n.boundingRect;return{vertices:g,indices:_,topVertices:j,rect:{x:S.x*s[0]+a[0],y:S.y*s[1]+a[1],width:S.width*s[0],height:S.height*s[1]},depth:"function"==typeof n.depth?n.depth(e):n.depth,holes:[]}}function Pt(t,e){for(var n=[],r=0;r<t.length;r++){for(var i=t[r],o=[],a=i.length,s=i[a-1][0],c=i[a-1][1],u=0,h=0;h<a;h++){var l=i[h][0],f=i[h][1],d=l-s,v=f-c;(u+=Math.sqrt(d*d+v*v))>e&&(o.push(i[h]),u=0),s=l,c=f}o.length>=3&&n.push(o)}return n.length>0?n:null}function zt(t,e){for(var n=[],r=0;r<t.length;r++){var i=t[r];(i=st(i,e,!0)).length>=3&&n.push(i)}return n.length>0?n:null}function It(t,e){e=Object.assign({},e);for(var n=[1/0,1/0],r=[-1/0,-1/0],i=0;i<t.length;i++)Lt(t[i],n,r);e.boundingRect=e.boundingRect||{x:n[0],y:n[1],width:r[0]-n[0],height:r[1]-n[1]},St(e);var o=e.scale||[1,1];null==e.lineWidth&&(e.lineWidth=1),null==e.miterLimit&&(e.miterLimit=2);for(var a=[],s=0;s<t.length;s++){var c=t[s],u=e.simplify/Math.max(o[0],o[1]);u>0&&(c=st(c,u,!0)),a.push(kt(c,s,e))}return Bt(a,e)}function Lt(t,e,n){for(var r=0;r<t.length;r++)e[0]=Math.min(t[r][0],e[0]),e[1]=Math.min(t[r][1],e[1]),n[0]=Math.max(t[r][0],n[0]),n[1]=Math.max(t[r][1],n[1])}var Et=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"];function Vt(t){return void 0===t&&(t={}),(t.geometry||{}).type}function Ut(t){void 0===t&&(t={});var e=Vt(t);if(e)for(var n=0,r=Et.length;n<r;n++)if(Et[n]===e)return!0;return!1}function Rt(t){void 0===t&&(t={});var e=Vt(t);return!(!e||e!==Et[4]&&e!==Et[5])}function Ft(t){void 0===t&&(t={});var e=Vt(t);return!(!e||e!==Et[2]&&e!==Et[3])}function Zt(t){void 0===t&&(t={});var e=Vt(t);return!(!e||e!==Et[0]&&e!==Et[1])}function Gt(t){return void 0===t&&(t={}),(t.geometry||{}).coordinates||[]}function Dt(t){void 0===t&&(t={});var e=Vt(t);if(!e)return null;var n=(t.geometry||{}).coordinates;if(!n)return null;var i=[];switch(e){case"Point":i.push(n);break;case"MultiPoint":case"LineString":for(var o=0,a=n.length;o<a;o++)i.push(n[o]);break;case"MultiLineString":case"Polygon":for(var s=0,c=n.length;s<c;s++)for(var u=0,h=n[s].length;u<h;u++)i.push(n[s][u]);break;case"MultiPolygon":for(var l=0,f=n.length;l<f;l++)for(var d=0,v=n[l].length;d<v;d++)for(var p=0,g=n[l][d].length;p<g;p++)i.push(n[l][d][p])}for(var x=1/0,y=1/0,m=-1/0,b=-1/0,_=0,w=i.length;_<w;_++){var M=i[_],O=M[0],j=M[1];x=Math.min(x,O),y=Math.min(y,j),m=Math.max(m,O),b=Math.max(b,j)}return new r.Coordinate((x+m)/2,(y+b)/2)}function Wt(t){void 0===t&&(t={});var e=Vt(t);if(!e)return null;var n=t.properties||{},r=(t.geometry||{}).coordinates;if(!r)return null;var i,o=[];switch(e){case"MultiPoint":i="Point";break;case"MultiLineString":i="LineString";break;case"MultiPolygon":i="Polygon"}if(i)for(var a=0,s=r.length;a<s;a++)o.push({type:"Feature",geometry:{type:i,coordinates:r[a]},properties:n});else o.push(t);return o}function qt(t,e,n){var o=[],a=[];if(Array.isArray(t)&&t[0]instanceof i.Vector3)for(var s=0,c=t.length;s<c;s++){var u=t[s];o.push(u.x,u.y,u.z),a.push(u)}else{var h,l;Array.isArray(t)&&(t=new r.LineString(t)),Ut(t)?(h=Gt(t),l=Dt(t)):(h=t.getCoordinates(),l=t.getCenter());for(var f=e.coordinateToVector3(n||l),d=0,v=h.length;d<v;d++){var p=h[d];Array.isArray(p)&&(p=new r.Coordinate(p));var g=e.coordinateToVector3(p,0).sub(f);o.push(g.x,g.y,g.z),a.push(g)}}return{positions:o,positionsV:a}}function Ht(t,e,n,r){for(var i=[],o=[],a=[],s=0,c=t.length;s<c;s++)for(var u=t[s],h=0,l=u.length;h<l;h++){var f=u[h];a.length>0?f.join(",").toString()!==a[a.length-1].join(",").toString()&&a.push(f):a.push(f)}for(var d=0,v=a.length;d<v;d++){var p,g=a[d],x=g.join(",").toString();p=n&&n[x]?n[x]:e.coordinateToVector3(g,0).sub(r),o.push(p),i.push(p.x,p.y,p.z)}return{positions:i,positionsV:o,lnglats:a}}function Kt(t,e,n,r,i){void 0===e&&(e=1),void 0===n&&(n=1);for(var o=qt(t,r,i).positionsV,a=[],s=0,c=o.length;s<c;s++){var u=o[s];a.push([u.x,u.y])}var h=It([a],{lineWidth:e,depth:n});return{position:h.position,normal:h.normal,indices:h.indices,uv:h.uv}}var Nt={altitude:0,colors:null},Qt=function(t){function e(e,n,o,a){var s;n=r.Util.extend({},Nt,n,{layer:a,lineString:e}),(s=t.call(this)||this)._initOptions(n);var c=qt(e,a).positions,u=new i.BufferGeometry;f(u,"position",new i.Float32BufferAttribute(c,3));var h=function(t){var e=[];return t&&t.length&&t.forEach((function(t){t=t instanceof i.Color?t:new i.Color(t),e.push(t.r,t.g,t.b)})),e}(n.colors);h&&h.length&&(f(u,"color",new i.Float32BufferAttribute(h,3)),o.vertexColors=i.VertexColors),s._createLine(u,o);var l=n.altitude,d=Ut(e)?Dt(e):e.getCenter(),v=a.distanceToVector3(l,l).x,p=a.coordinateToVector3(d,v);return s.getObject3d().position.copy(p),s}return c(e,t),e}(O),Xt={width:3,height:1,altitude:0},Yt=function(t){function e(e,n,o,a){var s;n=r.Util.extend({},Xt,n,{layer:a,lineString:e}),(s=t.call(this)||this)._initOptions(n);var c=n.height,u=n.width;n.height=a.distanceToVector3(c,c).x,n.width=a.distanceToVector3(u,u).x;var h=function(t,e,n,r,o){void 0===e&&(e=1),void 0===n&&(n=1);for(var a=qt(t,r,void 0).positionsV,s=[],c=0,u=a.length;c<u;c++){var h=a[c];s.push([h.x,h.y])}var l=It([s],{lineWidth:e,depth:n}),d=l.indices,v=l.position,p=l.normal,g=l.uv,x=new i.BufferGeometry;return f(x,"position",new i.Float32BufferAttribute(v,3)),f(x,"normal",new i.Float32BufferAttribute(p,3)),f(x,"uv",new i.Float32BufferAttribute(g,2)),x.setIndex(new i.Uint32BufferAttribute(d,1)),x}(e,n.width,n.height,a);s._createMesh(h,o);var l=n.altitude,d=Ut(e)?Dt(e):e.getCenter(),v=a.distanceToVector3(l,l).x,p=a.coordinateToVector3(d,v);return s.getObject3d().position.copy(p),s}return c(e,t),e}(O);function Jt(t,e,n,r,i){var o=ee(t,n,r);if(!o)return null;i?(null==i[e]&&(i[e]=n.distanceToVector3(e,e).x),e=i[e]):e=n.distanceToVector3(e,e).x;var a=function(t,e){e=Object.assign({},e);for(var n=[1/0,1/0],r=[-1/0,-1/0],i=0;i<t.length;i++)Lt(t[i][0],n,r);e.boundingRect=e.boundingRect||{x:n[0],y:n[1],width:r[0]-n[0],height:r[1]-n[1]},St(e);for(var o=[],a=e.translate||[0,0],s=e.scale||[1,1],c=e.boundingRect,u={x:c.x*s[0]+a[0],y:c.y*s[1]+a[1],width:c.width*s[0],height:c.height*s[1]},h=Math.min(c.width,c.height)/1e5,l=0;l<t.length;l++){var f=Pt(t[l],h);if(f){var d=e.simplify/Math.max(s[0],s[1]);if(d>0&&(f=zt(f,d)),f){for(var v=P.flatten(f),p=v.vertices,g=v.holes,x=v.dimensions,y=0;y<p.length;)p[y]=p[y++]*s[0]+a[0],p[y]=p[y++]*s[1]+a[1];if(jt(p,g),2!==x)throw new Error("Only 2D polygon points are supported");var m=e.bevelSize>0?Mt(p,g,e.bevelSize,null,!0):p,b=yt(m,g,x);o.push({indices:b,vertices:p,topVertices:m,holes:g,rect:u,depth:"function"==typeof e.depth?e.depth(l):e.depth})}}}return Bt(o,e)}(o,{depth:e});return{position:a.position,normal:a.normal,uv:a.uv,indices:a.indices}}function $t(t,e,n){for(var r=t.attributes.position.array,o=r.length,a=e instanceof i.Color?e:new i.Color(e),s=new i.Color(n),c=[],u=0;u<o;u+=3)r[u+2]>0?c.push(s.r,s.g,s.b):c.push(a.r,a.g,a.b);return f(t,"color",new i.Float32BufferAttribute(c,3,!0)),c}function te(t){void 0===t&&(t=[]);for(var e=1/0,n=1/0,i=-1/0,o=-1/0,a=0,s=t.length;a<s;a++){var c=t[a],u=void 0,h=void 0;Array.isArray(c)?(u=c[0],h=c[1]):c instanceof r.Coordinate&&(u=c.x,h=c.y),e=Math.min(e,u),n=Math.min(n,h),i=Math.max(i,u),o=Math.max(o,h)}return new r.Coordinate((e+i)/2,(n+o)/2)}function ee(t,e,n,i){if(void 0===i&&(i=!1),!t)return null;var o=[];if(t instanceof r.MultiPolygon)o=t.getGeometries().map((function(r){return ne(r,e,n||t.getCenter(),i)}));else if(t instanceof r.Polygon){var a=ne(t,e,n||t.getCenter(),i);o.push(a)}else if(Rt(t)){var s=Dt(t);if(function(t){void 0===t&&(t={});var e=Vt(t);return!!(e&&e.indexOf("Multi")>-1)}(t))for(var c=Wt(t),u=0,h=c.length;u<h;u++)o.push(ne(c[u],e,n||s,i));else{var l=ne(t,e,n||s,i);o.push(l)}}return o}function ne(t,e,n,r){var i,o;if(void 0===r&&(r=!1),Rt(t)){var a=Gt(t);i=a[0],o=a.slice(1,a.length),n=n||Dt(t)}else i=t.getShell(),o=t.getHoles(),n=n||t.getCenter();var s,c=e.coordinateToVector3(n);s=r?new Float32Array(2*i.length):[];for(var u=0,h=i.length;u<h;u++){var l=e.coordinateToVector3(i[u]).sub(c);if(r){var f=2*u;s[f]=l.x,s[f+1]=l.y}else s.push([l.x,l.y])}var d=[r?s.buffer:s];if(o&&o.length>0)for(var v=0,p=o.length;v<p;v++){for(var g=r?new Float32Array(2*o[v].length):[],x=0,y=o[v].length;x<y;x++){var m=e.coordinateToVector3(o[v][x]).sub(c);if(r){var b=2*x;g[b]=m.x,g[b+1]=m.y}else g.push([m.x,m.y])}d.push(r?g.buffer:g)}return d}var re={altitude:0,height:1,topColor:null,bottomColor:"#2d2f61"},ie=function(t){function e(e,n,o,a){var s;n=r.Util.extend({},re,n,{layer:a,polygon:e}),(s=t.call(this)||this)._initOptions(n);var c=n.topColor,u=n.bottomColor,h=n.altitude,l=function(t,e,n,r){var o=Jt(t,e,n,void 0),a=o.position,s=o.normal,c=o.uv,u=o.indices,h=new Float32Array(a.length);h.fill(1,0,a.length);var l=new i.BufferGeometry;return f(l,"color",new i.BufferAttribute(h,3)),f(l,"normal",new i.BufferAttribute(s,3)),f(l,"position",new i.BufferAttribute(a,3)),f(l,"uv",new i.BufferAttribute(c,2)),l.setIndex(new i.Uint32BufferAttribute(u,1)),l}(e,n.height,a),d=Rt(e)?Dt(e):e.getCenter();c&&!o.map&&($t(l,u,c),o.vertexColors=i.VertexColors),s._createMesh(l,o);var v=a.distanceToVector3(h,h).x,p=a.coordinateToVector3(d,v);return s.getObject3d().position.copy(p),s}return c(e,t),e}(O),oe={altitude:0,coordinate:null},ae=function(t){function e(e,n,i){var o;void 0===n&&(n={}),n.coordinate||(console.warn("coordinate is null,it is important to locate the model"),n.coordinate=i.getMap().getCenter()),n=r.Util.extend({},oe,n,{layer:i,model:e}),(o=t.call(this)||this)._initOptions(n),o._createGroup(),o.getObject3d().add(e);var a=n.altitude,s=n.coordinate,c=i.distanceToVector3(a,a).x,u=i.coordinateToVector3(s,c);return o.getObject3d().position.copy(u),o}return c(e,t),e}(O),se=Math.PI/180;function ce(t){return t*se}function ue(t,e){if(!t||!e)return 0;Array.isArray(t)||(t=t.toArray()),Array.isArray(e)||(e=e.toArray());var n=ce(t[1]),r=ce(e[1]),i=n-r,o=ce(t[0])-ce(e[0]);return n=2*Math.asin(Math.sqrt(Math.pow(Math.sin(i/2),2)+Math.cos(n)*Math.cos(r)*Math.pow(Math.sin(o/2),2))),n*=6378137,Math.round(1e5*n)/1e5}function he(t,e){var n=t.c1,r=t.c2,i=e/t.len;return[n[0]+i*(r[0]-n[0]),n[1]+i*(r[1]-n[1])]}function le(t,e,n,r){var i=e.length;t.attributes.normal.count=i,t.attributes.position.count=i;for(var o=t.attributes.position.array,a=t.attributes.normal.array,s=0;s<i;s++)o[s]=e[s],a[s]=n[s];t.index.count=r.length;for(var c=0,u=r.length;c<u;c++)t.index.array[c]=r[c]}var fe,de,ve={trail:5,chunkLength:50,width:2,height:1,speed:1,altitude:0,interactive:!1},pe=function(t){function e(e,n,o,a){var s;n=r.Util.extend({},ve,n,{layer:a,lineString:e}),(s=t.call(this)||this)._initOptions(n);var c,u,h=n.width,l=n.height,d=n.altitude,v=n.speed,p=n.chunkLength,g=n.trail;Ut(e)?(c=Dt(e),u=Gt(e)):(c=e.getCenter(),u=e);for(var x=function(t,e){void 0===e&&(e=10),e=Math.max(e,1),Array.isArray(t)||(t=t.getCoordinates().map((function(t){return t.toArray()})));for(var n=t.length,r=[],i=0,o=0;o<n-1;o++){var a=ue(t[o],t[o+1]),s=Math.floor(a);r.push({c1:t[o],len:s,c2:t[o+1]}),i+=s}if(i<=e)return r.map((function(t){return[t.c1,t.c2]}));if(1===r.length&&r[0].len<=e)return[[r[0].c1,r[0].c2]];for(var c,u=r.length,h=0,l=0,f=[],d=[r[0].c1];h<u;){var v=r[h],p=v.len,g=v.c2;if((l+=p)<e&&(d.push(g),h===u-1&&f.push(d),h++),l===e&&(d.push(g),l=0,f.push(d),d=[g],h++),l>e){var x=p-l+e;c=he(r[h],x),d.push(c),f.push(d),l=0,r[h].c1=c,r[h].len=p-x,(d=[]).push(c)}}return f}(u,p),y=a.coordinateToVector3(e.getCenter()),m={},b=0,_=x.length;b<_;b++)for(var w=x[b],M=0,O=w.length;M<O;M++){var j=w[M],S=j.join(",").toString();m[S]||(m[S]=a.coordinateToVector3(j).sub(y))}var C=Ht(x.slice(0,1),a,m,y).positionsV,A=new i.BufferGeometry,T=new Float32Array(3e3),B=new Float32Array(3e3),k=new Uint16Array(1e3);f(A,"position",new i.BufferAttribute(T,3)),f(A,"normal",new i.BufferAttribute(B,3)),A.setIndex(new i.BufferAttribute(k,1));var P=a.distanceToVector3(h,h).x,z=a.distanceToVector3(l,l).x,I=Kt(C,P,z,a);le(A,I.position,I.normal,I.indices),s._createMesh(A,o);var L=a.distanceToVector3(d,d).x,E=a.coordinateToVector3(c,L);return s.getObject3d().position.copy(E),s._params={index:0,chunkLines:x,geometries:[],layer:a,trail:Math.max(1,g),lineWidth:P,depth:z,speed:Math.min(1,v),idx:0,loaded:!1,positionMap:m,centerPt:y},s._init(s._params),s}c(e,t);var n=e.prototype;return n._init=function(t){for(var e=t.layer,n=t.trail,r=t.lineWidth,i=t.depth,o=t.chunkLines,a=t.positionMap,s=t.centerPt,c=o.length,u=[],h=0;h<c;h++){var l=Ht(o.slice(h,h+n),e,a,s).positionsV;u.push(Kt(l,r,i,e))}this._params.geometries=u,this._params.loaded=!0},n._animation=function(){var t=this._params,e=t.index,n=t.geometries,r=t.speed,i=t.idx,o=t.chunkLines,a=t.trail,s=t.lineWidth,c=t.depth,u=t.layer,h=t.positionMap,l=t.centerPt;if(t.loaded){var f=Math.round(e);if(f>i){this._params.idx++;var d=n[f];d||(d=Kt(Ht(o.slice(f,f+a),u,h,l).positionsV,s,c,u),n[f]=d),le(this.getObject3d().geometry,d.position,d.normal,d.indices),this.getObject3d().geometry.attributes.position.needsUpdate=!0,this.getObject3d().geometry.attributes.normal.needsUpdate=!0,this.getObject3d().geometry.index.needsUpdate=!0}e>=o.length-1&&(this._params.index=-1,this._params.idx=-1),this._params.index+=r}},e}(O),ge=["click","mousemove","mousedown","mouseup","dblclick","contextmenu"].join(" ").toString(),xe=function(t){return function(t){function e(){return t.apply(this,arguments)||this}c(e,t);var n=e.prototype;return n._initBaseObjectsEvent=function(t){if(t&&Array.isArray(t)&&t.length)for(var e=0,n=t.length;e<n;e++)this._proxyEvent(t[e]);return this},n._proxyEvent=function(t){var e=this;t.on("add",(function(t){e._showGeometry(t.target,!0)})),t.on("remove",(function(t){e._showGeometry(t.target,!1)})),t.on("mouseout",(function(t){e._mouseover=!1,e.fire("mouseout",Object.assign({},t,{target:e,selectMesh:e.getSelectMesh?e.getSelectMesh():null}))})),t.on(ge,(function(t){e.fire(t.type,Object.assign({},t,{target:e,selectMesh:e.getSelectMesh?e.getSelectMesh():null}))}))},n._getHideGeometryIndex=function(t){for(var e=[],n=0,r=0,i=this._geometriesAttributes.length;r<i;r++)!0===this._geometriesAttributes[r].hide&&(e.push(r),n+=this._geometriesAttributes[r][t].count);return{indexs:e,count:n}},n._updateAttribute=function(t,e){for(var n=this._getHideGeometryIndex(e).indexs,r=this._geometryCache.attributes[e].array,o=r.length,a=0;a<o;a++)t.array[a]=r[a];var s=NaN;this.getObject3d()instanceof i.LineSegments&&(s=0);for(var c=0;c<n.length;c++)for(var u=this._geometriesAttributes[n[c]][e],h=u.end,l=u.start;l<h;l++)t.array[l]=s;return this},n._showGeometry=function(t,e){var n;if(t&&(n=t.getOptions().index),null!=n){var r=this._geometriesAttributes[n];if(r.hide===e)return this;r.hide=e;var i=this.getObject3d().geometry;this._updateAttribute(i.attributes.position,"position"),i.attributes.position.needsUpdate=!0,this.isHide=e}return this},n.getSelectMesh=function(){return{data:null,baseObject:null}},e}(t)};function ye(){return r.worker||console.error("maptalks.worker is not defined,You can't use ThreeVectorTileLayer"),de||(de=new fe("maptalks.three")),de}r.worker&&(fe=function(t){function e(){return t.apply(this,arguments)||this}c(e,t);var n=e.prototype;return n.test=function(t,e){this.send(t,null,e)},n.pushQueue=function(t){void 0===t&&(t={});var e,n=t.type,r=t.callback,i=t.key;"Polygon"===n&&(e=function(t,e,n){void 0===t&&(t=[]);for(var r=t.length,i=[],o=[],a={},s=0;s<r;s++){for(var c=t[s],u=ee(c,n,e,!0),h=0,l=u.length;h<l;h++)for(var f=u[h],d=0,v=f.length;d<v;d++)o.push(f[d]);var p=(Rt(c)?c.properties:c.getProperties()||{}).height||1;null==a[p]&&(a[p]=n.distanceToVector3(p,p).x),i.push({data:u,height:p=a[p]})}return{datas:i,transfer:o}}(t.data,t.center,t.layer)),this.send({type:n,datas:e.datas},e.transfe,(function(t,e){t&&console.error(t),e.key=i,r(e)}))},e}(r.worker.Actor));var me={altitude:0,height:1,topColor:null,bottomColor:"#2d2f61"},be=function(t){function e(e,n,o,a){var s;Array.isArray(e)||(e=[e]);var c=e.length;0===c&&console.error("polygons is empty");for(var h=1/0,l=1/0,d=-1/0,v=-1/0,p=0;p<c;p++){var g=e[p],x=g.getCenter?g.getCenter():Dt(g),y=void 0,m=void 0;Array.isArray(x)?(y=x[0],m=x[1]):x instanceof r.Coordinate&&(y=x.x,m=x.y),h=Math.min(h,y),l=Math.min(l,m),d=Math.max(d,y),v=Math.max(v,m)}var b,_=new r.Coordinate((h+d)/2,(l+v)/2),w=(n=r.Util.extend({},me,n,{layer:a,polygons:e,coordinate:_})).topColor,M=n.bottomColor,O=n.altitude,S=[],C=[],A=[];if(n.asynchronous){var T=ye();b=new i.BoxBufferGeometry(1e-6,1e-6,1e-6*5),T.pushQueue({type:"Polygon",layer:a,key:n.key,center:_,data:e,callback:function(t){var e=t.geometriesAttributes;s._faceMap=t.faceMap,s._geometriesAttributes=e;var n=function(t){var e=t.position,n=t.normal,r=t.uv,o=t.indices,a=new Float32Array(e.length);a.fill(1,0,e.length);var s=new i.BufferGeometry;return f(s,"color",new i.BufferAttribute(a,3)),f(s,"normal",new i.BufferAttribute(new Float32Array(n),3)),f(s,"position",new i.BufferAttribute(new Float32Array(e),3)),f(s,"uv",new i.BufferAttribute(new Float32Array(r),2)),s.setIndex(new i.BufferAttribute(new Uint32Array(o),1)),s}(t);w&&!o.map&&($t(n,M,w),o.vertexColors=i.VertexColors),s.getObject3d().geometry.dispose(),s.getObject3d().geometry=n,s.getObject3d().material.needsUpdate=!0,s._geometryCache=n.clone(),s._fire("workerload",{target:u(s)})}})}else{for(var B=[],k=0,P=0,z=0,I=0,L={},E=0;E<c;E++){var V=e[E],U=(Rt(V)?V.properties:V.getProperties()||{}).height||1,R=Jt(V,U,a,_,L);B.push(R);var F=R.position,Z=R.normal,G=R.uv,D=R.indices.length/3;C[E]=[k+1,k+D],k+=D;var W=F.length/3,q=Z.length/3,H=G.length/2;A[E]={position:{count:W,start:P,end:P+3*W},normal:{count:q,start:z,end:z+3*q},uv:{count:H,start:I,end:I+2*H},hide:!1},P+=3*W,z+=3*q,I+=2*H}b=j(B),w&&!o.map&&($t(b,M,w),o.vertexColors=i.VertexColors)}(s=t.call(this)||this)._initOptions(n),s._createMesh(b,o);var K=a.distanceToVector3(O,O).x,N=a.coordinateToVector3(_,K);return s.getObject3d().position.copy(N),s._faceMap=C,s._baseObjects=S,s._datas=e,s._geometriesAttributes=A,s.faceIndex=null,s._geometryCache=b.clone(),s.isHide=!1,s._initBaseObjectsEvent(S),s}c(e,t);var n=e.prototype;return n.getSelectMesh=function(){var t=this._getIndex();if(null!=t){if(!this._baseObjects[t]){var e=this._datas[t],n=Object.assign({},this.options,Rt(e)?e.properties:e.getProperties(),{index:t});this._baseObjects[t]=new ie(e,n,this.getObject3d().material,this.getLayer()),this._proxyEvent(this._baseObjects[t])}return{data:this._datas[t],baseObject:this._baseObjects[t]}}},n._getIndex=function(t){if(null==t&&(t=this.faceIndex),null!=t)for(var e=0,n=this._faceMap.length;e<n;e++){var r=this._faceMap[e];if(r[0]<=t&&t<r[1])return e}},e}(xe(O));function _e(t,e,n){var r=t.project(n),i=e.width/2,o=e.height/2;return{x:Math.round(r.x*i+i),y:Math.round(-r.y*o+o)}}var we={altitude:0,height:0},Me=new i.Vector3,Oe=function(t){function e(e,n,o,a){var s;n=r.Util.extend({},we,n,{layer:a,coordinate:e}),s=t.call(this)||this;var c=n.height,u=n.altitude,h=n.color,l=[],d=[];h&&(h=h instanceof i.Color?h:new i.Color(h),d.push(h.r,h.g,h.b));var v=a.distanceToVector3(c,c).x,p=a.coordinateToVector3(e,v);l.push(0,0,p.z);var g=new i.BufferGeometry;f(g,"position",new i.Float32BufferAttribute(l,3,!0)),d.length&&f(g,"color",new i.Float32BufferAttribute(d,3,!0)),n.positions=p,s._initOptions(n),s._createPoints(g,o);var x=a.distanceToVector3(u,u).x,y=new i.Vector3(p.x,p.y,x);return s.getObject3d().position.copy(y),s}return c(e,t),e.prototype.identify=function(t){var e=this.getLayer(),n=this.getMap().getSize(),r=this.getLayer().getCamera(),i=this.getOptions().positions,o=this.getOptions().altitude,a=this.getObject3d().material.size,s=this.getMap().coordToContainerPoint(t),c=e.distanceToVector3(o,o).x;Me.x=i.x,Me.y=i.y,Me.z=i.z+c;var u=_e(Me,n,r);return Math.sqrt(Math.pow(s.x-u.x,2)+Math.pow(s.y-u.y,2))<=a/2},e}(O);function je(t,e){var n=e[0],r=e[1];return t.minx<=n&&n<=t.maxx&&t.miny<=r&&r<=t.maxy}var Se=function(){function t(t,e,n,r){this.minlng=t,this.minlat=e,this.maxlng=n,this.maxlat=r,this.minx=1/0,this.miny=1/0,this.maxx=-1/0,this.maxy=-1/0,this.coordinates=[],this.positions=[],this.indexs=[],this.key=null}var e=t.prototype;return e.updateBBoxPixel=function(t){var e=1/0,n=1/0,i=-1/0,o=-1/0,a=this.minlng,s=this.minlat,c=this.maxlng,u=this.maxlat;return[[a,s],[a,u],[c,s],[c,u]].map((function(t){return new r.Coordinate(t)})).map((function(e){return t.coordToContainerPoint(e)})).forEach((function(t){e=Math.min(e,t.x),n=Math.min(n,t.y),i=Math.max(i,t.x),o=Math.max(o,t.y)})),this.minx=e,this.miny=n,this.maxx=i,this.maxy=o,this},e.containsCoordinate=function(t){var e,n;return Array.isArray(t)?(e=t[0],n=t[1]):t instanceof r.Coordinate&&(e=t.x,n=t.y),!!(this.minlng<=e&&e<=this.maxlng&&this.minlat<=n&n<=this.maxlat)},e.isRecCross=function(t,e){var n=t.x,r=t.y,i={minx:n-e/2,miny:r-e/2,maxx:n+e/2,maxy:r+e/2},o=i.minx,a=i.miny,s=i.maxx,c=i.maxy;return!!(je(this,[o,a])||je(this,[o,c])||je(this,[s,a])||je(this,[s,c])||je(i,[this.minx,this.miny])||je(i,[this.minx,this.maxy])||je(i,this.maxx)||je(i,this.maxx))},t.initGrids=function(e,n,r,i){for(var o=[],a=(r-e)/30,s=(i-n)/30,c=e,u=n,h=0;h<30;h++){c=e+h*a;for(var l=0;l<30;l++){var f=new t(c,u=n+l*s,c+a,u+s);f.key=l+"-"+h,o.push(f)}}return o},t}(),Ce={altitude:0},Ae=new i.Vector3,Te=function(t){function e(e,n,o,a){var s;Array.isArray(e)||(e=[e]),n=r.Util.extend({},Ce,n,{layer:a,points:e});for(var c=1/0,u=1/0,h=-1/0,l=-1/0,d=0,v=e.length;d<v;d++){var p=e[d].coordinate,g=void 0,x=void 0;Array.isArray(p)?(g=p[0],x=p[1]):p instanceof r.Coordinate&&(g=p.x,x=p.y),c=Math.min(c,g),u=Math.min(u,x),h=Math.max(h,g),l=Math.max(l,x)}for(var y=a.coordinateToVector3([(c+h)/2,(u+l)/2]),m=Se.initGrids(c,u,h,l),b=m.length,_=[],w=[],M=[],O=[],j=[],S=0,C=e.length;S<C;S++){var A=e[S],T=A.coordinate,B=A.height,k=A.color;k&&(k=k instanceof i.Color?k:new i.Color(k),M.push(k.r,k.g,k.b));var P=a.distanceToVector3(B,B).x,z=a.coordinateToVector3(T,P),I=z.clone().sub(y);_.push(I.x,I.y,I.z),w.push(z),j[S]={position:{count:1,start:3*S,end:3*S+3},hide:!1};for(var L=0;L<b;L++)if(m[L].containsCoordinate(T)){m[L].positions.push(z),m[L].indexs.push(S);break}}var E=new i.BufferGeometry;f(E,"position",new i.Float32BufferAttribute(_,3,!0)),M.length&&f(E,"color",new i.Float32BufferAttribute(M,3,!0)),n.positions=w,(s=t.call(this)||this)._initOptions(n),s._createPoints(E,o);var V=n.altitude,U=a.distanceToVector3(V,V).x,R=y.clone();return R.z=U,s.getObject3d().position.copy(R),s._baseObjects=O,s._datas=e,s.faceIndex=null,s._geometriesAttributes=j,s._geometryCache=E.clone(),s.isHide=!1,s._initBaseObjectsEvent(O),s._grids=m,s._bindMapEvents(),s}c(e,t);var n=e.prototype;return n._bindMapEvents=function(){var t=this,e=this.getMap();this.on("add",(function(){t._updateGrids(),e.on("zoomstart zooming zoomend movestart moving moveend pitch rotate",t._updateGrids,t)})),this.on("remove",(function(){e.off("zoomstart zooming zoomend movestart moving moveend pitch rotate",t._updateGrids,t)}))},n._updateGrids=function(){var t=this.getMap();this._grids.forEach((function(e){e.indexs.length&&e.updateBBoxPixel(t)}))},n.getSelectMesh=function(){var t=this.faceIndex;if(null!=t){if(!this._baseObjects[t]){var e=this._datas[t];this._baseObjects[t]=new Oe(e.coordinate,{height:e.height,index:t,color:e.color},this.getObject3d().material,this.getLayer()),this._proxyEvent(this._baseObjects[t])}return{data:this._datas[t],baseObject:this._baseObjects[t]}}},n.identify=function(t){var e=this.getLayer(),n=this.getMap().getSize(),r=this.getLayer().getCamera(),i=this.getOptions().altitude,o=this.getMap(),a=e.distanceToVector3(i,i).x,s=this.getObject3d().material.size,c=o.coordToContainerPoint(t),u=[];if(this._grids.forEach((function(t){t.indexs.length&&t.isRecCross(c,s)&&u.push(t)})),u.length<1)return!1;for(var h=0,l=u.length;h<l;h++)for(var f=0,d=u[h].positions.length;f<d;f++){var v=u[h].positions[f];Ae.x=v.x,Ae.y=v.y,Ae.z=v.z+a;var p=_e(Ae,n,r);if(Math.sqrt(Math.pow(c.x-p.x,2)+Math.pow(c.y-p.y,2))<=s/2)return this.faceIndex=u[h].indexs[f],!0}return!1},e}(xe(O)),Be={coordinate:null,radius:10,height:100,radialSegments:6,altitude:0,topColor:null,bottomColor:"#2d2f61"},ke=function(t){function e(e,n,o,a){var s;Array.isArray(e)||(e=[e]);for(var c=e.length,u=[],h=[],l=[],f=[],d=0,v=0,p=0,g=0,x=0;x<c;x++){var y=r.Util.extend({index:x},Be,e[x]),m=y.radius,b=y.radialSegments,_=y.altitude,w=y.topColor,M=y.bottomColor,O=y.height,S=y.coordinate,C=a.distanceToVector3(m,m).x,B=a.distanceToVector3(O,O).x,P=a.distanceToVector3(_,_).x,z=A({radius:C,height:B,radialSegments:b},!1);w&&!o.map&&(T(z,M,w,"z",B/2),o.vertexColors=i.VertexColors);for(var I=a.coordinateToVector3(S),L=z.attributes.position.array,E=0,V=L.length;E<V;E+=3)L[E+2]+=P,L[E]+=I.x,L[E+1]+=I.y,L[E+2]+=I.z;u.push(z);var U=new k(S,y,o,a);h.push(U);var R=z.index.count/3;f[x]=[d+1,d+R],d+=R;var F=z.attributes.position.count,Z=z.attributes.normal.count,G=z.attributes.uv.count;l[x]={position:{count:F,start:v,end:v+3*F},normal:{count:Z,start:p,end:p+3*Z},uv:{count:G,start:g,end:g+2*G},hide:!1},v+=3*F,p+=3*Z,g+=2*G}s=t.call(this)||this,n=r.Util.extend({},{altitude:0,layer:a,points:e},n),s._initOptions(n);var D=function(t){for(var e=[],n=[],r=0,i=t.length;r<i;r++){var o=t[r].attributes,a=o.color,s=o.normal,c=o.position,u=o.uv,h=t[r].index;if(a)for(var l=0,f=a.array.length;l<f;l++)n.push(a.array[l]);e.push({normal:s.array,uv:u.array,position:c.array,indices:h.array})}var d=j(e);if(n.length)for(var v=0,p=n.length;v<p;v++)d.attributes.color.array[v]=n[v];return d}(u);return s._createMesh(D,o),s._faceMap=f,s._baseObjects=h,s._datas=e,s._geometriesAttributes=l,s.faceIndex=null,s._geometryCache=D.clone(),s.isHide=!1,s._colorMap={},s._initBaseObjectsEvent(h),s._setPickObject3d(),s._init(),s}c(e,t);var n=e.prototype;return n.getSelectMesh=function(){var t=this._getIndex();if(null!=t)return{data:this._datas[t],baseObject:this._baseObjects[t]}},n._getIndex=function(t){return null==t&&(t=this.faceIndex||this.index),t},n._init=function(){var t=this,e=this.getLayer().getPick();this.on("add",(function(){e.add(t.pickObject3d)})),this.on("remove",(function(){e.remove(t.pickObject3d)}))},n._setPickObject3d=function(){for(var t=this.getObject3d().geometry.clone(),e=this.getLayer().getPick(),n=this._geometriesAttributes,r=[],o=0,a=n.length;o<a;o++){var s=e.getColor(),c=s.getHex();this._colorMap[c]=o;var u=n[o].position.count;this._datas[o].colorIndex=c;for(var h=0;h<u;h++)r.push(s.r,s.g,s.b)}f(t,"color",new i.Float32BufferAttribute(r,3,!0));var l=new i.MeshBasicMaterial;l.vertexColors=i.VertexColors;var d=e.getColor().getHex(),v=new i.Mesh(t,l);v.position.copy(this.getObject3d().position),v._colorIndex=d,this.setPickObject3d(v)},n.identify=function(t){return this.picked},e}(xe(O)),Pe={width:3,height:1,altitude:0},ze=function(t){function e(e,n,i,o){var a;Array.isArray(e)||(e=[e]);for(var s=[],c=e.length,u=0;u<c;u++){var h=e[u];s.push(Ut(h)?Dt(h):h.getCenter())}for(var l=te(s),f=[],d=[],v=0,p=[],g=[],x=0,y=0,m=0;m<c;m++){var b=e[m],_=r.Util.extend({},Pe,Ut(b)?b.properties:b.getProperties(),{index:m}),w=_.height,M=_.width,O=Kt(b,o.distanceToVector3(M,M).x,o.distanceToVector3(w,w).x,o,l);f.push(O);var S=new Yt(b,_,i,o);d.push(S);var C=O.position,A=O.normal,T=O.indices.length/3;p[m]=[v+1,v+T],v+=T;var B=C.length/3,k=A.length/3;g[m]={position:{count:B,start:x,end:x+3*B},normal:{count:k,start:y,end:y+3*k},hide:!1},x+=3*B,y+=3*k}var P=j(f);n=r.Util.extend({},Pe,n,{layer:o,lineStrings:e,coordinate:l}),(a=t.call(this)||this)._initOptions(n),a._createMesh(P,i);var z=n.altitude,I=o.distanceToVector3(z,z).x,L=o.coordinateToVector3(l,I);return a.getObject3d().position.copy(L),a._faceMap=p,a._baseObjects=d,a._datas=e,a._geometriesAttributes=g,a.faceIndex=null,a._geometryCache=P.clone(),a.isHide=!1,a._colorMap={},a._initBaseObjectsEvent(d),a._setPickObject3d(),a._init(),a}c(e,t);var n=e.prototype;return n.getSelectMesh=function(){var t=this._getIndex();if(null!=t)return{data:this._datas[t],baseObject:this._baseObjects[t]}},n._getIndex=function(t){return null==t&&(t=this.faceIndex||this.index),t},n._init=function(){var t=this,e=this.getLayer().getPick();this.on("add",(function(){e.add(t.pickObject3d)})),this.on("remove",(function(){e.remove(t.pickObject3d)}))},n._setPickObject3d=function(){for(var t=this.getObject3d().geometry.clone(),e=this.getLayer().getPick(),n=this._geometriesAttributes,r=[],o=0,a=n.length;o<a;o++){var s=e.getColor(),c=s.getHex();this._colorMap[c]=o;var u=n[o].position.count;this._datas[o].colorIndex=c;for(var h=0;h<u;h++)r.push(s.r,s.g,s.b)}f(t,"color",new i.Float32BufferAttribute(r,3,!0));var l=new i.MeshBasicMaterial;l.vertexColors=i.VertexColors;var d=e.getColor().getHex(),v=new i.Mesh(t,l);v.position.copy(this.getObject3d().position),v._colorIndex=d,this.setPickObject3d(v)},n.identify=function(t){return this.picked},e}(xe(O)),Ie={altitude:0,colors:null},Le=function(t){function e(e,n,o,a){var s;Array.isArray(e)||(e=[e]);for(var c=[],u=e.length,h=0;h<u;h++){var l=e[h];c.push(Ft(l)?Dt(l):l.getCenter())}var d=te(c);n=r.Util.extend({},Ie,n,{layer:a,lineStrings:e,coordinate:d});for(var v=[],p=0,g=[],x=[],y=0,m=[],b=0;b<u;b++){for(var _=qt(e[b],a,d).positionsV,w=0,M=_.length;w<M;w++){var O=_[w];w>0&&w<M-1&&m.push(O.x,O.y,O.z),m.push(O.x,O.y,O.z)}var j=_.length+_.length-2,S=j;g[b]=[p,p+S],p+=S,x[b]={position:{count:j,start:y,end:y+3*j},hide:!1},y+=3*j}var C=new i.BufferGeometry;f(C,"position",new i.Float32BufferAttribute(m,3)),(s=t.call(this)||this)._initOptions(n),s._createLineSegments(C,o);var A=n.altitude,T=a.distanceToVector3(A,A).x,B=a.coordinateToVector3(d,T);return s.getObject3d().position.copy(B),s._faceMap=g,s._baseObjects=v,s._datas=e,s._geometriesAttributes=x,s.faceIndex=null,s.index=null,s._geometryCache=C.clone(),s.isHide=!1,s._colorMap={},s._initBaseObjectsEvent(v),s._setPickObject3d(),s._init(),s}c(e,t);var n=e.prototype;return n.getSelectMesh=function(){var t=this._getIndex();if(null!=t){if(!this._baseObjects[t]){var e=this._datas[t],n=r.Util.extend({},this.getOptions(),{index:t},Ft(e)?e.properties:e.getProperties());this._baseObjects[t]=new Qt(e,n,this.getObject3d().material,this.getLayer()),this._proxyEvent(this._baseObjects[t])}return{data:this._datas[t],baseObject:this._baseObjects[t]}}},n._getIndex=function(t){return null==t&&(t=this.faceIndex||this.index),t},n._init=function(){var t=this,e=this.getLayer().getPick();this.on("add",(function(){e.add(t.pickObject3d)})),this.on("remove",(function(){e.remove(t.pickObject3d)}))},n._setPickObject3d=function(){for(var t=this.getObject3d().geometry.clone(),e=this.getLayer().getPick(),n=this._geometriesAttributes,r=[],o=0,a=n.length;o<a;o++){var s=e.getColor(),c=s.getHex();this._colorMap[c]=o;var u=n[o].position.count;this._datas[o].colorIndex=c;for(var h=0;h<u;h++)r.push(s.r,s.g,s.b)}f(t,"color",new i.Float32BufferAttribute(r,3,!0));var l=this.getObject3d().material.clone();l.color.set("#fff"),l.vertexColors=i.VertexColors;var d=e.getColor().getHex(),v=new i.LineSegments(t,l);v.position.copy(this.getObject3d().position),v._colorIndex=d,this.setPickObject3d(v)},n.identify=function(t){return this.picked},e}(xe(O)),Ee=[],Ve=[];function Ue(t,e){for(var n=0,r=t.length;n<r;n++){var i=t[n];if(i){var o=i.callback;if(e===i.key)return t.splice(n,1),o}}return null}var Re=document.createElement("canvas");function Fe(t,e){var n=Re.getContext("2d");if(n.clearRect(0,0,256,256),n.save(),e){n.fillStyle="red",n.strokeStyle="rgba(255,0,0,0.4)",n.lineWidth=.2;var r=t||"tile";n.font="18px sans-serif",n.rect(0,0,256,256),n.stroke(),n.fillText(r,15,128)}return Re.toDataURL()}function Ze(t,e){var n;return void 0===t&&(t=1),void 0===e&&(e=1),"undefined"==typeof document||(n=document.createElement("canvas"),t&&(n.width=t),e&&(n.height=e)),n}Re.width=Re.height=256;var Ge=function(t){function e(e,n){var i;return void 0===n&&(n={}),(i=t.call(this,r.Util.GUID(),r.Util.extend({urlTemplate:e},n))||this)._opts=null,i._layer=null,i.material=null,i.getMaterial=null,i._baseObjectKeys={},i._loadTiles={},i._add=null,i._layerLaodTime=(new Date).getTime(),i}c(e,t);var n=e.prototype;return n.isAsynchronous=function(){return this._opts.worker},n.getBaseObjects=function(){var t=this._loadTiles,e=[];for(var n in t){var r=this._baseObjectKeys[n];if(r&&Array.isArray(r)&&r.length)for(var i=0,o=r.length;i<o;i++)e.push(r[i])}return e},n.onSelectMesh=function(t,e){},n.formatBaseObjects=function(t,e){},n.loopMessage=function(t){},n.getTileData=function(t){var e=t.key,n=t.callback,i=t.img;r.Ajax.getJSON(t.url,{},(function(t,r){t?(console.error(t),n(e,null,i)):n(e,r,i)}))},n._getCurentTileKeys=function(){for(var t=this.getTiles().tileGrids||[],e=[],n={},r=0,i=t.length;r<i;r++)for(var o=t[r].tiles||[],a=0,s=o.length;a<s;a++){var c=o[a].dupKey;e.push(c),n[c]=!0}return{keys:e,keysMap:n}},n._isLoad=function(){var t=this._getCurentTileKeys().keys,e=Object.keys(this._renderer.tilesInView);return t.length===e.length},n._layerOnLoad=function(){var t=(new Date).getTime();if(!(t-this._layerLaodTime<20)){this._layerLaodTime=t;var e=this._renderer.tilesInView,n=this._loadTiles,r=this._layer,i=this._baseObjectKeys,o=Object.keys(e).length,a=Object.keys(n).length,s=[];if(o&&a)for(var c in n)e[c]||i[c]&&(i[c]||[]).forEach((function(t){s.push(t)}));if(s.length&&r.removeMesh(s,!1),o&&a)for(var u in e)if(!n[u])if(i[u])r.addMesh(i[u]);else{var h=this._getXYZOfIndex(u);this.getTileUrl(h.x,h.y,h.z)}this._loadTiles=Object.assign({},e),this._diffCache()}},n._init=function(){},n._workerLoad=function(t){var e=t.target._img;e.currentCount++,e.currentCount===e.needCount&&(e.src=Fe(e._key,this._opts.debug))},n._generateBaseObjects=function(t,e,n){var r=this;if(e&&n){if(!this._getCurentTileKeys().keysMap[t])return void(n.src=Fe(t,this._opts.debug));var i=this.formatBaseObjects(t,e);if(i.length){n.needCount=i.length,n.currentCount=0;for(var o=0,a=i.length;o<a;o++){var s=i[o];s._img=n,s._vt=this,this.isVisible()||s.hide(),this._cachetile(t,s),s.isAsynchronous()||n.currentCount++}this._layer.addMesh(i,!1),n.needCount===n.currentCount&&(n.src=Fe(t,this._opts.debug)),this.isAsynchronous()?i.filter((function(t){return t.isAsynchronous()})).forEach((function(t){t.on("workerload",r._workerLoad,r)})):n.src=Fe(t,this._opts.debug)}else n.src=Fe(t,this._opts.debug);this._loadTiles[t]=!0}else n&&(n.src=Fe(t,this._opts.debug))},n._diffCache=function(){var t=this;Object.keys(this._baseObjectKeys).length>this._renderer.tileCache.max&&function(){var e=t._renderer.tileCache.data,n=t._renderer.tilesInView,r=[];for(var i in t._baseObjectKeys)e[i]||n[i]||((t._baseObjectKeys[i]||[]).forEach((function(t){t.isAdd&&r.push(t)})),t._diposeBaseObject(i),delete t._baseObjectKeys[i]);r.length&&t._layer.removeMesh(r,!1)}()},n._diposeBaseObject=function(t){var e=this._baseObjectKeys[t];e&&e.length&&e.forEach((function(t){t.getObject3d().geometry.dispose(),t._geometryCache&&t._geometryCache.dispose();var e=t._baseObjects;e&&e.length&&e.forEach((function(t){t.getObject3d().geometry.dispose(),t=null})),t._datas=null,t._geometriesAttributes=null,t._faceMap=null,t=null}))},n._cachetile=function(t,e){this._baseObjectKeys[t]||(this._baseObjectKeys[t]=[]),this._baseObjectKeys[t].push(e)},n._getXYZOfIndex=function(t){var e=t.indexOf("_")>-1?"_":"-",n=t.split(e).slice(1,4),r=n[0],i=n[1],o=n[2];return{x:i=parseInt(i),y:r=parseInt(r),z:o=parseInt(o)}},n._getTileExtent=function(t,e,n){var r=this.getMap()._getResolution(n);return this._getTileConfig().getTilePrjExtent(t,e,r)},n._getTileLngLatExtent=function(t,e,n){var i=this._getTileExtent(t,e,n),o=i.getMax(),a=i.getMin(),s=this.getMap().getProjection();return a=s.unproject(a),o=s.unproject(o),new r.Extent(a,o)},e}(r.TileLayer),De={worker:!1},We=function(t){function e(e,n,i,o){var a;return void 0===n&&(n={}),(a=t.call(this,r.Util.GUID(),r.Util.extend({urlTemplate:e},De,n))||this)._opts=n,a._layer=o,a.getMaterial=i,a._baseObjectKeys={},a._loadTiles={},a._add=null,a._layerLaodTime=(new Date).getTime(),a._init(),a}c(e,t);var n=e.prototype;return n.formatBaseObjects=function(t,e){var n=this._opts,o=[],a=this.isAsynchronous();for(var s in e){var c=e[s]||{},u=void 0;if(Array.isArray(c)?u=c:"FeatureCollection"===c.type&&(u=c.features),u&&u.length){for(var h=[],l=[],f=[],d=0,v=u.length;d<v;d++){var p=u[d];if(Rt(p))h.push(p);else if(Ft(p))for(var g=Wt(p),x=0,y=g.length;x<y;x++)l.push(g[x]);else if(Zt(p))for(var m=Wt(p),b=0,_=m.length;b<_;b++)f.push(r.Util.extend({},m[b].properties,m[b],{coordinate:Gt(m[b])}))}if(h.length){var w=this._getMaterial(s,h,t,c);if(w){var M=this._layer.toExtrudePolygons(h,r.Util.extend({},{topColor:"#fff",layerName:s,asynchronous:a,key:t},n),w);o.push(M)}}if(l.length){var O=this._getMaterial(s,l,t,c);if(O&&(O instanceof i.LineBasicMaterial||O instanceof i.LineDashedMaterial)){var j=this._layer.toLines(l,r.Util.extend({},{layerName:s},n),O);o.push(j)}}if(f.length){var S=this._getMaterial(s,f,t,c);if(S&&S instanceof i.PointsMaterial){var C=this._layer.toPoints(f,r.Util.extend({},{layerName:s},n),S);o.push(C)}}}}return o},n.loopMessage=function(t){({waitingQueue:Ee,currentQueue:Ve}).currentQueue.length>0&&this.getTileData(t)},n._init=function(){var t=this;this.on("layerload",this._layerOnLoad),this.on("add",(function(){if(!1===t._add){var e=t.getBaseObjects();t._layer.addMesh(e)}t._add=!0,t.intervalId=setInterval((function(){t._isLoad()&&!t._layer.getMap().isInteracting()&&t.fire("layerload")}),1e3)})),this.on("remove",(function(){t._add=!1;var e=t.getBaseObjects();t._layer.removeMesh(e),clearInterval(t.intervalId)})),this.on("show",(function(){var e=t.getBaseObjects();for(var n in e.forEach((function(t){t.show()})),t._baseObjectKeys)(t._baseObjectKeys[n]||[]).forEach((function(t){t.show()}))})),this.on("hide",(function(){var e=t.getBaseObjects();for(var n in e.forEach((function(t){t.hide()})),t._baseObjectKeys)(t._baseObjectKeys[n]||[]).forEach((function(t){t.hide()}))})),this.on("renderercreate",(function(e){e.renderer.loadTile=function(t){var e=this.layer.getTileSize(),n=new Image;return n.width=e.width,n.height=e.height,n.onload=this.onTileLoad.bind(this,n,t),n.onerror=this.onTileError.bind(this,n,t),this.loadTileImage(n,t.url,t.dupKey),n},e.renderer.deleteTile=function(t){var e,n;t&&t.image&&(t.image.onload=null,t.image.onerror=null,(n=Ue(Ee,e=(t.info||{}).dupKey))&&n(e))},e.renderer.loadTileImage=function(e,n,r){e._key=r,function(e,n,r,i,o){var a={key:e,url:n,callback:function(e,n,r){t._generateBaseObjects(e,n,r),function(t,e){Ue(Ve,t),Ee.length&&(Ve.push(Ee[0]),Ee.splice(0,1),e.loopMessage(Ve[Ve.length-1]))}(e,t)},img:i,vt:o};Ve.length<10?(Ve.push(a),o.loopMessage(a)):Ee.push(a)}(r,n,0,e,t)}}))},n._getMaterial=function(t,e,n,i){return this.getMaterial&&r.Util.isFunction(this.getMaterial)?this.getMaterial(t,e,n,i):null},e}(Ge),qe=new i.TextureLoader,He=document.createElement("canvas");function Ke(t){return t?("string"==typeof t?(e=new Image).src=t:t instanceof HTMLCanvasElement?(e=new Image).src=t.toDataURL():t instanceof Image&&((e=new Image).src=t.src,e.crossOrigin=t.crossOrigin),e&&!e.crossOrigin&&(e.crossOrigin="Anonymous"),e):null;var e}var Ne={interactive:!1,altitude:0,image:null,imageWidth:256,imageHeight:256,texture:null},Qe=function(t){function e(e,n,o,a){var s,c=(n=r.Util.extend({},Ne,n,{layer:a,extent:e})).texture,u=n.image,h=n.altitude,l=n.imageHeight,f=n.imageWidth;u||console.error("not find image"),e instanceof r.Extent||(e=new r.Extent(e));var d=e.xmin,v=e.ymin,p=e.xmax,g=e.ymax,x=1/0,y=1/0,m=-1/0,b=-1/0;[[d,v],[d,g],[p,g],[p,v]].forEach((function(t){var e=a.coordinateToVector3(t),n=e.x,r=e.y;x=Math.min(n,x),y=Math.min(r,y),m=Math.max(n,m),b=Math.max(r,b)}));var _=Math.abs(m-x),w=Math.abs(b-y),M=Ke(u),O=Ke(c),j=new i.PlaneBufferGeometry(_,w,f-1,l-1);(s=t.call(this)||this)._initOptions(n),s._createMesh(j,o);var S=a.distanceToVector3(h,h).x,C=a.coordinateToVector3(e.getCenter(),S);return s.getObject3d().position.copy(C),o.transparent=!0,M&&(o.opacity=0,M.onload=function(){for(var t=function(t,e,n){void 0===e&&(e=256),void 0===n&&(n=256),He.width=e,He.height=n;var r=He.getContext("2d");return r.drawImage(t,0,0,e,n),r.getImageData(0,0,e,n).data}(M,f,l),e=0,n=0,r=t.length;n<r;n+=4){var i=.1*(256*t[n]*256+256*t[n+1]+t[n+2])-1e4,s=a.distanceToVector3(i,i).x;j.attributes.position.array[3*e+2]=s,e++}j.attributes.position.needsUpdate=!0,O?qe.load(O.src,(function(t){o.map=t,o.opacity=1,o.needsUpdate=!0})):o.opacity=1},M.onerror=function(){console.error("not load "+M.src)}),s}return c(e,t),e}(O),Xe={scale:1},Ye=function(t){function e(e,n,i,o){var a;return void 0===n&&(n={}),(a=t.call(this,r.Util.GUID(),r.Util.extend({urlTemplate:e},Xe,n))||this)._opts=n,a._layer=o,a.material=i,a._baseObjectKeys={},a._loadTiles={},a._add=null,a._imgQueue={},a._layerLaodTime=(new Date).getTime(),a._init(),a}c(e,t);var n=e.prototype;return n.isAsynchronous=function(){return!1},n.formatBaseObjects=function(t,e){var n=[],r=this.options.scale,i=this._getXYZOfIndex(t),o=i.x,a=i.y,s=i.z,c=this.getMap().getZoom(),u=this.getTileUrl(o,a,s),h=this.options.tileSize,l=h[0],f=h[1],d=this._getTileLngLatExtent(o,a,s),v=this.material.clone();if(s+1>=Math.round(c)){var p=new Qe(d,{image:e,imageWidth:l/8,imageHeight:f/8,texture:u},v,this._layer);p.getObject3d().scale.set(r,r,1),n.push(p)}return n},n.loopMessage=function(t){this.getTileData(t)},n._init=function(){var t=this;this.on("layerload",this._layerOnLoad),this.on("add",(function(){if(!1===t._add){var e=t.getBaseObjects();t._layer.addMesh(e)}t._add=!0,t.intervalId=setInterval((function(){t._isLoad()&&!t._layer.getMap().isInteracting()&&t.fire("layerload")}),1e3)})),this.on("remove",(function(){t._add=!1;var e=t.getBaseObjects();t._layer.removeMesh(e),clearInterval(t.intervalId)})),this.on("show",(function(){var e=t.getBaseObjects();for(var n in e.forEach((function(t){t.show()})),t._baseObjectKeys)(t._baseObjectKeys[n]||[]).forEach((function(t){t.show()}))})),this.on("hide",(function(){var e=t.getBaseObjects();for(var n in e.forEach((function(t){t.hide()})),t._baseObjectKeys)(t._baseObjectKeys[n]||[]).forEach((function(t){t.hide()}))})),this.on("renderercreate",(function(e){e.renderer.loadTile=function(t){var e=this.layer.getTileSize(),n=new Image;return n.width=e.width,n.height=e.height,n.onload=this.onTileLoad.bind(this,n,t),n.onerror=this.onTileError.bind(this,n,t),this.loadTileImage(n,t.url,t.dupKey),n},e.renderer.deleteTile=function(e){if(e&&e.image){e.image.onload=null,e.image.onerror=null;var n=e.info||{},r=t._imgQueue[n.dupKey];r&&(r.src="",r.onload=null,r.onerror=null,delete t._imgQueue[n.dupKey])}},e.renderer.loadTileImage=function(e,n,r){e._key=r;var i=new Image;t._imgQueue[r]=i;var o={key:r,url:n,rgbImage:i,callback:function(e,n,r){t._generateBaseObjects(e,n,r)},img:e,vt:t};t.loopMessage(o)}}))},e}(Ge);
/*!
   * Code from baidu mapv
   * License: BSD-3
   * https://github.com/huiyan-fe/mapv
   *
   */
function Je(t){this.gradient=(t=t||{}).gradient||{.25:"rgba(0, 0, 255, 1)",.55:"rgba(0, 255, 0, 1)",.85:"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"},this.maxSize=t.maxSize||35,this.minSize=t.minSize||0,this.max=t.max||100,this.min=t.min||0,this.initPalette()}function $e(t,e,n){var r=tn(n),i=function(t){return t.min||0}(n),o=r-i,a=n.range||null,s=0,c=1024;a&&2===a.length&&(s=(a[0]-i)/o*1024),a&&2===a.length&&(c=(a[1]-i)/o*1024);for(var u,h=n.maxOpacity||.8,l=n.minOpacity||0,f=3,d=t.length;f<d;f+=4)u=4*t[f],t[f]/256>h&&(t[f]=256*h),t[f]/256<l&&(t[f]=256*l),u&&u>=s&&u<=c?(t[f-3]=e[u],t[f-2]=e[u+1],t[f-1]=e[u+2]):t[f]=0}function tn(t){return t.max||100}function en(t,e,n){var r=tn(n),i=
/*!
   * Code from baidu mapv
   * License: BSD-3
   * https://github.com/huiyan-fe/mapv
   *
   */
function(t){var e=t/2,n=t+e,r=new Ze(2*n,2*n),i=r.getContext("2d");return i.shadowBlur=e,i.shadowColor="black",i.shadowOffsetX=i.shadowOffsetY=1e4,i.beginPath(),i.arc(n-1e4,n-1e4,t,0,2*Math.PI,!0),i.closePath(),i.fill(),r}(n._size||n.size||13),o=i.width/2,a=i.height/2,s=e,c={};for(var u in s.forEach((function(t){var e=Math.min(1,(void 0===t.count?1:t.count)/r).toFixed(2);c[e]=c[e]||[],c[e].push(t)})),c)if(!isNaN(u)){var h=c[u];t.beginPath(),n.withoutAlpha||(t.globalAlpha=u),h.forEach((function(e){var n=e.coordinate;t.globalAlpha=(void 0===e.count?1:e.count)/r,t.drawImage(i,n[0]-o,n[1]-a)}))}}Je.prototype.setMax=function(t){this.max=t||100},Je.prototype.setMin=function(t){this.min=t||0},Je.prototype.setMaxSize=function(t){this.maxSize=t||35},Je.prototype.setMinSize=function(t){this.minSize=t||0},Je.prototype.initPalette=function(){var t=this.gradient,e=new Ze(256,1),n=this.paletteCtx=e.getContext("2d"),r=n.createLinearGradient(0,0,256,1);for(var i in t)r.addColorStop(parseFloat(i),t[i]);n.fillStyle=r,n.fillRect(0,0,256,1)},Je.prototype.getColor=function(t){var e=this.getImageData(t);return"rgba("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]/256+")"},Je.prototype.getImageData=function(t){var e=this.paletteCtx.getImageData(0,0,256,1).data;if(void 0===t)return e;var n=this.max,r=this.min;t>n&&(t=n),t<r&&(t=r);var i=4*Math.floor((t-r)/(n-r)*255);return[e[i],e[i+1],e[i+2],e[i+3]]},Je.prototype.getSize=function(t){var e=this.max,n=this.min,r=this.maxSize,i=this.minSize;return t>e&&(t=e),t<n&&(t=n),e>n?i+(t-n)/(e-n)*(r-i):r},Je.prototype.getLegend=function(t){var e=this.gradient,n=t.width||20,r=t.height||180,i=new Ze(n,r),o=i.getContext("2d"),a=o.createLinearGradient(0,r,0,0);for(var s in e)a.addColorStop(parseFloat(s),e[s]);return o.fillStyle=a,o.fillRect(0,0,n,r),i};var nn={draw:function(t,e,n){if(!(t.canvas.width<=0||t.canvas.height<=0)){t.strokeStyle="rgba(0,0,0,"+(n.strength||.3)+")";var r=new Ze(t.canvas.width,t.canvas.height),i=r.getContext("2d");i.scale(devicePixelRatio,devicePixelRatio),n=n||{},t.save();var o=new Je({gradient:n.gradient});if(en(i,e,n),!n.absolute){var a=i.getImageData(0,0,t.canvas.width,t.canvas.height);$e(a.data,o.getImageData(),n),t.putImageData(a,0,0),t.restore()}o=null,r=null}},drawGray:en,colorize:$e},rn={interactive:!1,min:0,max:100,size:13,gradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},gridScale:.5},on=function(t){function e(e,n,o,a){var s;Array.isArray(e)||(e=[e]);for(var c=1/0,u=1/0,h=-1/0,l=-1/0,d=[],v=0,p=e.length;v<p;v++){var g=e[v],x=g.coordinate||g.lnglat||g.xy;if(x){var y=a.coordinateToVector3(x);d.push(y);var m=y.x,b=y.y;c=Math.min(c,m),u=Math.min(u,b),h=Math.max(h,m),l=Math.max(l,b)}else console.warn("not find coordinate")}var _=(n=r.Util.extend({},rn,n,{layer:a,points:e})).gridScale,w=n.altitude,M=Math.abs(h-c),O=Math.abs(l-u),j=Math.max(M*_,O*_);j>2048&&(console.warn("gridScale: "+_+" it's too big. I hope it's a smaller value,canvas max size is 2048* 2048"),_=2048/(j/_));for(var S=Math.ceil(M*_),C=Math.ceil(O*_),A=S/M,T=C/O,B=[],k=0,P=d.length;k<P;k++){var z=d[k];z.x-=c,z.y-=u,z.x*=A,z.y*=T,z.y=C-z.y,B.push({coordinate:[z.x,z.y],count:e[k].count})}var I=new Ze(S,C),L=I.getContext("2d");nn.drawGray(L,B,n);for(var E=L.getImageData(0,0,L.canvas.width,L.canvas.height),V=-1/0,U={},R=[],F=3,Z=E.data.length,G=0;F<Z;F+=4){var D=E.data[F];V=Math.max(V,D),R.push(D),D<=0&&(U[G]=1),G++}var W=new Je({gradient:n.gradient});nn.colorize(E.data,W.getImageData(),n),I=null,L=null;for(var q=new i.PlaneBufferGeometry(M,O,S-1,C-1),H=q.getIndex().array,K=q.attributes.position.array,N=[],Q=[],X=new i.Color,Y=0,J=K.length,$=0,tt=H.length,et=0,nt=E.data.length,rt=0;Y<Math.max(J,tt,nt);Y+=3){if(Y<J){var it=R[rt];it>0&&(K[Y+2]=it/V)}if($<tt){var ot=H[$],at=H[$+1],st=H[$+2];U[ot]&&U[at]&&U[st]||N.push(ot,at,st)}et<nt&&(X.setStyle("rgb("+E.data[et]+","+E.data[et+1]+","+E.data[et+2]+")"),Q.push(X.r,X.g,X.b)),$+=3,et+=4,rt++}q.setIndex(new i.Uint32BufferAttribute(N,1)),f(q,"color",new i.Float32BufferAttribute(Q,3,!0)),o.vertexColors=i.VertexColors,(s=t.call(this)||this)._initOptions(n),s._createMesh(q,o);var ct=a.distanceToVector3(w,w).x;return s.getObject3d().position.copy(new i.Vector3((c+h)/2,(u+l)/2,ct)),s}return c(e,t),e}(O),an=new i.Color,sn=1,cn=function(){function t(t){this.object3ds=[],this.layer=t,this.camera=t.getCamera(),this.renderer=t.getThreeRenderer(),this.pickingTexture=new i.WebGLRenderTarget(1,1),this.pickingScene=new i.Scene}var e=t.prototype;return e.getColor=function(){return an.setHex(sn),sn++,an},e.add=function(t){if(t){var e=t._colorIndex;e&&(this.object3ds[e]=t,this.pickingScene.add(t))}return this},e.remove=function(t){if(t){var e=t._colorIndex;e&&(this.object3ds[e]=null,this.pickingScene.remove(t))}return this},e.isEmpty=function(){if(0===this.pickingScene.children.length)return!0;for(var t=0,e=this.pickingScene.children.length;t<e;t++){var n=this.pickingScene.children[t];if(n){var r=n.__parent;if(r&&!0===r.getOptions().interactive)return!1}}return!0},e.pick=function(t){if(t&&!this.isEmpty()){for(var e=this.camera,n=this.renderer,r=this.pickingTexture,i=this.pickingScene,o=this.object3ds,a=this.layer,s=this.pickingScene.children.length,c=0;c<s;c++){var u=this.pickingScene.children[c];u&&u.__parent&&(u.__parent.picked=!1)}var h=a._getRenderer().canvas,l=h.width,f=h.height;l===r.width&&f===r.height||r.setSize(l,f),n.setRenderTarget(r),n.clear(),n.render(i,e);var d=new Uint8Array(4),v=window.devicePixelRatio,p=r.height-t.y*v;n.readRenderTargetPixels(r,Math.round(t.x*v),Math.round(p),1,1,d);var g=d[0]<<16|d[1]<<8|d[2],x=o[g];if(x)x.__parent&&(o[g].__parent.picked=!0);else for(var y=0;y<s;y++){var m=this.pickingScene.children[y];if(m&&m.__parent){var b=m.__parent;if(b._colorMap&&null!=b._colorMap[g]){b.picked=!0,b.index=b._colorMap[g];break}}}n.setRenderTarget(null)}},t}(),un={altitude:0},hn=function(t){function e(e,n,i,o){var a;n=r.Util.extend({},un,n,{layer:o,lineString:e}),(a=t.call(this)||this)._initOptions(n);for(var s=Ut(e)?Dt(e):e.getCenter(),c=qt(e,o,s).positionsV,u=[],h=0,l=c.length;h<l;h++){var f=c[h];h>0&&h<l-1&&u.push(f.x,f.y,f.z),u.push(f.x,f.y,f.z)}var d=new _;d.setPositions(u),a._setMaterialRes(o,i),a._createLine2(d,i);var v=n.altitude,p=o.distanceToVector3(v,v).x,g=o.coordinateToVector3(s,p);return a.getObject3d().position.copy(g),a._setPickObject3d(u,i.linewidth),a._init(),a}c(e,t);var n=e.prototype;return n._init=function(){var t=this,e=this.getLayer().getPick();this.on("add",(function(){e.add(t.pickObject3d)})),this.on("remove",(function(){e.remove(t.pickObject3d)}))},n._setMaterialRes=function(t,e){var n=t.getMap().getSize();e.resolution.set(n.width,n.height)},n._setPickObject3d=function(t,e){var n=new _;n.setPositions(t);for(var r=this.getLayer().getPick().getColor(),o=[],a=0,s=t.length/3;a<s;a++)o.push(r.r,r.g,r.b);n.setColors(o);var c=new x({color:"#fff",linewidth:e,vertexColors:i.VertexColors});this._setMaterialRes(this.getLayer(),c);var u=r.getHex(),h=new w(n,c);h.position.copy(this.getObject3d().position),h._colorIndex=u,this.setPickObject3d(h)},n.identify=function(t){return this.picked},n.setSymbol=function(t){if(t&&t instanceof i.Material){t.needsUpdate=!0;var e=this.getMap().getSize();t.resolution.set(e.width,e.height),this.getObject3d().material=t}return this},e}(O),ln={altitude:0,colors:null},fn=function(t){function e(e,n,i,o){var a;Array.isArray(e)||(e=[e]);for(var s=[],c=e.length,u=0;u<c;u++){var h=e[u];s.push(Ft(h)?Dt(h):h.getCenter())}var l=te(s);n=r.Util.extend({},ln,n,{layer:o,lineStrings:e,coordinate:l});for(var f=[],d=0,v=[],p=[],g=0,x=[],y=0;y<c;y++){for(var m=qt(e[y],o,l).positionsV,b=0,w=m.length;b<w;b++){var M=m[b];b>0&&b<w-1&&x.push(M.x,M.y,M.z),x.push(M.x,M.y,M.z)}var O=m.length+m.length-2,j=O;v[y]=[d,d+j],d+=j,p[y]={position:{count:O,start:g,end:g+3*O},instanceStart:{count:O,start:g,end:g+3*O},instanceEnd:{count:O,start:g,end:g+3*O},hide:!1},g+=3*O}(a=t.call(this)||this)._initOptions(n);var S=new _;S.setPositions(x),a._setMaterialRes(o,i),a._createLine2(S,i);var C=n.altitude,A=o.distanceToVector3(C,C).x,T=o.coordinateToVector3(l,A);return a.getObject3d().position.copy(T),a._faceMap=v,a._baseObjects=f,a._datas=e,a._geometriesAttributes=p,a.faceIndex=null,a.index=null,a._geometryCache=new _,a._geometryCache.setPositions(x),a._colorMap={},a.isHide=!1,a._initBaseObjectsEvent(f),a._setPickObject3d(x,i.linewidth),a._init(),a}c(e,t);var n=e.prototype;return n._init=function(){var t=this,e=this.getLayer().getPick();this.on("add",(function(){e.add(t.pickObject3d)})),this.on("remove",(function(){e.remove(t.pickObject3d)}))},n._setMaterialRes=function(t,e){var n=t.getMap().getSize();e.resolution.set(n.width,n.height)},n._setPickObject3d=function(t,e){var n=new _;n.setPositions(t);for(var r=this.getLayer().getPick(),o=this._geometriesAttributes,a=[],s=0,c=o.length;s<c;s++){var u=r.getColor(),h=u.getHex();this._colorMap[h]=s;var l=o[s].position.count;this._datas[s].colorIndex=h;for(var f=0;f<l;f++)a.push(u.r,u.g,u.b)}n.setColors(a);var d=new x({color:"#fff",linewidth:e,vertexColors:i.VertexColors});this._setMaterialRes(this.getLayer(),d);var v=r.getColor().getHex(),p=new w(n,d);p.position.copy(this.getObject3d().position),p._colorIndex=v,this.setPickObject3d(p)},n.identify=function(t){return this.picked},n.setSymbol=function(t){if(t&&t instanceof i.Material){t.needsUpdate=!0;var e=this.getMap().getSize();t.resolution.set(e.width,e.height),this.getObject3d().material=t}return this},n.getSelectMesh=function(){var t=this._getIndex();if(null!=t){if(!this._baseObjects[t]){var e=this._datas[t],n=r.Util.extend({},this.getOptions(),{index:t},Ft(e)?e.properties:e.getProperties());this._baseObjects[t]=new hn(e,n,this.getObject3d().material,this.getLayer()),this._proxyEvent(this._baseObjects[t])}return{data:this._datas[t],baseObject:this._baseObjects[t]}}},n._getIndex=function(t){return null==t&&(t=this.faceIndex||this.index),t},n._updateAttribute=function(t,e){for(var n=this._getHideGeometryIndex(e).indexs,r=this._geometryCache.attributes[e].array,i=r.length,o=0;o<i;o++)t.array[o]=r[o];for(var a=0;a<n.length;a++)for(var s=this._geometriesAttributes[n[a]][e],c=s.end,u=s.start;u<c;u++)t.array[u]=-1e5;return this},n._showGeometry=function(t,e){var n;if(t&&(n=t.getOptions().index),null!=n){var r=this._geometriesAttributes[n];if(r.hide===e)return this;r.hide=e;var i=this.getObject3d().geometry;this._updateAttribute(i.attributes.instanceStart,"instanceStart"),this._updateAttribute(i.attributes.instanceEnd,"instanceEnd"),i.attributes.instanceStart.data.needsUpdate=!0,i.attributes.instanceEnd.data.needsUpdate=!0,this.isHide=e}return this},e}(xe(O)),dn=Math.PI/180,vn=[[4e3,220],[2e3,100],[1e3,30],[500,15],[100,5],[50,2],[10,1],[5,.7],[2,.1],[1,.05],[.5,.02]],pn=["mousemove","click","mousedown","mouseup","dblclick","contextmenu","touchstart","touchmove","touchend"],gn=new i.Matrix4,xn=function(t){function e(){return t.apply(this,arguments)||this}c(e,t);var n=e.prototype;return n.draw=function(){this.renderScene()},n.drawOnInteracting=function(){this.renderScene()},n.coordinateToVector3=function(t,e){void 0===e&&(e=0);var n=this.getMap();if(!n)return null;t instanceof r.Coordinate||(t=new r.Coordinate(t));var o=n.coordinateToPoint(t,mn(n));return new i.Vector3(o.x,o.y,e)},n.distanceToVector3=function(t,e,n){var o=this.getMap(),a=mn(o),s=n||o.getCenter();s instanceof r.Coordinate||(s=new r.Coordinate(s));var c=o.locate(s,t,e),u=o.coordinateToPoint(s,a),h=o.coordinateToPoint(c,a),l=Math.abs(h.x-u.x)*r.Util.sign(t),f=Math.abs(h.y-u.y)*r.Util.sign(e);return new i.Vector3(l,f,0)},n.toShape=function(t){var e=this;if(!t)return null;if(t instanceof r.MultiPolygon)return t.getGeometries().map((function(t){return e.toShape(t)}));var n=t.getCenter(),o=this.coordinateToVector3(n),a=t.getShell().map((function(t){return e.coordinateToVector3(t).sub(o)})),s=new i.Shape(a),c=t.getHoles();return c&&c.length>0&&(s.holes=c.map((function(t){var n=t.map((function(t){return e.coordinateToVector3(t).sub(o)}));return new i.Shape(n)}))),s},n.toExtrudeMesh=function(t,e,n,o){var a=this;if(!t)return null;if(t instanceof r.MultiPolygon)return t.getGeometries().map((function(t){return a.toExtrudeMesh(t,e,n,o)}));var s=t.getCoordinates();s.forEach((function(t){for(var e=t.length-1;e>=1;e--)t[e].equals(t[e-1])&&t.splice(e,1)})),t.setCoordinates(s);var c=this.toShape(t),u=this.coordinateToVector3(t.getCenter());o=r.Util.isNumber(o)?o:e,o=this.distanceToVector3(o,o).x;var h=this.distanceToVector3(e,e).x,l={bevelEnabled:!1,bevelSize:1};l[parseInt(i.REVISION)>=93?"depth":"amount"]=o;var f=new i.ExtrudeGeometry(c,l),d=new i.BufferGeometry;d.fromGeometry(f);var v=new i.Mesh(d,n);return v.position.set(u.x,u.y,h-o),v},n.toExtrudePolygon=function(t,e,n){return new ie(t,e,n,this)},n.toBar=function(t,e,n){return new k(t,e,n,this)},n.toLine=function(t,e,n){return new Qt(t,e,n,this)},n.toExtrudeLine=function(t,e,n){return new Yt(t,e,n,this)},n.toModel=function(t,e){return new ae(t,e,this)},n.toExtrudeLineTrail=function(t,e,n){return new pe(t,e,n,this)},n.toExtrudePolygons=function(t,e,n){return new be(t,e,n,this)},n.toPoint=function(t,e,n){return new Oe(t,e,n,this)},n.toPoints=function(t,e,n){return new Te(t,e,n,this)},n.toBars=function(t,e,n){return new ke(t,e,n,this)},n.toExtrudeLines=function(t,e,n){return new ze(t,e,n,this)},n.toLines=function(t,e,n){return new Le(t,e,n,this)},n.toThreeVectorTileLayer=function(t,e,n){return new We(t,e,n,this)},n.toTerrain=function(t,e,n){return new Qe(t,e,n,this)},n.toTerrainVectorTileLayer=function(t,e,n){return new Ye(t,e,n,this)},n.toHeatMap=function(t,e,n){return new on(t,e,n,this)},n.toFatLine=function(t,e,n){return new hn(t,e,n,this)},n.toFatLines=function(t,e,n){return new fn(t,e,n,this)},n.clearMesh=function(){var t=this.getScene();if(!t)return this;for(var e=t.children.length-1;e>=0;e--)t.children[e]instanceof i.Mesh&&t.remove(t.children[e]);return this},n.lookAt=function(t){var e=this._getRenderer();return e&&e.context.lookAt(t),this},n.getCamera=function(){var t=this._getRenderer();return t?t.camera:null},n.getScene=function(){var t=this._getRenderer();return t?t.scene:null},n.renderScene=function(){var t=this._getRenderer();return t&&(t.clearCanvas(),t.renderScene()),this},n.renderPickScene=function(){var t=this._getRenderer();if(t){var e=t.pick;e&&e.pick(this._containerPoint)}return this},n.getThreeRenderer=function(){var t=this._getRenderer();return t?t.context:null},n.getPick=function(){var t=this._getRenderer();return t?t.pick:null},n.addMesh=function(t,e){var n=this;if(void 0===e&&(e=!0),!t)return this;Array.isArray(t)||(t=[t]);var o=this.getScene();return t.forEach((function(t){t instanceof O?(o.add(t.getObject3d()),t.isAdd||(t.isAdd=!0,t._fire("add",{target:t})),t._animation&&r.Util.isFunction(t._animation)&&(n._animationBaseObjectMap[t.getObject3d().uuid]=t)):t instanceof i.Object3D&&o.add(t)})),this._zoomend(),e&&this.renderScene(),this},n.removeMesh=function(t,e){var n=this;if(void 0===e&&(e=!0),!t)return this;Array.isArray(t)||(t=[t]);var o=this.getScene();return t.forEach((function(t){t instanceof O?(o.remove(t.getObject3d()),t.isAdd&&(t.isAdd=!1,t._fire("remove",{target:t})),t._animation&&r.Util.isFunction(t._animation)&&delete n._animationBaseObjectMap[t.getObject3d().uuid]):t instanceof i.Object3D&&o.remove(t)})),e&&this.renderScene(),this},n._initRaycaster=function(){return this._raycaster||(this._raycaster=new i.Raycaster,this._mouse=new i.Vector2),this},n.identify=function(t,e){var n=this;if(!t)return console.error("coordinate is null,it should be Coordinate"),[];if(Array.isArray(t)&&(t=new r.Coordinate(t)),!(t instanceof r.Coordinate))return console.error("coordinate type is error,it should be Coordinate"),[];var o=this.getMap().coordToContainerPoint(t);this._containerPoint=o;var a=o.x,s=o.y;this._initRaycaster();var c=this._raycaster,u=this._mouse,h=this.getCamera(),f=this.getScene(),d=this.getMap().getSize();if(!f)return[];var v=d.height;u.x=a/d.width*2-1,u.y=-s/v*2+1,c.setFromCamera(u,h),function(t,e){l>113?t.params.Line.threshold=e:t.linePrecision=e}(c,this._getLinePrecision(this.getMap().getResolution()));var p=[],g=[];f.children.forEach((function(t){var e=t.__parent;e&&e.getOptions?e.getOptions().interactive&&e.isVisible()&&(e.identify&&r.Util.isFunction(e.identify)?g.push(e):p.push(t)):(t instanceof i.Mesh||t instanceof i.Group)&&p.push(t)}));var x=[],y=c.intersectObjects(p,!0);y&&Array.isArray(y)&&y.length&&(x=y.map((function(t){var e=t.object,r=(e=n._recursionMesh(e)).__parent||e;return r.faceIndex=t.faceIndex,r.index=t.index,r}))),this.renderPickScene(),g.length&&g.forEach((function(e){e.identify(t)&&x.push(e)}));var m=(e=r.Util.extend({},e)).count;return r.Util.isNumber(m)&&m>0?x.slice(0,m):x},n._recursionMesh=function(t){for(;t&&!(t.parent instanceof i.Scene);)t=t.parent;return t||{}},n._getLinePrecision=function(t){void 0===t&&(t=10);for(var e=0,n=vn.length;e<n;e++){var r=vn[e];if(t>r[0])return r[1]}return.01},n._identifyBaseObjectEvents=function(t){if(!this.options.geometryEvents)return this;var e=this.map||this.getMap(),n=t.type,i=t.coordinate,o=r.Util.now();if(this._mousemoveTimeOut&&"mousemove"===n&&o-this._mousemoveTimeOut<16)return this;this._mousemoveTimeOut=o,e.resetCursor("default");var a=this.identify(i),s=this.getScene();if(0===a.length&&s)for(var c=0,u=s.children.length;c<u;c++){var h=(s.children[c]||{}).__parent;h&&h.fire("empty",Object.assign({},t,{target:h}))}if("mousemove"===n){a.length&&e.setCursor("pointer");var l=[];this._baseObjects&&this._baseObjects.forEach((function(t){var e=!0;a.forEach((function(n){t===n&&(e=!1)})),e&&l.push(t)})),l.forEach((function(e){e instanceof O&&(e.getSelectMesh?e.isHide||(e._mouseover=!1,e.fire("mouseout",Object.assign({},t,{target:e,type:"mouseout",selectMesh:null})),e.closeToolTip()):(e._mouseover=!1,e.fire("mouseout",Object.assign({},t,{target:e,type:"mouseout"})),e.closeToolTip()))})),a.forEach((function(e){if(e instanceof O){e._mouseover||(e.fire("mouseover",Object.assign({},t,{target:e,type:"mouseover",selectMesh:e.getSelectMesh?e.getSelectMesh():null})),e._mouseover=!0),e.fire(n,Object.assign({},t,{target:e,selectMesh:e.getSelectMesh?e.getSelectMesh():null}));var r=e.getToolTip();r&&!r._owner&&r.addTo(e),e.openToolTip(i)}}))}else a.forEach((function(e){if(e instanceof O&&(e.fire(n,Object.assign({},t,{target:e,selectMesh:e.getSelectMesh?e.getSelectMesh():null})),"click"===n)){var r=e.getInfoWindow();r&&!r._owner&&r.addTo(e),e.openInfoWindow(i)}}));return this._baseObjects=a,this},n._zoomend=function(){var t=this.getScene();if(t){var e=this.getMap().getZoom();t.children.forEach((function(t){var n=t.__parent;if(n&&n.getOptions){var r=n.getMinZoom(),i=n.getMaxZoom();e<r||e>i?(n.isVisible()&&(n.getObject3d().visible=!1),n._zoomVisible=!1):r<=e&&e<=i&&(n._visible&&(n.getObject3d().visible=!0),n._zoomVisible=!0)}}))}},n.onAdd=function(){var e=this;t.prototype.onAdd.call(this);var n=this.map||this.getMap();return n?(pn.forEach((function(t){n.on(t,e._identifyBaseObjectEvents,e)})),this._needsUpdate=!0,this._animationBaseObjectMap||(this._animationBaseObjectMap={}),n.on("zooming zoomend",this._zoomend,this),this):this},n.onRemove=function(){var e=this;t.prototype.onRemove.call(this);var n=this.map||this.getMap();return n?(pn.forEach((function(t){n.off(t,e._identifyBaseObjectEvents,e)})),n.off("zooming zoomend",this._zoomend,this),this):this},n._callbackBaseObjectAnimation=function(){if(this._animationBaseObjectMap)for(var t in this._animationBaseObjectMap)this._animationBaseObjectMap[t]._animation();return this},n._getFovRatio=function(){var t=this.getMap().getFov();return Math.tan(t/2*dn)},e}(r.CanvasLayer);xn.mergeOptions({renderer:"gl",doubleBuffer:!1,glOptions:null,geometryEvents:!0});var yn=function(t){function e(){return t.apply(this,arguments)||this}c(e,t);var n=e.prototype;return n.getPrepareParams=function(){return[this.scene,this.camera]},n.getDrawParams=function(){return[this.scene,this.camera]},n._drawLayer=function(){t.prototype._drawLayer.apply(this,arguments)},n.hitDetect=function(){return!1},n.createCanvas=function(){t.prototype.createCanvas.call(this),this.createContext()},n.createContext=function(){if(this.canvas.gl&&this.canvas.gl.wrap)this.gl=this.canvas.gl.wrap();else{var t=this.layer.options.glOptions||{alpha:!0,depth:!0,antialias:!0,stencil:!0};t.preserveDrawingBuffer=!0,this.gl=this.gl||this._createGLContext(this.canvas,t)}this._initThreeRenderer(),this.layer.onCanvasCreate(this.context,this.scene,this.camera)},n._initThreeRenderer=function(){var t=new i.WebGLRenderer({context:this.gl,alpha:!0});t.autoClear=!1,t.setClearColor(new i.Color(1,1,1),0),t.setSize(this.canvas.width,this.canvas.height),t.clear(),t.canvas=this.canvas,this.context=t;var e=this.scene=new i.Scene,n=this.layer.getMap(),r=n.getFov()*Math.PI/180,o=this.camera=new i.PerspectiveCamera(r,n.width/n.height,n.cameraNear,n.cameraFar);o.matrixAutoUpdate=!1,this._syncCamera(),e.add(o),this.pick=new cn(this.layer)},n.onCanvasCreate=function(){t.prototype.onCanvasCreate.call(this)},n.resizeCanvas=function(t){if(this.canvas){var e,n=this.getMap();e=t||n.getSize();var i=n.getDevicePixelRatio?n.getDevicePixelRatio():r.Browser.retina?2:1,o=this.canvas;o.height=i*e.height,o.width=i*e.width,this.layer._canvas&&o.style&&(o.style.width=e.width+"px",o.style.height=e.height+"px"),this.context.setSize(o.width,o.height)}},n.clearCanvas=function(){this.canvas&&this.context.clear()},n.prepareCanvas=function(){return this.canvas?this.clearCanvas():this.createCanvas(),this.layer.fire("renderstart",{context:this.context}),null},n.renderScene=function(){this.layer._callbackBaseObjectAnimation(),this._syncCamera(),this.context.render(this.scene,this.camera),this.completeRender()},n.remove=function(){delete this._drawContext,t.prototype.remove.call(this)},n._syncCamera=function(){var t=this.getMap(),e=this.camera;e.matrix.elements=t.cameraWorldMatrix,e.projectionMatrix.elements=t.projMatrix,e.projectionMatrixInverse.elements=gn.getInverse(e.projectionMatrix).elements},n._createGLContext=function(t,e){for(var n=["webgl2","webgl","experimental-webgl"],r=null,i=0;i<n.length;++i){try{r=t.getContext(n[i],e)}catch(o){}if(r)break}return r},e}(r.renderer.CanvasLayerRenderer);function mn(t){return t.getGLZoom()}xn.registerRenderer("gl",yn),e.ThreeLayer=xn,e.ThreeRenderer=yn,e.BaseObject=O,Object.defineProperty(e,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.three v0.11.5, requires maptalks@>=0.39.0.")}(e,n("V0yk"),n("X9qW"))},V0yk:function(t,n){t.exports=e},X9qW:function(t,e){t.exports=n},aP7H:function(t,e){t.exports=r},cfyg:function(t,e){t.exports=i},vOrQ:function(t,e){t.exports=o},zUnb:function(t,e,n){"use strict";n.r(e),n.d(e,"MapModule",(function(){return f}));var r=n("0S4P"),i=n("vOrQ"),o=n("X9qW"),a=n("cfyg"),s=n("aP7H"),c=n("V0yk"),u=n("5DuO"),h=["mapRef"],l=function(){function t(t){this.context=t,this.mapElements={},this.pluginConfig=this.context.pluginConfig,this.context.update$.pipe(Object(s.takeUntil)(this.context.destroy$)).subscribe((function(t){}))}return t.prototype.pluginOnUpdate=function(t,e,n,r){var i=n.diff;i.mapElements&&this.drawElements(e.config.mapElements),i.pitch&&this.map.setPitch(e.config.pitch),i.bearing&&this.map.setBearing(e.config.bearing),i.zoom&&this.map.setZoom(e.config.zoom),i.center&&this.map.setCenter(e.config.center),this.threeLayer.renderScene()},t.prototype.drawElements=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("polygon"===r.type)this.mapElements[r.id]&&this.threeLayer.removeMesh(this.mapElements[r.id].element),this.mapElements[r.id]={element:this.drawPolygon(r.points,r.color,r.height,r.altitude,r.opacity,r.wireframe),type:r.type},this.threeLayer.addMesh(this.mapElements[r.id].element);else if("imageLayer"===r.type){this.mapElements[r.id]&&this.map.removeLayer(this.mapElements[r.id].element);var i=new c.ImageLayer("images",[{url:r.url,extent:r.extent,opacity:void 0!==r.opacity?r.opacity:1}]);this.mapElements[r.id]={element:i,type:r.type},this.mapElements[r.id].element.addTo(this.map).bringToBack()}}},t.prototype.drawPolygon=function(t,e,n,r,i,a){void 0===i&&(i=.9),void 0===a&&(a=!1);var s=new c.Polygon([t],{symbol:{lineColor:e,lineWidth:2,polygonFill:e,polygonOpacity:i},properties:{altitude:n}}),u=new o.MeshPhongMaterial({color:e,transparent:!0,opacity:i});return this.threeLayer.toExtrudePolygon(s,{height:n,topColor:"#ff",altitude:r},u)},t.prototype.ngOnInit=function(){var t=this;this.map2(),this.threeLayer=new u.ThreeLayer("t",{forceRenderOnMoving:!0,forceRenderOnRotating:!0}),this.threeLayer.prepareToDraw=function(e,n,r){var i=new o.DirectionalLight(16777215);i.position.set(0,-50,10).normalize(),n.add(i);var a=new o.AmbientLight(16777215);n.add(a),t.threeLayer.config("animation",!0),t.drawElements(t.pluginConfig.config.mapElements)},this.threeLayer.addTo(this.map)},t.prototype.map2=function(){this.map=new c.Map(this.mapRef.nativeElement,{center:void 0!==this.pluginConfig.config.center?this.pluginConfig.config.center:[.5,.5],zoom:void 0!==this.pluginConfig.config.zoom?this.pluginConfig.config.zoom:10,pitch:void 0!==this.pluginConfig.config.pitch?this.pluginConfig.config.pitch:60,bearing:void 0!==this.pluginConfig.config.bearing?this.pluginConfig.config.bearing:-40,fog:!1,dragPitch:!0,dragRotate:!0,dragRotatePitch:!0,zoomControl:!0,scaleControl:!0})},t.prototype.unicodeToChar=function(t){return t.replace(/\u[\dA-Fa-f]{4}/g,(function(t){return String.fromCharCode(parseInt(t.replace(/\u/g,""),16))}))},t.prototype.createLine=function(t,e,n){return new c.LineString(t,{symbol:{lineColor:n,lineWidth:3,polygonFill:n},properties:{altitude:[e,e]}})},t.\u0275fac=function(e){return new(e||t)(i["\u0275\u0275directiveInject"](a.PLUGIN_CONTEXT))},t.\u0275cmp=i["\u0275\u0275defineComponent"]({type:t,selectors:[["app-map"]],viewQuery:function(t,e){var n;1&t&&i["\u0275\u0275staticViewQuery"](h,!0,i.ElementRef),2&t&&i["\u0275\u0275queryRefresh"](n=i["\u0275\u0275loadQuery"]())&&(e.mapRef=n.first)},decls:2,vars:0,consts:[[1,"map"],["mapRef",""]],template:function(t,e){1&t&&i["\u0275\u0275element"](0,"div",0,1)},styles:[".map[_ngcontent-%COMP%]{height:800px;width:800px}"]}),t}(),f=function(){function t(){}return t.entry=l,t.\u0275mod=i["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=i["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},imports:[[r.CommonModule]]}),t}();e.default=f}})}));