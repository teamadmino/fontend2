!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("adm.@angular/common"),require("adm.@angular/cdk"),require("adm.@angular/material"),require("adm.rxjs"),require("adm.lodash"),require("adm.rxjs/operators"),require("adm.shared"),require("adm.@angular/core")):"function"==typeof define&&define.amd?define(["adm.@angular/common","adm.@angular/cdk","adm.@angular/material","adm.rxjs","adm.lodash","adm.rxjs/operators","adm.shared","adm.@angular/core"],e):"object"==typeof exports?exports.group=e(require("adm.@angular/common"),require("adm.@angular/cdk"),require("adm.@angular/material"),require("adm.rxjs"),require("adm.lodash"),require("adm.rxjs/operators"),require("adm.shared"),require("adm.@angular/core")):t.group=e(t["adm.@angular/common"],t["adm.@angular/cdk"],t["adm.@angular/material"],t["adm.rxjs"],t["adm.lodash"],t["adm.rxjs/operators"],t["adm.shared"],t["adm.@angular/core"])}("undefined"!=typeof self?self:this,(function(t,e,n,i,o,r,s,a){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,(function(e){return t[e]}).bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/assets/plugins/group",n(n.s=0)}({0:function(t,e,n){t.exports=n("zUnb")},"0S4P":function(e,n){e.exports=t},"8Yb7":function(t,n){t.exports=e},MdUB:function(t,e){t.exports=n},R1Gc:function(t,e){},Vgaj:function(t,e){t.exports=i},YLtl:function(t,e){t.exports=o},aP7H:function(t,e){t.exports=r},cfyg:function(t,e){t.exports=s},vOrQ:function(t,e){t.exports=a},zUnb:function(t,e,n){"use strict";n.r(e),n.d(e,"GroupModule",(function(){return b}));var i=n("0S4P"),o=(n("R1Gc"),n("vOrQ")),r=n("cfyg"),s=n("YLtl"),a=n("8Yb7"),l=n("aP7H"),p=n("Vgaj"),h=function(){function t(t){this.el=t,this.activeState={},this.nextState={},this.positionConfig={construction:"default",minW:void 0,minH:void 0,maxW:void 0,maxH:void 0,initW:void 0,initH:void 0,fillX:void 0,fillY:void 0,x:-1,y:-1,h:-1,w:-1,index:-1,hidden:!1,append:!1,newline:!1,eol:!1,alignRight:!1,alignCenter:!1,alignBottom:!1,alignMiddle:!1,lineAlignBottom:!1,lineAlignMiddle:!1,stickyAuto:!1,stickyFloat:!1,clone:"",sticky:0,groupConfig:{innerPadding:0,elementsPadding:0,pageCenter:!1,pageMiddle:!1,justifiedGrid:!1},calculated:!1,autoStickers:[]},this.prevLayout={},this.inited=!1,this.internalListeners={},this.eventListeners={},this.renderer=this.el.renderer}return t.prototype.listenEvent=function(t){var e=this;if(this.eventListeners[t])console.warn("Already listenting for event trigger",t,"on",this.getId());else{var n=this.renderer.listen(this.getWrapperDom(),t,(function(n){e.layoutController.positionController.onElementEvent(e,t,n)}));this.eventListeners[t]=n}},t.prototype.isListeningFor=function(t){return!!this.eventListeners[t]},t.prototype.init=function(t){var e=this;if(this.layoutController=t,this.layoutController.rootEl.el.wrapperComponentRef&&this.renderer.setStyle(this.getWrapperDom(),"position","absolute"),this.el.contentSizeChanged$.pipe(Object(l.takeUntil)(this.el.destroy$)).subscribe((function(t){e.layoutController.positionController.onElementSizeChanged(e,t)})),this.processLayoutConfig(this.prevLayout,this.getLayout(),Object(r.deepCompare)(this.prevLayout,this.getLayout())),"group"===this.getType()){this.internalListeners.scroll=this.renderer.listen(this.el.pluginComponentRef.instance.wrapperEl.nativeElement,"scroll",(function(t){e.layoutController.positionController.onGroupScroll(e)}));var n=this.getChildren();n&&Object.keys(n).forEach((function(t){n[t].init(e.layoutController)}))}this.inited=!0},t.prototype.update=function(t){if(this.inited||this.init(t),this.processLayoutConfig(this.prevLayout,this.getLayout(),Object(r.deepCompare)(this.prevLayout,this.getLayout())),"group"===this.getType()){var e=this.getChildren();e&&Object.keys(e).forEach((function(n){e[n].update(t)}))}},t.prototype.processLayoutConfig=function(t,e,n){var i=this,o=n.diff;(o.draggable||o.scalable)&&(this.clearListener("mouseOver"),this.clearListener("mouseDown"),(e.draggable||e.scalable)&&(this.internalListeners.mouseOver=this.renderer.listen(this.getWrapperDom(),"mouseover",(function(t){t.stopPropagation(),i.layoutController.activeEl===i||i.layoutController.activeElementEngaged||i.layoutController.activate(i)}))),e.draggable&&(this.internalListeners.mouseDown=this.renderer.listen(this.getPluginDom(),"mousedown",(function(t){i.layoutController.activeEl===i&&i.layoutController.controls.instance.dragStart(t)})))),this.prevLayout=Object(s.cloneDeep)(e)},t.prototype.clearListener=function(t){this.internalListeners[t]&&(this.internalListeners[t](),delete this.internalListeners[t])},t.prototype.getParent=function(){var t,e,n,i;return null===(i=null===(n=null===(e=null===(t=this.el)||void 0===t?void 0:t.parentContext)||void 0===e?void 0:e.pluginComponentRef)||void 0===n?void 0:n.instance)||void 0===i?void 0:i.layoutElement},t.prototype.getRoot=function(){return this.getParentContext().pluginComponentRef.instance.rootLayoutElement},t.prototype.applyMinMaxToNextStateNaturalSize=function(){this.nextState.naturalWidth<this.positionConfig.minW&&(this.nextState.naturalWidth=this.positionConfig.minW),this.nextState.naturalWidth>this.positionConfig.maxW&&-1!==this.positionConfig.maxW&&(this.nextState.naturalWidth=this.positionConfig.maxW),this.nextState.naturalHeight<this.positionConfig.minH&&(this.nextState.naturalHeight=this.positionConfig.minH),this.nextState.naturalHeight>this.positionConfig.maxH&&-1!==this.positionConfig.maxH&&(this.nextState.naturalHeight=this.positionConfig.maxH)},t.prototype.getScript=function(){var t;return s.isNil(this.el.pluginConfig.layout)||s.isNil(null===(t=this.el.pluginConfig.layout)||void 0===t?void 0:t.script)?[]:this.el.pluginConfig.layout.script.split(",")},t.prototype.getIntInRangeOrDefault=function(t,e,n,i){return void 0===t||(t=Math.round(t))<e||n<t?i:t},t.prototype.getNumberInRangeOrDefault=function(t,e,n,i){return void 0===t||t<e||n<t?i:t},t.prototype.getBooleanOrDefault=function(t,e){return void 0===t?e:t},t.prototype.setupConfig=function(){var t,e,n=this,i=s.isNil(this.el.pluginConfig.layout)?{}:this.el.pluginConfig.layout;if(!s.isNil(i.clone)||!s.isNil(this.getParent())){var o=this.getParent().getChildren()[i.clone];if(!Object(s.isNil)(o)&&!s.isNil(o.getLayout())){this.positionConfig.clone=i.clone;var r=Object(s.cloneDeep)(o.getLayout());Object.assign(r,i),i=r}}void 0!==i.construction&&(this.positionConfig.construction=i.construction);var a=this.getIntInRangeOrDefault(i.h,1,99999,-1);a>0?this.positionConfig.minH=this.positionConfig.maxH=a:(this.positionConfig.minH=this.getIntInRangeOrDefault(i.minH,1,99999,-1),this.positionConfig.maxH=this.getIntInRangeOrDefault(i.maxH,1,99999,-1));var l=this.getIntInRangeOrDefault(i.w,1,99999,-1);if(l>0?this.positionConfig.minW=this.positionConfig.maxW=l:(this.positionConfig.minW=this.getIntInRangeOrDefault(i.minW,1,99999,-1),this.positionConfig.maxW=this.getIntInRangeOrDefault(i.maxW,1,99999,-1)),this.positionConfig.fillX=this.getNumberInRangeOrDefault(i.fillX,0,99999,0),this.positionConfig.fillY=this.getNumberInRangeOrDefault(i.fillY,0,99999,0),this.positionConfig.initW=this.getNumberInRangeOrDefault(i.initW,0,99999,-1),this.positionConfig.initH=this.getNumberInRangeOrDefault(i.initH,0,99999,-1),this.positionConfig.x=this.getNumberInRangeOrDefault(i.x,0,99999,-1),this.positionConfig.y=this.getNumberInRangeOrDefault(i.y,0,99999,-1),this.positionConfig.h=this.getNumberInRangeOrDefault(i.h,0,99999,-1),this.positionConfig.w=this.getNumberInRangeOrDefault(i.w,0,99999,-1),this.positionConfig.index=this.getNumberInRangeOrDefault(i.index,0,99999,-1),this.positionConfig.hidden=this.getBooleanOrDefault(i.hidden,!1),this.positionConfig.append=!1,this.positionConfig.newline=!1,this.positionConfig.eol=!1,this.positionConfig.alignRight=!1,this.positionConfig.alignCenter=!1,this.positionConfig.alignBottom=!1,this.positionConfig.alignMiddle=!1,this.positionConfig.lineAlignBottom=!1,this.positionConfig.lineAlignMiddle=!1,this.positionConfig.stickyAuto=!1,this.positionConfig.stickyFloat=!1,this.getScript().forEach((function(t){switch(t){case"append":n.positionConfig.append=!0;break;case"newline":n.positionConfig.newline=!0;break;case"eol":n.positionConfig.eol=!0;break;case"alignRight":n.positionConfig.alignRight=!0;break;case"alignCenter":n.positionConfig.alignCenter=!0;break;case"alignBottom":n.positionConfig.alignBottom=!0;break;case"alignMiddle":n.positionConfig.alignMiddle=!0;break;case"lineAlignBottom":n.positionConfig.lineAlignBottom=!0;break;case"lineAlignMiddle":n.positionConfig.lineAlignMiddle=!0;break;case"sticky-tl":n.positionConfig.sticky=36;break;case"sticky-tc":n.positionConfig.sticky=34;break;case"sticky":case"sticky-tr":n.positionConfig.sticky=33;break;case"sticky-ml":n.positionConfig.sticky=20;break;case"sticky-mc":n.positionConfig.sticky=18;break;case"sticky-mr":n.positionConfig.sticky=17;break;case"sticky-bl":n.positionConfig.sticky=12;break;case"sticky-bc":n.positionConfig.sticky=10;break;case"sticky-br":n.positionConfig.sticky=9;break;case"stickyAuto":n.positionConfig.stickyAuto=!0;break;case"stickyFloat":n.positionConfig.stickyFloat=!0;break;case"":break;default:console.error("Unknown script command: ",n.getId(),"=>",t)}})),"group"===this.getType()){var p=s.isNil(null===(t=this.el.pluginConfig.config)||void 0===t?void 0:t.layoutConfig)?{}:null===(e=this.el.pluginConfig.config)||void 0===e?void 0:e.layoutConfig;this.positionConfig.groupConfig.innerPadding=this.getIntInRangeOrDefault(p.innerPadding,-99999,99999,0),this.positionConfig.groupConfig.elementsPadding=this.getIntInRangeOrDefault(p.elementsPadding,0,99999,0),this.positionConfig.groupConfig.pageCenter=this.getBooleanOrDefault(p.pageCenter,!1),this.positionConfig.groupConfig.pageMiddle=this.getBooleanOrDefault(p.pageMiddle,!1),this.positionConfig.groupConfig.justifiedGrid=this.getBooleanOrDefault(p.justifiedGrid,!1)}},t.prototype.getParentDom=function(){return this.el.currentParentContext.pluginComponentRef.instance.wrapperEl.nativeElement},t.prototype.getParentVC=function(){return this.el.currentParentContext.pluginComponentRef.instance.targetVC},t.prototype.getParentContext=function(){return this.el.parentContext},t.prototype.getWrapperDom=function(){return this.el.wrapperComponentRef.location.nativeElement},t.prototype.getPluginDom=function(){return this.el.pluginComponentRef.location.nativeElement},t.prototype.getPlugin=function(){return this.el.pluginComponentRef},t.prototype.getTargetVC=function(){return"group"!==this.getType()?(console.warn("Only groups have target ViewContainer"),null):this.el.pluginComponentRef.instance.targetVC},t.prototype.getType=function(){return this.el.pluginConfig.type},t.prototype.getId=function(){return this.el.id},t.prototype.getChildren=function(){return"group"===this.getType()?this.el.pluginComponentRef.instance.layoutElements:null},t.prototype.getLayout=function(){return this.el.pluginConfig.layout},t.prototype.getLayoutConfig=function(){var t;return null===(t=this.el.parentContext.pluginConfig.config)||void 0===t?void 0:t.layoutConfig},t.prototype.getConfig=function(){return this.el.pluginConfig},t.prototype.getScrolledDom=function(){return"group"===this.getType()?this.el.pluginComponentRef.instance.wrapperEl.nativeElement:null},t.prototype.getRootVC=function(){return this.el.rootContext.pluginComponentRef.instance.targetVC},t.prototype.redraw=function(){return this.el.redraw$.next()},t.prototype.calculateNaturalSize=function(){if(void 0!==this.el.wrapperComponentRef){if(this.positionConfig.calculated)return{width:this.nextState.naturalWidth,height:this.nextState.naturalHeight};if(this.positionConfig.h>0&&this.positionConfig.w>0)return{width:this.positionConfig.w,height:this.positionConfig.h,clientWidth:this.positionConfig.w,clientHeight:this.positionConfig.h};var t,e,n,i,o,r,s=this.getWrapperDom().style.position;this.renderer.setStyle(this.getWrapperDom(),"position","absolute"),void 0!==this.getWrapperDom().parentNode&&(t=this.getWrapperDom().parentNode.style.minWidth,e=this.getWrapperDom().parentNode.style.minHeight,o=this.getWrapperDom().parentNode.style.maxWidth,r=this.getWrapperDom().parentNode.style.maxHeight,n=this.getWrapperDom().parentNode.style.minWidth,i=this.getWrapperDom().parentNode.style.minHeight,this.renderer.setStyle(this.getWrapperDom().parentNode,"min-width","99999px"),this.renderer.setStyle(this.getWrapperDom().parentNode,"min-height","99999px"),this.renderer.setStyle(this.getWrapperDom().parentNode,"max-width","99999px"),this.renderer.setStyle(this.getWrapperDom().parentNode,"max-height","99999px"),this.renderer.setStyle(this.getWrapperDom().parentNode,"width","99999px"),this.renderer.setStyle(this.getWrapperDom().parentNode,"height","99999px")),this.renderer.removeStyle(this.getWrapperDom(),"width"),this.renderer.removeStyle(this.getWrapperDom(),"height"),this.renderer.removeStyle(this.getWrapperDom(),"max-width"),this.renderer.removeStyle(this.getWrapperDom(),"max-height");var a=this.getWrapperDom().style.top,l=this.getWrapperDom().style.left,p=this.getWrapperDom().style.transition;this.renderer.setStyle(this.getWrapperDom(),"transition","none"),this.renderer.setStyle(this.getWrapperDom(),"top",0),this.renderer.setStyle(this.getWrapperDom(),"left",0);var h=this.el.pluginComponentRef.location.nativeElement,c=h.style.maxWidth,g=h.style.maxHeight,u=h.style.minWidth,d=h.style.minHeight;this.positionConfig.maxW>0&&this.renderer.setStyle(h,"max-width",this.positionConfig.maxW+"px"),this.positionConfig.minW>0&&this.renderer.setStyle(h,"min-width",this.positionConfig.minW+"px"),this.positionConfig.maxH>0&&this.renderer.setStyle(h,"max-height",this.positionConfig.maxH+"px"),this.positionConfig.minH>0&&this.renderer.setStyle(h,"min-height",this.positionConfig.minH+"px");var f=h;"group"===this.getType()&&(f=this.el.pluginComponentRef.instance.wrapperEl.nativeElement);var m=f.getBoundingClientRect(),C={width:m.width,height:m.height,clientWidth:f.clientWidth,clientHeight:f.clientHeight};return-1!=this.positionConfig.initW&&(C.width=this.positionConfig.initW),-1!=this.positionConfig.initH&&(C.height=this.positionConfig.initH),this.positionConfig.maxH>0&&C.height>this.positionConfig.maxH&&(C.height=this.positionConfig.maxH),this.positionConfig.minH>0&&C.height<this.positionConfig.minH&&(C.height=this.positionConfig.minH),this.positionConfig.maxW>0&&C.width>this.positionConfig.maxW&&(C.width=this.positionConfig.maxW),this.positionConfig.minW>0&&C.width<this.positionConfig.minW&&(C.width=this.positionConfig.minW),this.positionConfig.maxW>0&&this.renderer.setStyle(h,"max-width",c),this.positionConfig.minW>0&&this.renderer.setStyle(h,"min-width",u),this.positionConfig.maxH>0&&this.renderer.setStyle(h,"max-height",g),this.positionConfig.minH>0&&this.renderer.setStyle(h,"min-height",d),void 0!==this.getWrapperDom().parentNode&&(this.renderer.setStyle(this.getWrapperDom().parentNode,"min-width",n),this.renderer.setStyle(this.getWrapperDom().parentNode,"min-height",i),this.renderer.setStyle(this.getWrapperDom().parentNode,"max-width",o),this.renderer.setStyle(this.getWrapperDom().parentNode,"max-height",r),this.renderer.setStyle(this.getWrapperDom().parentNode,"width",t),this.renderer.setStyle(this.getWrapperDom().parentNode,"height",e)),this.renderer.setStyle(this.getWrapperDom(),"top",a),this.renderer.setStyle(this.getWrapperDom(),"left",l),this.renderer.setStyle(this.getWrapperDom(),"transition",p),this.renderer.setStyle(this.el.wrapperComponentRef.location.nativeElement,"position",s),this.positionConfig.calculated=!0,C}},t.prototype.setNextState=function(t){Object.assign(this.nextState,t)},t.prototype.updateState=function(){this.applyState(this.nextState)},t.prototype.resetState=function(){this.nextState=Object(s.cloneDeep)(this.activeState),this.applyState(this.nextState)},t.prototype.commitState=function(){var t=this.nextState;this.activeState=Object.assign(this.activeState,this.nextState),this.applyState(t)},t.prototype.applyState=function(t){var e=this.getWrapperDom();this.renderer.setStyle(e,"left",t.left+"px"),this.renderer.setStyle(e,"top",t.top+"px"),this.renderer.setStyle(e,"width",t.width+"px"),this.renderer.setStyle(e,"height",t.height+"px"),this.renderer.setStyle(e,"max-width",t.width+"px"),this.renderer.setStyle(e,"max-height",t.height+"px"),this.renderer.setStyle(e,"z-index",t.zIndex),this.renderer.setStyle(e,"opacity",t.opacity),this.renderer.setStyle(e,"transition",t.transition),this.renderer.setStyle(e,"padding",(Object(s.isNil)(t.paddingTop)?0:t.paddingTop)+"px\n      "+(Object(s.isNil)(t.paddingRight)?0:t.paddingRight)+"px\n      "+(Object(s.isNil)(t.paddingBottom)?0:t.paddingBottom)+"px\n      "+(Object(s.isNil)(t.paddingLeft)?0:t.paddingLeft)+"px")},t.prototype.applyStyles=function(t){var e=this,n=this.getWrapperDom();Object.keys(t).forEach((function(i){e.renderer.setStyle(n,i,t[i])}))},t.prototype.destroy=function(){var t=this;Object.keys(this.internalListeners).forEach((function(e){t.internalListeners[e]()})),Object.keys(this.eventListeners).forEach((function(e){t.eventListeners[e]()})),this.el.destroy()},t}(),c=["buttonsRef"],g=function(t){return{"drag-active":t}};function u(t,e){if(1&t){var n=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementContainerStart"](0),o["\u0275\u0275elementStart"](1,"div",3),o["\u0275\u0275listener"]("mousedown",(function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"n")})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](2,"div",4),o["\u0275\u0275listener"]("mousedown",(function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"s")})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](3,"div",5),o["\u0275\u0275listener"]("mousedown",(function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"w")})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](4,"div",6),o["\u0275\u0275listener"]("mousedown",(function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"e")})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](5,"div",7),o["\u0275\u0275listener"]("mousedown",(function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"nw")})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](6,"div",8),o["\u0275\u0275listener"]("mousedown",(function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"ne")})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](7,"div",9),o["\u0275\u0275listener"]("mousedown",(function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"sw")})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](8,"div",10),o["\u0275\u0275listener"]("mousedown",(function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"se")})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](9,"div",11),o["\u0275\u0275listener"]("mousedown",(function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"n")})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](10,"div",12),o["\u0275\u0275listener"]("mousedown",(function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"s")})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](11,"div",13),o["\u0275\u0275listener"]("mousedown",(function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"w")})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](12,"div",14),o["\u0275\u0275listener"]("mousedown",(function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().scaleStart(t,"e")})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](13,"div",15),o["\u0275\u0275listener"]("mousedown",(function(t){return o["\u0275\u0275restoreView"](n),o["\u0275\u0275nextContext"]().dragStart(t)})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementContainerEnd"]()}if(2&t){var i=o["\u0275\u0275nextContext"]();o["\u0275\u0275advance"](13),o["\u0275\u0275property"]("ngClass",o["\u0275\u0275pureFunction1"](1,g,i.dragActive))}}var d=function(){function t(t,e,n){this.renderer=t,this.cd=e,this.elRef=n,this.ids=[],this.dragStart$=new p.Subject,this.drag$=new p.Subject,this.dragEnd$=new p.Subject,this.scale$=new p.Subject,this.scaleEnd$=new p.Subject,this.scaleStart$=new p.Subject,this.mouseEnter$=new p.Subject,this.mouseLeave$=new p.Subject,this.click$=new p.Subject,this.buttonEvent$=new p.Subject,this.doubleClick$=new p.Subject,this.bgStyle={},this.dragActive=!1,this.scaleActive=!1,this.dragData={startX:0,startY:0,deltaX:0,deltaY:0},this.renderer.setStyle(this.elRef.nativeElement,"z-index",1e5)}return t.prototype.evt=function(t){this.click$.next({ids:this.ids,data:null,e:t})},t.prototype.mouseUp=function(t){clearTimeout(this.dragTimer)},t.prototype.handleButtonEvent=function(t){t.elementButton.supportDrag?(this.elementButton=t.elementButton,this.dragStart(t.event,this.elementButton)):this.buttonEvent$.next({ids:this.ids,data:null,elementButton:t.elementButton,e:t.event})},t.prototype.ngOnInit=function(){},t.prototype.applyBgStyle=function(t){Object.assign(this.bgStyle,t),this.cd.markForCheck()},t.prototype.doubleClick=function(t){this.doubleClick$.next({ids:this.ids,data:null,e:t})},t.prototype.mouseEnter=function(t){this.mouseEnter$.next({ids:this.ids,data:t,e:t})},t.prototype.mouseLeave=function(t){this.mouseLeave$.next({ids:this.ids,data:t,e:t})},t.prototype.setIds=function(t){this.ids=t},t.prototype.dragStart=function(t,e){var n=this;void 0===e&&(e=null),clearTimeout(this.dragTimer),t.preventDefault();var i=this.wrapperEl.nativeElement.getBoundingClientRect();this.dragData.startX=t.pageX-i.left,this.dragData.startY=t.pageY-i.top,this.dragTimer=setTimeout((function(i){n.dragActive=!0,delete n.dragData.direction,n.registerMouseListeners(),n.dragStart$.next({ids:n.ids,data:n.dragData,elementButton:e,e:t})}),100)},t.prototype.scaleStart=function(t,e){t.preventDefault();var n=this.wrapperEl.nativeElement.getBoundingClientRect();this.dragData.startX=t.pageX-n.left,this.dragData.startY=t.pageY-n.top,this.dragData.direction=e,this.scaleActive=!0,this.registerMouseListeners(),this.scaleStart$.next({ids:this.ids,data:this.dragData,e:t})},t.prototype.onMouseMove=function(t){var e=this.wrapperEl.nativeElement.getBoundingClientRect();this.dragData.deltaX=t.pageX-e.left-this.dragData.startX,this.dragData.deltaY=t.pageY-e.top-this.dragData.startY,this.dragActive&&this.drag$.next({ids:this.ids,data:this.dragData,elementButton:this.elementButton,e:t}),this.scaleActive&&this.scale$.next({ids:this.ids,data:this.dragData,e:t})},t.prototype.onMouseUp=function(t){this.dragActive&&this.dragEnd$.next({ids:this.ids,data:this.dragData,elementButton:this.elementButton,e:t}),this.scaleActive&&this.scaleEnd$.next({ids:this.ids,data:this.dragData,e:t}),this.elementButton=null,this.dragActive=!1,this.scaleActive=!1,this.cleanUpMouseListeners(),this.cd.markForCheck()},t.prototype.registerMouseListeners=function(){var t=this;this.cleanUpMouseListeners(),this.mouseUpListener=this.renderer.listen("window","mouseup",(function(e){return t.onMouseUp(e)})),this.mouseMoveListener=this.renderer.listen("window","mousemove",(function(e){return t.onMouseMove(e)}))},t.prototype.cleanUpMouseListeners=function(){this.mouseUpListener&&this.mouseUpListener(),this.mouseMoveListener&&this.mouseMoveListener()},t.prototype.ngOnDestroy=function(){this.scaleActive&&this.scaleEnd$.next({ids:this.ids,data:this.dragData,e:null}),this.dragActive&&this.dragEnd$.next({ids:this.ids,data:this.dragData,elementButton:this.elementButton,e:null}),this.cleanUpMouseListeners()},t.prototype.setPos=function(t){var e=this.elRef.nativeElement;this.renderer.setStyle(e,"left",t.left+"px"),this.renderer.setStyle(e,"top",t.top+"px")},t.prototype.setSize=function(t){var e=this.elRef.nativeElement;this.renderer.setStyle(e,"width",t.width+"px"),this.renderer.setStyle(e,"height",t.height+"px"),this.renderer.setStyle(e,"max-width",t.width+"px"),this.renderer.setStyle(e,"max-height",t.height+"px")},t.prototype.setTransition=function(t){this.renderer.setStyle(this.elRef.nativeElement,"transition",t)},t.prototype.hide=function(){this.renderer.setStyle(this.elRef.nativeElement,"display","none")},t.prototype.show=function(){this.renderer.setStyle(this.elRef.nativeElement,"display","block")},t.prototype.update=function(){this.layoutController.updateControl()},t.\u0275fac=function(e){return new(e||t)(o["\u0275\u0275directiveInject"](o.Renderer2),o["\u0275\u0275directiveInject"](o.ChangeDetectorRef),o["\u0275\u0275directiveInject"](o.ElementRef))},t.\u0275cmp=o["\u0275\u0275defineComponent"]({type:t,selectors:[["app-layout-element-controls"]],viewQuery:function(t,e){var n;1&t&&o["\u0275\u0275viewQuery"](c,!0,o.ElementRef),2&t&&o["\u0275\u0275queryRefresh"](n=o["\u0275\u0275loadQuery"]())&&(e.buttons=n.first)},hostBindings:function(t,e){1&t&&o["\u0275\u0275listener"]("click",(function(t){return e.evt(t)}))("mouseup",(function(t){return e.mouseUp(t)}),!1,o["\u0275\u0275resolveDocument"])},decls:3,vars:5,consts:[[1,"wrapper",3,"mouseenter","mouseleave","dblclick"],[1,"bg",3,"ngClass","ngStyle","mousedown"],[4,"ngIf"],[1,"drag","horizontal","top",3,"mousedown"],[1,"drag","horizontal","bottom",3,"mousedown"],[1,"drag","vertical","left",3,"mousedown"],[1,"drag","vertical","right",3,"mousedown"],[1,"drag","corner","nw",3,"mousedown"],[1,"drag","corner","ne",3,"mousedown"],[1,"drag","corner","sw",3,"mousedown"],[1,"drag","corner","se",3,"mousedown"],[1,"drag","center-control","n",3,"mousedown"],[1,"drag","center-control","s",3,"mousedown"],[1,"drag","center-control","w",3,"mousedown"],[1,"drag","center-control","e",3,"mousedown"],[1,"drag","center-drag",3,"ngClass","mousedown"]],template:function(t,e){1&t&&(o["\u0275\u0275elementStart"](0,"div",0),o["\u0275\u0275listener"]("mouseenter",(function(t){return e.mouseEnter(t)}))("mouseleave",(function(t){return e.mouseLeave(t)}))("dblclick",(function(t){return e.doubleClick(t)})),o["\u0275\u0275elementStart"](1,"div",1),o["\u0275\u0275listener"]("mousedown",(function(t){return e.dragStart(t)})),o["\u0275\u0275elementEnd"](),o["\u0275\u0275template"](2,u,14,3,"ng-container",2),o["\u0275\u0275elementEnd"]()),2&t&&(o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngClass",o["\u0275\u0275pureFunction1"](3,g,e.dragActive))("ngStyle",e.bgStyle),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngIf",e.scalable&&!e.hideControls))},directives:[i.NgClass,i.NgStyle,i.NgIf],styles:["[_nghost-%COMP%]{outline:1px solid rgba(var(--theme-accent-600));outline-offset:-1px;width:100%;height:100%;top:0;left:0;position:absolute;pointer-events:none}.control-buttons[_ngcontent-%COMP%]{position:absolute;bottom:100%;right:0;pointer-events:all}.control-buttons.bottom[_ngcontent-%COMP%]{top:100%;bottom:auto}.control-buttons.right[_ngcontent-%COMP%]{left:0;right:auto}.wrapper[_ngcontent-%COMP%]{top:0;left:0;opacity:1;transition:opacity .2s;pointer-events:none}.bg[_ngcontent-%COMP%], .wrapper[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute}.bg[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.bg.drag-active[_ngcontent-%COMP%]{pointer-events:all}.info[_ngcontent-%COMP%]{top:15px;left:15px;word-wrap:break-word;max-width:100%;padding:5px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;pointer-events:none;font-size:10px;background-color:rgba(50,50,50,.5)}.corner[_ngcontent-%COMP%], .info[_ngcontent-%COMP%]{position:absolute}.corner[_ngcontent-%COMP%]{pointer-events:all;width:10px;height:10px;background-color:rgba(var(--theme-background-600));border:2px solid rgba(var(--theme-accent-600));border-radius:5px}.corner.nw[_ngcontent-%COMP%]{top:-5px;left:-5px;cursor:nw-resize}.corner.ne[_ngcontent-%COMP%]{top:-5px;right:-5px;cursor:ne-resize}.corner.sw[_ngcontent-%COMP%]{bottom:-5px;left:-5px;cursor:sw-resize}.corner.se[_ngcontent-%COMP%]{bottom:-5px;right:-5px;cursor:se-resize}.center-drag[_ngcontent-%COMP%]{width:10px;height:10px;position:absolute;background-color:rgba(var(--theme-accent-600));border-radius:5px;top:50%;left:50%;transform:translateX(-50%) translateY(-50%);pointer-events:all;cursor:-webkit-grab;cursor:grab}.center-drag.drag-active[_ngcontent-%COMP%]{cursor:-webkit-grabbing;cursor:grabbing}.center-control[_ngcontent-%COMP%]{pointer-events:all;width:7px;height:7px;position:absolute;background-color:rgba(var(--theme-accent-600));border-radius:5px}.center-control.n[_ngcontent-%COMP%]{top:-3.5px;left:calc(50% - 3.5px);cursor:n-resize}.center-control.s[_ngcontent-%COMP%]{bottom:-3.5px;left:calc(50% - 3.5px);cursor:s-resize}.center-control.w[_ngcontent-%COMP%]{left:-3.5px;cursor:w-resize}.center-control.e[_ngcontent-%COMP%], .center-control.w[_ngcontent-%COMP%]{top:calc(50% - 3.5px);transform:rotate(90deg)}.center-control.e[_ngcontent-%COMP%]{right:-3.5px;cursor:e-resize}.horizontal[_ngcontent-%COMP%]{pointer-events:all;cursor:n-resize;position:absolute;width:100%;height:10px;left:0}.horizontal.top[_ngcontent-%COMP%]{top:0}.horizontal.bottom[_ngcontent-%COMP%]{cursor:s-resize;bottom:0}.vertical[_ngcontent-%COMP%]{pointer-events:all;cursor:w-resize;position:absolute;height:100%;width:10px;top:0}.vertical.left[_ngcontent-%COMP%]{left:0}.vertical.right[_ngcontent-%COMP%]{cursor:e-resize;right:0}.topleft[_ngcontent-%COMP%]{cursor:nw-resize;left:0;top:0}.topright[_ngcontent-%COMP%]{cursor:ne-resize;right:0;top:0}.bottomleft[_ngcontent-%COMP%]{cursor:sw-resize;left:0;bottom:0}.bottomright[_ngcontent-%COMP%]{cursor:se-resize;right:0;bottom:0}"]}),t}(),f=function(){function t(t,e){this.rootEl=t,this.layoutController=e,this.tempElements={},this.timeouts=[],this.initEl(this.rootEl)}return t.prototype.getSortedElementList=function(t){var e=t.getChildren(),n=[];if(e){for(var i={},o=1e3,r=0,s=Object.values(e);r<s.length;r++){var a=s[r];if(!a.positionConfig.hidden){var l=a.positionConfig.index;(l<0||l+1e4 in i)&&(l=o++),i[l+1e4]=a}}Object.keys(i).sort().forEach((function(t){n.push(i[t])}))}return n},t.prototype.dump=function(t){console.log(t.getId(),t.activeState.width,t.activeState.height)},t.prototype.recalculateLayout=function(t,e){void 0!==this.rootEl.el.wrapperComponentRef&&(this.rootEl.setNextState({width:t,height:e,renderedContentWidth:t,renderedContentHeight:e,naturalWidth:t,naturalHeight:e}),"script"===this.rootEl.positionConfig.construction&&this.recalculateLayoutHelper(this.rootEl),this.rootEl.commitState(),this.rootEl.renderer.setStyle(this.rootEl.getWrapperDom(),"width","100%"),this.rootEl.renderer.setStyle(this.rootEl.getWrapperDom(),"height","100%"),this.rootEl.renderer.removeStyle(this.rootEl.getWrapperDom(),"max-width"),this.rootEl.renderer.removeStyle(this.rootEl.getWrapperDom(),"min-witdh"),this.rootEl.renderer.removeStyle(this.rootEl.getWrapperDom(),"max-height"),this.rootEl.renderer.removeStyle(this.rootEl.getWrapperDom(),"min-height"))},t.prototype.recalculateLayoutHelper=function(t){t.applyMinMaxToNextStateNaturalSize();var e,n,i,o,r=t.positionConfig.groupConfig.innerPadding,s=t.positionConfig.groupConfig.elementsPadding,a=t.getChildren(),l=[],p=[],h=[],c=-1,g=this.getSortedElementList(t);return i=!1,o=void 0,u(),g.forEach((function(a){if("group"===a.getType()&&(a.setNextState({naturalWidth:0,naturalHeight:0}),a.applyMinMaxToNextStateNaturalSize()),0===a.positionConfig.sticky||void 0===o){var p=a.nextState.naturalWidth+2*s;a.setNextState({width:a.nextState.naturalWidth,height:a.nextState.naturalHeight}),(i||!a.positionConfig.append&&l[c].length>0&&(a.positionConfig.newline||n+p+r>t.nextState.naturalWidth))&&u(),l[c].push(a),a.setNextState({left:n+s,top:e+s,width:a.nextState.naturalWidth,height:a.nextState.naturalHeight,transition:"left 0.3s, top 0.3s, width 0.3s, height 0.3s, max-width 0.3s, min-width 0.3s, max-height 0.3s, min-height 0.3s"}),n+=p,i=a.positionConfig.eol,o=a}else h.push({holder:o,sticker:a})})),l.forEach((function(e){if(!(t.nextState.naturalWidth-f(e)<1)){var i=!1;if(e.forEach((function(t){return i=i||0!==t.positionConfig.fillX})),i){var o,a=t.nextState.naturalWidth-2*r;if(m(a,e)<=t.nextState.naturalWidth)o=a;else for(o=0;a-o>=.001;){var l=(a+o)/2;m(l,e)<=t.nextState.naturalWidth?o=l:a=l}n=r,e.forEach((function(t){t.nextState.left=n+s,t.nextState.width=C(o,e,t),n+=t.nextState.width+2*s}))}}})),function(){var n=[];if(l.forEach((function(t,e){for(var i=0;i<t.length;i++)if(t[i].positionConfig.fillY){n.push(e);break}})),0!==n.length){var i,o=t.nextState.naturalHeight-2*r,a=o;if(y(o)<=t.nextState.naturalHeight)i=o;else for(i=0;o-i>=.001;){var p=(o+i)/2;y(p)<=t.nextState.naturalHeight?i=p:o=p}n.forEach((function(t){var e=v(i,t);l[t].forEach((function(t){if(0!==t.positionConfig.fillY){var n=t.positionConfig.fillY*a/100;n<t.nextState.height&&(n=t.nextState.height),t.nextState.height=Math.min(-1===t.positionConfig.maxH?n:t.positionConfig.maxH,n,e)}}))})),e=r,l.forEach((function(t){t.forEach((function(t){return t.nextState.top=e+s})),e+=d(t)}))}}(),l.forEach((function(e){for(var n=t.nextState.naturalWidth-f(e),i=0;i<e.length&&n>0;i++){var o=e[i];if(o.positionConfig.alignRight){for(var r=i;r<e.length;r++)e[r].nextState.left+=n;break}if(o.positionConfig.alignCenter){var s=(t.nextState.naturalWidth-o.nextState.width)/2;if(s<=o.nextState.left)continue;var a=s-o.nextState.left;for(a>n&&(a=n),r=i;r<e.length;r++)e[r].nextState.left+=a;n-=a}}})),(function(){e=r,l.forEach((function(t){p.push(e+s);var n=d(t)-2*s;t.forEach((function(t){t.positionConfig.alignMiddle&&(t.nextState.top=(n-t.nextState.height)/2+e+s),t.positionConfig.alignBottom&&(t.nextState.top=n-t.nextState.height+e+s)})),e+=n+2*s})),t===this.rootEl&&(e+=r)>t.nextState.height&&(t.nextState.height=e)}).bind(this)(),function(){var e=2*r;l.forEach((function(t){return e+=d(t)}));for(var n=t.nextState.naturalHeight-e,i=function(e){var i=!1,o=!1;if(l[e].forEach((function(t){i=i||t.positionConfig.lineAlignBottom,o=o||t.positionConfig.lineAlignMiddle})),i){for(var r=e;r<l.length;r++)l[r].forEach((function(t){return t.nextState.top+=n}));return"break"}if(o){var a=(t.nextState.naturalHeight-d(l[e]))/2+s;if(a<=p[e])return"continue";var h=a-p[e];for(h>n&&(h=n),r=e;r<l.length;r++)l[r].forEach((function(t){return t.nextState.top+=h})),p[r]+=h;n-=h}},o=0;o<l.length&&n>0&&"break"!==i(o);o++);}(),(function(){t.positionConfig.groupConfig.pageCenter&&l.forEach((function(e){var n=f(e);if(n<t.nextState.naturalWidth){var i=(t.nextState.naturalWidth-n)/2;e.forEach((function(t){return t.nextState.left+=i}))}}))}).bind(this)(),(function(){if(t.positionConfig.groupConfig.pageMiddle){var e=0;if(g.forEach((function(t){var n=t.nextState.top+t.nextState.height-1;n>e&&(e=n)})),!(e>=t.nextState.naturalHeight-r-1)){var n=(t.nextState.naturalHeight-r-1-e)/2;g.forEach((function(t){return t.nextState.top+=n}))}}}).bind(this)(),(function(){h.forEach((function(t){var e,n,i,o=t.sticker.positionConfig.sticky;if(t.sticker.positionConfig.stickyFloat){var r=t.sticker.nextState.naturalHeight/2;(i=Math.max(t.sticker.getParent().positionConfig.groupConfig.innerPadding,t.sticker.getParent().positionConfig.groupConfig.elementsPadding)+t.sticker.getParent().positionConfig.groupConfig.elementsPadding)>2&&(i-=2),i>r&&(i=r),e=0!=(32&o)?t.holder.nextState.top-i:0!=(8&o)?t.holder.nextState.top+t.holder.nextState.height+i-t.sticker.nextState.naturalHeight:t.holder.nextState.top+t.holder.nextState.height/2-t.sticker.nextState.naturalHeight/2}else e=0!=(32&o)?t.holder.nextState.top:0!=(8&o)?t.holder.nextState.top+t.holder.nextState.height-t.sticker.nextState.naturalHeight:t.holder.nextState.top+t.holder.nextState.height/2-t.sticker.nextState.naturalHeight/2;t.sticker.positionConfig.stickyFloat?(r=t.sticker.nextState.naturalWidth/2,(i=Math.max(t.sticker.getParent().positionConfig.groupConfig.innerPadding,t.sticker.getParent().positionConfig.groupConfig.elementsPadding)+t.sticker.getParent().positionConfig.groupConfig.elementsPadding)>2&&(i-=2),i>r&&(i=r),n=0!=(4&o)?t.holder.nextState.left-i:0!=(1&o)?t.holder.nextState.left+t.holder.nextState.width+i-t.sticker.nextState.naturalWidth:t.holder.nextState.left+t.holder.nextState.width/2-t.sticker.nextState.naturalWidth/2):n=0!=(4&o)?t.holder.nextState.left:0!=(1&o)?t.holder.nextState.left+t.holder.nextState.width-t.sticker.nextState.naturalWidth:t.holder.nextState.left+t.holder.nextState.width/2-t.sticker.nextState.naturalWidth/2,t.sticker.setNextState({left:n,top:e,width:t.sticker.nextState.naturalWidth,height:t.sticker.nextState.naturalHeight,transition:"left 0.3s, top 0.3s, width 0.3s, height 0.3s, max-width 0.3s, min-width 0.3s, max-height 0.3s, min-height 0.3s",zIndex:2}),t.sticker.positionConfig.stickyAuto&&(t.sticker.renderer.setStyle(t.sticker.getWrapperDom(),"display","none"),0===t.holder.positionConfig.autoStickers.length&&(t.holder.listenEvent("mouseenter"),t.holder.listenEvent("mouseleave")),t.holder.positionConfig.autoStickers.push(t.sticker))}))}).bind(this)(),(function(){g.forEach((function(t){t.commitState()}))}).bind(this)(),(function(){var t=this;g.forEach((function(e){"group"===e.getType()&&(e.setNextState({naturalWidth:e.nextState.width,naturalHeight:e.nextState.height}),t.recalculateLayoutHelper(e))}))}).bind(this)(),void t.redraw();function u(){c<0?(e=r,n=r):(n=r,e+=d(l[c])),c++,l.push([])}function d(t){var e=0;return t.forEach((function(t){t.nextState.height>e&&(e=t.nextState.height)})),e+2*s}function f(t){var e=2*r;return t.forEach((function(t){return e+=t.nextState.width+2*s})),e}function m(t,e){var n=2*r;return e.forEach((function(i){return n+=C(t,e,i)+2*s})),n}function C(t,e,n){if(0===n.positionConfig.fillX)return n.nextState.width;if(""!==n.positionConfig.clone){var i=void 0;for(i=0;i<e.length&&e[i].getId()!==n.positionConfig.clone;i++);if(i===e.length)return a[n.positionConfig.clone].nextState.width}var o=n.positionConfig.fillX*t/100-2*s;return o<n.nextState.width&&(o=n.nextState.width),Math.min(-1===n.positionConfig.maxW?o:n.positionConfig.maxW,o)}function y(t){for(var e=2*r,n=0;n<l.length;n++)e+=v(t,n)+2*s;return e}function v(t,e){var n=0;return l[e].forEach((function(e){var i;if(0!==e.positionConfig.fillY){var o=e.positionConfig.fillY*t/100;o<e.nextState.height&&(o=e.nextState.height),i=Math.min(-1===e.positionConfig.maxH?o:e.positionConfig.maxH,o)}else i=e.nextState.height;i>n&&(n=i)})),n}},t.prototype.initEl=function(t){var e=this;t.setupConfig();var n=t.positionConfig,i=t.calculateNaturalSize();if(void 0!==i){if(t.setNextState({naturalWidth:i.width,naturalHeight:i.height,renderedContentWidth:i.width,renderedContentHeight:i.height,width:i.width,height:i.height}),n.hidden?t.renderer.setStyle(t.getWrapperDom(),"display","none"):t.renderer.removeStyle(t.getWrapperDom(),"display"),t!==this.rootEl&&!s.isNil(n))switch(t.getParent().positionConfig.construction){case"script":t.setNextState({zIndex:1,width:i.width,height:i.height,opacity:1});break;default:t.setNextState({zIndex:1,left:n.x,top:n.y,width:n.w,height:n.h,opacity:1}),t.commitState()}var o=t.getChildren();o&&Object.keys(o).forEach((function(t){e.initEl(o[t])})),t===this.rootEl&&this.recalculateLayout(t.getWrapperDom().offsetWidth,t.getWrapperDom().offsetHeight)}},t.prototype.onGroupScroll=function(t){t.getScrolledDom(),this.layoutController.getControl()&&this.layoutController.getControl().update()},t.prototype.onUpdate=function(t,e,n,i){console.log(t,e,n,i),this.initEl(this.rootEl)},t.prototype.onElementEvent=function(t,e,n){switch(console.log("Event triggered on",t.getId(),e),e){case"mouseenter":t.positionConfig.autoStickers.forEach((function(t){return t.renderer.removeStyle(t.getWrapperDom(),"display")}));break;case"mouseleave":t.positionConfig.autoStickers.forEach((function(t){t.renderer.setStyle(t.getWrapperDom(),"display","none")}))}},t.prototype.onElementSizeChanged=function(t,e){"text00"===t.getId()&&console.log("onElementSizeChanged",t.getId(),e),t==this.rootEl&&this.recalculateLayout(e.width,e.height)},t.prototype.onDragStart=function(t,e,n){this.tempElements[t.getId()+"__dragStartPos"]&&(this.tempElements[t.getId()+"__dragStartPos"].destroy(),delete this.tempElements[t.getId()+"__dragStartPos"]),this.tempElements[t.getId()+"__dragStartPos"]=this.layoutController.createTempEl(t.nextState,{"background-color":"rgba(var(--theme-primary-500),0.2)",border:"2px dotted rgba(var(--theme-primary-500),0.2)"},t.getParent());var i=this.layoutController.getPositionDiff(t,this.rootEl);this.layoutController.moveVisuallyToGroup(t,this.rootEl),t.setNextState({left:t.nextState.left+i.left,top:t.nextState.top+i.top,transition:"none"}),t.updateState(),n.applyBgStyle({cursor:"grabbing"})},t.prototype.onDrag=function(t,e,n){var i=this.determineTargetGroup(t,this.layoutController.lastMousePos.x,this.layoutController.lastMousePos.y),o=this.canBeDropped(t,i);o?(n.applyBgStyle({cursor:"grabbing"}),this.tempElements[t.getId()+"__dragStartPos"].applyStyles({"background-color":"rgba(var(--theme-primary-500),0.2)","border-color":"rgba(var(--theme-primary-500),0.2)","border-style":"dotted","background-image":"none","border-radius":"3px"})):(n.applyBgStyle({cursor:"no-drop"}),this.tempElements[t.getId()+"__dragStartPos"].applyStyles({"background-color":"rgba(var(--theme-warn-500),0.5)","border-color":"rgba(var(--theme-warn-500),1)","border-style":"solid","background-image":"repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(var(--theme-warn-500),0.5) 5px, rgba(var(--theme-warn-500),0.5) 10px)"})),t.setNextState({opacity:o?1:.3,transition:"none"}),t.updateState()},t.prototype.onDragEnd=function(t,e,n){var i=this,o=this.determineTargetGroup(t,this.layoutController.lastMousePos.x,this.layoutController.lastMousePos.y);if(this.canBeDropped(t,o)){var r=this.layoutController.getRelativePos(t,o);t.setNextState({left:r.left,top:r.top,transition:"left 0.3s, top 0.3s"}),this.layoutController.moveToGroup(t,o),t.commitState(),this.tempElements[t.getId()+"__dragStartPos"].destroy(),delete this.tempElements[t.getId()+"__dragStartPos"]}else n.hide(),t.updateState(),this.timeouts.push(setTimeout((function(){i.tempElements[t.getId()+"__dragStartPos"]&&(i.tempElements[t.getId()+"__dragStartPos"].destroy(),delete i.tempElements[t.getId()+"__dragStartPos"]),t.resetState(),i.layoutController.moveVisuallyToGroup(t,t.getParent()),n.update(),n.show()}),400));n.applyBgStyle({cursor:"grab"})},t.prototype.onScaleStart=function(t,e,n){console.log("onScaleStart",e)},t.prototype.onScale=function(t,e,n){console.log("onScale",e),t.setNextState({width:t.activeState.width+e.deltaX,height:t.activeState.height+e.deltaY,transition:"none"}),t.updateState(),n.update()},t.prototype.onScaleEnd=function(t,e,n){console.log("onScaleEnd",e),t.commitState()},t.prototype.canBeDropped=function(t,e){var n,i,o=e.getLayout(),r=t.getLayout();if((null===(n=null==o?void 0:o.acceptKeys)||void 0===n?void 0:n.indexOf("*"))>=0||(null===(i=null==r?void 0:r.hasKeys)||void 0===i?void 0:i.indexOf("*"))>=0)return!0;if(null==o?void 0:o.acceptKeys){if(null==r?void 0:r.hasKeys){for(var s=0,a=r.hasKeys;s<a.length;s++)if(o.acceptKeys.indexOf(a[s])>=0)return!0;return!1}return!1}return!1},t.prototype.determineTargetGroup=function(t,e,n){return this.findGroupAtPos(t,this.rootEl,e,n)||this.rootEl},t.prototype.findGroupAtPos=function(t,e,n,i){if("group"!==e.getType())return null;var o=e.getChildren();if(o)for(var r=void 0,s=Object.keys(o),a=0;a<s.length;a++)if(r=this.findGroupAtPos(t,o[s[a]],n,i))return r;var l=e.getWrapperDom().getBoundingClientRect();return n>l.left&&n<l.left+l.width&&i>l.top&&i<l.top+l.height&&e!==t?e:null},t.prototype.destroy=function(){var t=this;this.timeouts.forEach((function(t){clearTimeout(t)})),Object.keys(this.tempElements).forEach((function(e){t.tempElements[e].destroy()}))},t}(),m=function(){function t(t){this.rootEl=t,this.activeElementEngaged=!1,this.controlsDestroyed$=new p.Subject,this.destroy$=new p.Subject,this.lastMousePos={x:0,y:0}}return t.prototype.init=function(){this.renderer=this.rootEl.renderer,this.cfr=this.rootEl.el.cfr,this.rootGroup=this.rootEl.el.pluginComponentRef.instance,this.rootVC=this.rootGroup.targetVC,this.positionController=new f(this.rootEl,this),this.rootEl.init(this)},t.prototype.getControl=function(){var t;return null===(t=this.controls)||void 0===t?void 0:t.instance},t.prototype.onUpdate=function(t,e,n,i){this.rootEl.update(this),this.positionController.onUpdate(t,e,n,i)},t.prototype.activate=function(t){this.activeEl&&this.activeEl===t||(this.activeEl=t,this.createControls(),this.setControlPos(t),this.controls.instance.setSize({width:t.activeState.width,height:t.activeState.height}))},t.prototype.deactivate=function(t){void 0===t&&(t=null),this.activeEl=null,this.destroyControls()},t.prototype.updateControl=function(){this.activeEl&&(this.setControlPos(this.activeEl),this.setControlSize({width:this.activeEl.nextState.width,height:this.activeEl.nextState.height}))},t.prototype.setControlPos=function(t){if(this.controls){var e=this.getRelativePos(t,this.rootEl);e.left+=this.controls.location.nativeElement.parentElement.scrollLeft,e.top+=this.controls.location.nativeElement.parentElement.scrollTop,this.controls.instance.setPos(e)}},t.prototype.setControlSize=function(t){this.controls.instance.setSize({width:t.width,height:t.height})},t.prototype.getRelativePos=function(t,e){var n=t.getWrapperDom().getBoundingClientRect(),i=e.el.pluginComponentRef.instance.wrapperEl.nativeElement.getBoundingClientRect();return{top:n.top-i.top,left:n.left-i.left}},t.prototype.createControls=function(){var t,e,n,i=this,o=this.cfr.resolveComponentFactory(d);this.controls&&this.destroyControls();var r=this.rootGroup.targetVC.createComponent(o,void 0,this.rootEl.el.injector);r.instance.wrapperEl=this.rootGroup.wrapperEl,r.instance.draggable=null===(t=this.activeEl.getLayout())||void 0===t?void 0:t.draggable,r.instance.scalable=null===(e=this.activeEl.getLayout())||void 0===e?void 0:e.scalable,r.instance.hideControls=null===(n=this.activeEl.getLayout())||void 0===n?void 0:n.hideControls,r.instance.layoutController=this;var s=this.activeEl;this.subscribeToElementControlEvent(r.instance.dragStart$,(function(t){i.activeElementEngaged=!0,i.positionController.onDragStart(s,t.data,i.controls.instance),i.setControlPos(s),i.renderer.setStyle(i.activeEl.getWrapperDom(),"pointer-events","none")})),this.subscribeToElementControlEvent(r.instance.drag$,(function(t){i.lastMousePos.x=t.e.pageX,i.lastMousePos.y=t.e.pageY,i.positionController.onDrag(s,t.data,i.controls.instance),i.setControlPos(s)})),this.subscribeToElementControlEvent(r.instance.dragEnd$,(function(t){i.renderer.removeStyle(i.activeEl.getWrapperDom(),"pointer-events"),i.setControlPos(s),i.positionController.onDragEnd(s,t.data,i.controls.instance),i.activeElementEngaged=!1})),this.subscribeToElementControlEvent(r.instance.scaleStart$,(function(t){i.positionController.onScaleStart(s,t.data,i.controls.instance)})),this.subscribeToElementControlEvent(r.instance.scale$,(function(t){i.positionController.onScale(s,t.data,i.controls.instance)})),this.subscribeToElementControlEvent(r.instance.scaleEnd$,(function(t){i.positionController.onScaleEnd(s,t.data,i.controls.instance)})),this.controls=r},t.prototype.destroyControls=function(){this.controls&&(this.controlsDestroyed$.next(),this.controls.destroy(),this.controls=null)},t.prototype.moveToGroup=function(t,e){if("group"!==e.getConfig().type)return console.error("Can't move to group since targetEl is not a group ",t.getId(),e.getId());t.getParentContext().pluginComponentRef.instance.detachPlugin(this.activeEl.getId()),e.el.pluginComponentRef.instance.attachPlugin(this.activeEl.getId(),this.activeEl)},t.prototype.getPositionDiff=function(t,e){var n=e.el.pluginComponentRef.instance,i=t.getWrapperDom().parentElement.getBoundingClientRect(),o=t.getWrapperDom().parentElement,r=n.targetVC.element.nativeElement.parentElement.getBoundingClientRect();return{left:i.left-r.left-o.scrollLeft,top:i.top-r.top-o.scrollTop}},t.prototype.moveVisuallyToGroup=function(t,e){var n=e.el.pluginComponentRef.instance.targetVC,i=t.el.wrapperComponentRef.hostView,o=t.getParentVC().indexOf(i);o>=0&&(t.getParentVC().detach(o),n.insert(i),t.el.currentParentContext=e.el)},t.prototype.createTempEl=function(t,e,n,i,o){var r=this;void 0===n&&(n=this.rootEl),void 0===i&&(i=null),void 0===o&&(o=null);var a=this.cfr.resolveComponentFactory(n.el.pluginCreator.getPluginWrapperComponent()),l=n.getTargetVC().createComponent(a,void 0,n.el.injector),p=l.instance;if(p.wrapperComponentRef=l,i){var c=i.getWrapperDom().cloneNode(!0);this.renderer.appendChild(p.wrapperComponentRef.location.nativeElement,c),this.renderer.removeStyle(c,"left"),this.renderer.removeStyle(c,"top"),o&&Object.keys(o).forEach((function(t){r.renderer.setStyle(c,t,o[t])}))}Object.assign({position:"absolute",styles:e});var g=new h(p);return g.setNextState(Object(s.cloneDeep)(t)),g.commitState(),g.applyStyles(e),g},t.prototype.moveToVC=function(t,e,n){var i=t.getWrapperDom().getBoundingClientRect(),o=n.element.nativeElement.parentElement.getBoundingClientRect(),r={top:i.top-o.top,left:i.left-o.left,width:i.width,height:i.height},s=t.el.wrapperComponentRef.hostView,a=e.indexOf(s);a>=0&&(e.detach(a),n.insert(s)),t.nextState.left=r.left,t.nextState.top=r.top,t.commitState()},t.prototype.findWrapperDivParent=function(t,e){var n,i=this,o=t.getChildren();return o&&Object.keys(o).forEach((function(t){var r=i.findWrapperDivParent(o[t],e);r&&(n=r)})),"group"===t.getConfig().type&&t.el.pluginComponentRef.instance.wrapperEl.nativeElement===e&&(n=t),n},t.prototype.destroy=function(){this.positionController&&this.positionController.destroy(),this.destroy$.next()},t.prototype.subscribeToElementControlEvent=function(t,e){t.pipe(Object(l.takeUntil)(this.controlsDestroyed$)).subscribe(e)},t}(),C=["targetVC"],y=["wrapperRef"],v=["overlayContainerRef"];function x(t,e){}var S=function(){function t(t,e,n,i,o,r,s,a,l){this.cfr=t,this.injector=e,this.overlay=n,this.overlayContainer=i,this.renderer=o,this.elRef=r,this.hostVC=s,this.cd=a,this.context=l,this.children={},this.layoutElements={},this.elementAdded$=new p.Subject,this.elementRemoved$=new p.Subject,this.redraw=new p.Subject,this.isBuilding=!1}return t.prototype.ngOnInit=function(){var t=this;this.createPluginWrappers(),this.context.update$.pipe(Object(l.takeUntil)(this.context.destroy$)).subscribe((function(e){t.pluginOnUpdate(e.prevConfig,e.newConfig,e.compareResult,e.commands),t.layoutController&&t.layoutController.onUpdate(e.prevConfig,e.newConfig,e.compareResult,e.commands)}))},t.prototype.detachPlugin=function(t){this.context.control.removeControl(t);var e=this.children[t].currentParentContext.pluginComponentRef.instance.targetVC,n=e.indexOf(this.children[t].wrapperComponentRef.hostView);n>-1&&e.detach(n),this.children[t].parentContext=null,this.children[t].currentParentContext=null,delete this.children[t],delete this.layoutElements[t],delete this.context.pluginConfig.config.elements[t]},t.prototype.attachPlugin=function(t,e){Object(s.isNil)(this.context.pluginConfig.config)&&(this.context.pluginConfig.config={}),Object(s.isNil)(this.context.pluginConfig.config.elements)&&(this.context.pluginConfig.config.elements={}),this.children[t]=e.el,this.layoutElements[t]=e;var n=this.children[t].wrapperComponentRef.hostView;this.targetVC.indexOf(n)<0&&this.targetVC.insert(n),this.children[t].currentParentContext=this.context,this.children[t].parentContext=this.context,this.context.control.addControl(t,e.el.control),this.context.pluginConfig.config.elements[t]=e.el.pluginConfig},t.prototype.ngAfterViewInit=function(){this.context.rootContext===this.context&&(this.rootLayoutElement=new h(this.context),this.layoutElement=this.rootLayoutElement,this.layoutController=new m(this.rootLayoutElement),this.layoutController.init())},t.prototype.addNew=function(){},t.prototype.sortWrappers=function(){for(var t,e=(t=this.children,Object.keys(t).sort((function(e,n){var i=t[e].pluginConfig,o=t[n].pluginConfig;if(i&&o&&void 0!==i.tabIndex&&void 0!==o.tabIndex){if(i.tabIndex<o.tabIndex)return-1;if(i.tabIndex>o.tabIndex)return 1}return 0}))),n=0;n<e.length;n++){var i=this.children[e[n]].wrapperComponentRef.hostView,o=this.targetVC.indexOf(i);o!==n&&(this.targetVC.detach(o),this.targetVC.insert(i,n))}},t.prototype.pluginOnUpdate=function(t,e,n,i){var o=this;if(console.log("onUpdate",this.context.id),n.diff.config&&Object(r.getDiff)(t.config,e.config).elements){var s=Object(r.deepCompare)(t.config.elements,e.config.elements);Object.keys(s.deleted).forEach((function(t){o.children[t].destroy(),o.layoutElements[t].destroy(),delete o.children[t],delete o.layoutElements[t]})),Object.keys(s.new).forEach((function(t){o.children[t]=o.createPlugin(t,e.config.elements[t])})),Object.keys(s.updated).forEach((function(t){o.children[t].updatePlugin(e.config.elements[t])}))}},t.prototype.createPluginWrappers=function(){var t=this.context.pluginConfig;t.config&&t.config.elements?this.createPlugins(t.config.elements):console.warn("Group type plugin does not have any child elements",this.context.pluginConfig.id)},t.prototype.createPlugins=function(t){for(var e,n=(e=t,Object.keys(e).sort((function(t,n){var i=e[t],o=e[n];if(i&&o&&void 0!==i.tabIndex&&void 0!==o.tabIndex){if(i.tabIndex<o.tabIndex)return-1;if(i.tabIndex>o.tabIndex)return 1}return 0}))),i=0;i<n.length;i++){var o=n[i];this.children[o]=this.createPlugin(o,t[o])}},t.prototype.createPlugin=function(t,e){var n,i=this.cfr.resolveComponentFactory(this.context.pluginCreator.getPluginWrapperComponent()),o=(n=this.targetVC.createComponent(i,void 0,this.injector)).instance;return o.currentParentContext=this.context,o.pluginCreator=this.context.pluginCreator,o.pluginLoader=this.context.pluginLoader,o.parentContext=this.context,o.rootContext=this.context.rootContext,o.wrapperComponentRef=n,o.setPlugin(t,e),this.layoutElements[t]=new h(o),"group"===o.pluginConfig.type&&(o.pluginComponentRef.instance.rootLayoutElement=this.rootLayoutElement,o.pluginComponentRef.instance.layoutElement=this.layoutElements[t]),o},t.prototype.ngOnDestroy=function(){this.layoutController&&this.layoutController.destroy()},t.\u0275fac=function(e){return new(e||t)(o["\u0275\u0275directiveInject"](o.ComponentFactoryResolver),o["\u0275\u0275directiveInject"](o.Injector),o["\u0275\u0275directiveInject"](a.Overlay),o["\u0275\u0275directiveInject"](a.OverlayContainer),o["\u0275\u0275directiveInject"](o.Renderer2),o["\u0275\u0275directiveInject"](o.ElementRef),o["\u0275\u0275directiveInject"](o.ViewContainerRef),o["\u0275\u0275directiveInject"](o.ChangeDetectorRef),o["\u0275\u0275directiveInject"](r.PLUGIN_CONTEXT))},t.\u0275cmp=o["\u0275\u0275defineComponent"]({type:t,selectors:[["app-group"]],viewQuery:function(t,e){var n;1&t&&(o["\u0275\u0275staticViewQuery"](C,!0,o.ViewContainerRef),o["\u0275\u0275staticViewQuery"](y,!0,o.ElementRef),o["\u0275\u0275staticViewQuery"](v,!0,o.ElementRef)),2&t&&(o["\u0275\u0275queryRefresh"](n=o["\u0275\u0275loadQuery"]())&&(e.targetVC=n.first),o["\u0275\u0275queryRefresh"](n=o["\u0275\u0275loadQuery"]())&&(e.wrapperEl=n.first),o["\u0275\u0275queryRefresh"](n=o["\u0275\u0275loadQuery"]())&&(e.overlayContainerRef=n.first))},hostVars:2,hostBindings:function(t,e){2&t&&o["\u0275\u0275classProp"]("building",e.isBuilding)},decls:7,vars:2,consts:[["admino-group-wrapper","",1,"wrapper",3,"ngStyle","cdkTrapFocus"],["wrapperVC","","wrapperRef",""],["targetVC",""],[1,""],["overlayContainerRef",""]],template:function(t,e){1&t&&(o["\u0275\u0275elementStart"](0,"div",0,1),o["\u0275\u0275template"](3,x,0,0,"ng-template",null,2,o["\u0275\u0275templateRefExtractor"]),o["\u0275\u0275elementEnd"](),o["\u0275\u0275element"](5,"div",3,4)),2&t&&o["\u0275\u0275property"]("ngStyle",null==e.context.pluginConfig.config?null:e.context.pluginConfig.config.innerStyle)("cdkTrapFocus",null==e.context.pluginConfig.config?null:e.context.pluginConfig.config.trapFocus)},directives:[i.NgStyle,a.CdkTrapFocus],styles:["[_nghost-%COMP%]{display:inline-flex}[_nghost-%COMP%], [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]{overflow:hidden;overflow-x:auto;overflow-y:auto;position:relative;scroll-behavior:smooth}[_nghost-%COMP%]  .limit-interaction, [_nghost-%COMP%]  .limit-interaction *{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;pointer-events:none}[_nghost-%COMP%]  .edit-shadow{box-shadow:5px 5px 10px 10px rgba(0,0,0,.5)}"]}),t}(),w=n("MdUB"),b=function(){function t(){}return t.entry=S,t.\u0275mod=o["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=o["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},imports:[[i.CommonModule,r.SharedModule,a.OverlayModule,w.MatTooltipModule,w.MatButtonModule,w.MatMenuModule,w.MatIconModule,a.A11yModule]]}),t}();e.default=b}})}));